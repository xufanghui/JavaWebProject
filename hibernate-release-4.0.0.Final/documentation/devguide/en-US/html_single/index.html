<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate Developer Guide</title><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Hibernate Developer Guide</h1></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gavin</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">King</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Christian</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Bauer</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Steve</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ebersole</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Max</span> <span xmlns="http://www.w3.org/1999/xhtml" class="othername">Rydahl</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Andersen</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Emmanuel</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Bernard</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Hardy</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ferentschik</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Adam</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Warski</span>, and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gail</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Badner</span></div><div class="editors">edited by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Misty</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Stanley-Jones</span></div><div class="others">and thanks to <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">James</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Cobb</span> (Graphic Design) and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Cheyenne</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Weaver</span> (Graphic Design)</div></div></div><div><p class="releaseinfo">4.0.0.Final</p></div><div><p class="copyright">Copyright © 2011 Red Hat, Inc.</p></div><div><p class="pubdate">2011-12-14</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#pref-Hibernate_Development_Guide-Preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e121">1. Get Involved</a></span></dt><dt><span class="section"><a href="#d0e146">2. Getting Started Guide</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e154">1. Database access</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e157">1.1. Connecting</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e184">1.1.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e277">1.1.2. Obtaining a JDBC connection</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e316">1.2. Connection pooling</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e324">1.2.1. c3p0 connection pool</a></span></dt><dt><span class="section"><a href="#d0e353">1.2.2. Proxool connection pool</a></span></dt><dt><span class="section"><a href="#d0e402">1.2.3. Obtaining connections from an application server, using JNDI</a></span></dt><dt><span class="section"><a href="#d0e430">1.2.4. Other connection-specific configuration</a></span></dt><dt><span class="section"><a href="#d0e449">1.2.5. Optional configuration properties</a></span></dt></dl></dd><dt><span class="section"><a href="#configuring-dialects">1.3. Dialects</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e605">1.3.1. Specifying the Dialect to use</a></span></dt><dt><span class="section"><a href="#d0e616">1.3.2. Dialect resolution</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e650">1.4. Automatic schema generation with SchemaExport</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e665">1.4.1. Customizing the mapping files</a></span></dt><dt><span class="section"><a href="#d0e900">1.4.2. Running the SchemaExport tool</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e999">2. Transactions and concurrency control</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1002">2.1. Defining Transaction</a></span></dt><dt><span class="section"><a href="#d0e1020">2.2. Physical Transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1053">2.2.1. Physical Transactions - JDBC</a></span></dt><dt><span class="section"><a href="#d0e1067">2.2.2. Physical Transactions - JTA</a></span></dt><dt><span class="section"><a href="#d0e1085">2.2.3. Physical Transactions - CMT</a></span></dt><dt><span class="section"><a href="#d0e1103">2.2.4. Physical Transactions - Custom</a></span></dt><dt><span class="section"><a href="#d0e1127">2.2.5. Physical Transactions - Legacy</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1160">2.3. Hibernate Transaction Usage</a></span></dt><dt><span class="section"><a href="#d0e1176">2.4. Transaction Scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#session-per-operation">2.4.1. Session-per-operation</a></span></dt><dt><span class="section"><a href="#d0e1196">2.4.2. Session-per-request</a></span></dt><dt><span class="section"><a href="#long-conversations">2.4.3. Conversations</a></span></dt><dt><span class="section"><a href="#d0e1325">2.4.4. Object identity</a></span></dt><dt><span class="section"><a href="#transaction-antipatterns">2.4.5. Problems and anti-patterns</a></span></dt></dl></dd><dt><span class="section"><a href="#hibernate-transaction-api">2.5. Hibernate Transaction API (JTA)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1448">2.5.1. Bean-managed transactions (BMT)</a></span></dt><dt><span class="section"><a href="#d0e1470">2.5.2. Container-managed transactions (CMT)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e1540">3. Persistence Contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1602">3.1. Making entities persistent</a></span></dt><dt><span class="section"><a href="#d0e1660">3.2. Deleting entities</a></span></dt><dt><span class="section"><a href="#d0e1686">3.3. Obtain an entity reference without initializing its data</a></span></dt><dt><span class="section"><a href="#d0e1702">3.4. Obtain an entity with its data initialized</a></span></dt><dt><span class="section"><a href="#d0e1716">3.5. Refresh entity state</a></span></dt><dt><span class="section"><a href="#d0e1737">3.6. Modifying managed/persistent state</a></span></dt><dt><span class="section"><a href="#d0e1749">3.7. Working with detached data</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1756">3.7.1. Reattaching detached data</a></span></dt><dt><span class="section"><a href="#d0e1799">3.7.2. Merging detached data</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1818">3.8. Checking persistent state</a></span></dt><dt><span class="section"><a href="#d0e1850">3.9. Accessing Hibernate APIs from JPA</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e1860">4. Batch Processing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1891">4.1. Batch inserts</a></span></dt><dt><span class="section"><a href="#d0e1909">4.2. Batch updates</a></span></dt><dt><span class="section"><a href="#d0e1930">4.3. StatelessSession</a></span></dt><dt><span class="section"><a href="#d0e2016">4.4. Hibernate Query Language for DML</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2036">4.4.1. HQL for UPDATE and DELETE</a></span></dt><dt><span class="section"><a href="#d0e2114">4.4.2. HQL syntax for INSERT</a></span></dt><dt><span class="section"><a href="#d0e2182">4.4.3. More information on HQL</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e2189">5. Locking</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2223">5.1. Optimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2249">5.1.1. Dedicated version number</a></span></dt><dt><span class="section"><a href="#d0e2370">5.1.2. Timestamp</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2460">5.2. Pessimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2468">5.2.1. The <code class="classname">LockMode</code> class</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e2596">6. Caching</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2599">6.1. The query cache</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2651">6.1.1. Query cache regions</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2674">6.2. Second-level cache providers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2683">6.2.1. Configuring your cache providers</a></span></dt><dt><span class="section"><a href="#caching-strategies-list">6.2.2. Caching strategies</a></span></dt><dt><span class="section"><a href="#caching-provider-table">6.2.3. Second-level cache providers for Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3066">6.3. Managing the cache</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3069">6.3.1. Moving items into and out of the cache</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d0e3227">7. Services</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3230">7.1. What are services?</a></span></dt><dt><span class="section"><a href="#d0e3235">7.2. Service contracts</a></span></dt><dt><span class="section"><a href="#d0e3254">7.3. Service dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3259">7.3.1. @<code class="interfacename">org.hibernate.service.spi.InjectService</code></a></span></dt><dt><span class="section"><a href="#d0e3291">7.3.2. <code class="interfacename">org.hibernate.service.spi.ServiceRegistryAwareService</code></a></span></dt></dl></dd><dt><span class="section"><a href="#services-registry">7.4. ServiceRegistry</a></span></dt><dt><span class="section"><a href="#d0e3327">7.5. Standard services</a></span></dt><dd><dl><dt><span class="section"><a href="#services-BatchBuilder">7.5.1. <code class="interfacename">org.hibernate.engine.jdbc.batch.spi.BatchBuilder</code></a></span></dt><dt><span class="section"><a href="#services-ConfigurationService">7.5.2. <code class="interfacename">org.hibernate.service.config.spi.ConfigurationService</code></a></span></dt><dt><span class="section"><a href="#services-ConnectionProvider">7.5.3. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code></a></span></dt><dt><span class="section"><a href="#services-DialectFactory">7.5.4. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectFactory</code></a></span></dt><dt><span class="section"><a href="#services-DialectResolver">7.5.5. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code></a></span></dt><dt><span class="section"><a href="#services-JdbcServices">7.5.6. <code class="interfacename">org.hibernate.engine.jdbc.spi.JdbcServices</code></a></span></dt><dt><span class="section"><a href="#services-JmxService">7.5.7. <code class="interfacename">org.hibernate.service.jmx.spi.JmxService</code></a></span></dt><dt><span class="section"><a href="#services-JndiService">7.5.8. <code class="interfacename">org.hibernate.service.jndi.spi.JndiService</code></a></span></dt><dt><span class="section"><a href="#services-JtaPlatform">7.5.9. <code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code></a></span></dt><dt><span class="section"><a href="#services-MultiTenantConnectionProvider">7.5.10. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.MultiTenantConnectionProvider</code></a></span></dt><dt><span class="section"><a href="#services-PersisterClassResolver">7.5.11. <code class="interfacename">org.hibernate.persister.spi.PersisterClassResolver</code></a></span></dt><dt><span class="section"><a href="#services-PersisterFactory">7.5.12. <code class="interfacename">org.hibernate.persister.spi.PersisterFactory</code></a></span></dt><dt><span class="section"><a href="#services-RegionFactory">7.5.13. <code class="interfacename">org.hibernate.cache.spi.RegionFactory</code></a></span></dt><dt><span class="section"><a href="#services-SessionFactoryServiceRegistryFactory">7.5.14. <code class="interfacename">org.hibernate.service.spi.SessionFactoryServiceRegistryFactory</code></a></span></dt><dt><span class="section"><a href="#services-Statistics">7.5.15. <code class="interfacename">org.hibernate.stat.Statistics</code></a></span></dt><dt><span class="section"><a href="#services-TransactionFactory">7.5.16. <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code></a></span></dt><dt><span class="section"><a href="#services-ImportSqlCommandExtractor">7.5.17. <code class="interfacename">org.hibernate.tool.hbm2ddl.ImportSqlCommandExtractor</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4121">7.6. Custom services</a></span></dt><dt><span class="section"><a href="#d0e4164">7.7. Special service registries</a></span></dt><dd><dl><dt><span class="section"><a href="#services-registry-bootstrap">7.7.1. Boot-strap registry</a></span></dt><dt><span class="section"><a href="#services-registry-sessionfactory">7.7.2. SessionFactory registry</a></span></dt></dl></dd><dt><span class="section"><a href="#services-use">7.8. Using services and registries</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e4249">8. Data categorizations</a></span></dt><dd><dl><dt><span class="section"><a href="#value-types">8.1. Value types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-basic-types">8.1.1. Basic types</a></span></dt><dt><span class="section"><a href="#value-composite-types">8.1.2. Composite types</a></span></dt><dt><span class="section"><a href="#value-collection-types">8.1.3. Collection types</a></span></dt></dl></dd><dt><span class="section"><a href="#entity-types">8.2. Entity Types</a></span></dt><dt><span class="section"><a href="#d0e4708">8.3. Implications of different data categorizations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#devguide-mappingEntities">9. Mapping entities</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4716">9.1. Hierarchies</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e4720">10. Mapping associations</a></span></dt><dt><span class="chapter"><a href="#chap-hql">11. HQL and JPAQL</a></span></dt><dt><span class="chapter"><a href="#d0e4735">12. Criteria</a></span></dt><dt><span class="chapter"><a href="#d0e4740">13. Native-SQL</a></span></dt><dt><span class="chapter"><a href="#d0e4744">14. JMX</a></span></dt><dt><span class="chapter"><a href="#d0e4749">15. Envers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4757">15.1. Basics</a></span></dt><dt><span class="section"><a href="#d0e4792">15.2. Configuration</a></span></dt><dt><span class="section"><a href="#d0e4988">15.3. Additional mapping annotations</a></span></dt><dt><span class="section"><a href="#d0e5035">15.4. Choosing an audit strategy</a></span></dt><dt><span class="section"><a href="#envers-revisionlog">15.5. Revision Log</a></span></dt><dd><dl><dt><span class="section"><a href="#envers-tracking-modified-entities-revchanges">15.5.1. Tracking entity names modified during revisions</a></span></dt></dl></dd><dt><span class="section"><a href="#envers-queries">15.6. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#entities-at-revision">15.6.1. Querying for entities of a class at a given revision</a></span></dt><dt><span class="section"><a href="#revisions-of-entity">15.6.2. Querying for revisions, at which entities of a given class changed</a></span></dt><dt><span class="section"><a href="#envers-tracking-modified-entities-queries">15.6.3. Querying for entities modified in a given revision</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5431">15.7. Conditional auditing</a></span></dt><dt><span class="section"><a href="#d0e5469">15.8. Understanding the Envers Schema</a></span></dt><dt><span class="section"><a href="#envers-generateschema">15.9. Generating schema with Ant</a></span></dt><dt><span class="section"><a href="#envers-mappingexceptions">15.10. Mapping exceptions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5541">15.10.1. What isn't and will not be supported</a></span></dt><dt><span class="section"><a href="#d0e5561">15.10.2. What isn't and <span class="emphasis"><em>will</em></span> be supported</a></span></dt><dt><span class="section"><a href="#d0e5571">15.10.3. <code class="literal">@OneToMany</code>+<code class="literal">@JoinColumn</code></a></span></dt></dl></dd><dt><span class="section"><a href="#envers-partitioning">15.11. Advanced: Audit table partitioning</a></span></dt><dd><dl><dt><span class="section"><a href="#envers-partitioning-benefits">15.11.1. Benefits of audit table partitioning</a></span></dt><dt><span class="section"><a href="#envers-partitioning-columns">15.11.2. Suitable columns for audit table partitioning</a></span></dt><dt><span class="section"><a href="#envers-partitioning-example">15.11.3. Audit table partitioning example</a></span></dt></dl></dd><dt><span class="section"><a href="#envers-links">15.12. Envers links</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendix-Configuration_Properties">A. Configuration properties</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5988">A.1. General Configuration</a></span></dt><dt><span class="section"><a href="#d0e6163">A.2. Database configuration</a></span></dt><dt><span class="section"><a href="#d0e6559">A.3. Connection pool properties</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appe-Hibernate_Development_Guide-Revision_History">B. Revision History</a></span></dt><dt><span class="index"><a href="#d0e6640">Index</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="pref-Hibernate_Development_Guide-Preface"/>Preface</h2></div></div></div><p>
        Working with both Object-Oriented software and Relational Databases can be cumbersome and time consuming.
        Development costs are significantly higher due to a paradigm mismatch between how data is represented in
        objects versus relational databases.  Hibernate is an Object/Relational Mapping solution for Java environments.
        The term Object/Relational Mapping refers to the technique of mapping data from an object model representation
        to a relational data model representation (and visa versa).  See
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Object-relational_mapping">http://en.wikipedia.org/wiki/Object-relational_mapping</a> for a good high-level discussion.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
            While having a strong background in SQL is not required to use Hibernate, having a basic understanding of
            the concepts can greatly help you understand Hibernate more fully and quickly.  Probably the single
            best background is an understanding of data modeling principles.  You might want to consider these resources
            as a good starting point:
            </p><div class="itemizedlist"><ul><li><p>
                        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.agiledata.org/essays/dataModeling101.html">http://www.agiledata.org/essays/dataModeling101.html</a>
                    </p></li><li><p>
                        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Data_modeling">http://en.wikipedia.org/wiki/Data_modeling</a>
                    </p></li></ul></div><p>
        </p></div><p>
        Hibernate not only takes care of the mapping from Java classes to database tables (and from Java data types to
        SQL data types), but also provides data query and retrieval facilities. It can significantly reduce
        development time otherwise spent with manual data handling in SQL and JDBC.  Hibernate’s design goal is to
        relieve the developer from 95% of common data persistence-related programming tasks by eliminating the need for
        manual, hand-crafted data processing using SQL and JDBC.  However, unlike many other persistence solutions,
        Hibernate does not hide the power of SQL from you and guarantees that your investment in relational technology
        and knowledge is as valid as always.
    </p><p>
        Hibernate may not be the best solution for data-centric applications that only use stored-procedures to
        implement the business logic in the database, it is most useful with object-oriented domain models and business
        logic in the Java-based middle-tier. However, Hibernate can certainly help you to remove or encapsulate
        vendor-specific SQL code and will help with the common task of result set translation from a tabular
        representation to a graph of objects.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e121"/>1. Get Involved</h2></div></div></div><div class="itemizedlist"><ul><li><p>
                    Use Hibernate and report any bugs or issues you find. See
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://hibernate.org/issuetracker.html">http://hibernate.org/issuetracker.html</a> for details.
                </p></li><li><p>
                    Try your hand at fixing some bugs or implementing enhancements. Again, see
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://hibernate.org/issuetracker.html">http://hibernate.org/issuetracker.html</a>.
                </p></li><li><p>
                    Engage with the community using mailing lists, forums, IRC, or other ways listed at
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://hibernate.org/community.html">http://hibernate.org/community.html</a>.
                </p></li><li><p>
                    Help improve or translate this documentation. Contact us on
                    the developer mailing list if you have interest.
                </p></li><li><p>
                    Spread the word. Let the rest of your organization know about the benefits of
                    Hibernate.
                </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e146"/>2. Getting Started Guide</h2></div></div></div><p>
            New users may want to first look through the
            <em class="citetitle">Hibernate Getting Started Guide</em> for basic information as well as
            tutorials.  Even seasoned veterans may want to considering perusing the sections pertaining to
            build artifacts for any changes.
        </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e154"/>Chapter 1. Database access</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e157">1.1. Connecting</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e184">1.1.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e277">1.1.2. Obtaining a JDBC connection</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e316">1.2. Connection pooling</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e324">1.2.1. c3p0 connection pool</a></span></dt><dt><span class="section"><a href="#d0e353">1.2.2. Proxool connection pool</a></span></dt><dt><span class="section"><a href="#d0e402">1.2.3. Obtaining connections from an application server, using JNDI</a></span></dt><dt><span class="section"><a href="#d0e430">1.2.4. Other connection-specific configuration</a></span></dt><dt><span class="section"><a href="#d0e449">1.2.5. Optional configuration properties</a></span></dt></dl></dd><dt><span class="section"><a href="#configuring-dialects">1.3. Dialects</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e605">1.3.1. Specifying the Dialect to use</a></span></dt><dt><span class="section"><a href="#d0e616">1.3.2. Dialect resolution</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e650">1.4. Automatic schema generation with SchemaExport</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e665">1.4.1. Customizing the mapping files</a></span></dt><dt><span class="section"><a href="#d0e900">1.4.2. Running the SchemaExport tool</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e157"/>1.1. Connecting</h2></div></div></div><p>
            Hibernate connects to databases on behalf of your application. It can connect through a variety of mechanisms,
            including:
        </p><div class="itemizedlist"><ul><li><p>Stand-alone built-in connection pool</p></li><li><p><code class="classname">javax.sql.DataSource</code></p></li><li><p>Two different third-party opensource JDBC connection pools:</p><div class="itemizedlist"><ul><li><p>c3p0</p></li><li><p>proxool</p></li></ul></div></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The built-in connection pool is not intended for production environments.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e184"/>1.1.1. Configuration</h3></div></div></div><p>
                You can configure database connections using a properties file, an XML deployment descriptor, programmatically.
      </p><div class="example"><a id="d0e189"/><p class="title"><b>Example 1.1. <code class="filename">hibernate.properties</code> for a c3p0 connection pool</b></p><div class="example-contents"><pre class="programlisting">hibernate.connection.driver_class = org.postgresql.Driver
hibernate.connection.url = jdbc:postgresql://localhost/mydatabase
hibernate.connection.username = myuser
hibernate.connection.password = secret
hibernate.c3p0.min_size=5
hibernate.c3p0.max_size=20
hibernate.c3p0.timeout=1800
hibernate.c3p0.max_statements=50
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre></div></div><br class="example-break"/><div class="example"><a id="d0e196"/><p class="title"><b>Example 1.2. <code class="filename">hibernate.cfg.xml</code> for a connection to the bundled HSQL database</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version='1.0'&nbsp;encoding='utf-8'?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_plain">!</span><span class="xml_attribute_name">DOCTYPE</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">hibernate-configuration</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">PUBLIC</span><span class="xml_plain"></span><br />
<span class="xml_attribute_value">&quot;-//Hibernate/Hibernate&nbsp;Configuration&nbsp;DTD&nbsp;3.0//EN&quot;</span><span class="xml_plain"></span><br />
<span class="xml_attribute_value">&quot;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Database&nbsp;connection&nbsp;settings&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;connection.driver_class&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hsqldb.jdbcDriver</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;connection.url&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jdbc:hsqldb:hsql://localhost</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;connection.username&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sa</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;connection.password&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;JDBC&nbsp;connection&nbsp;pool&nbsp;(use&nbsp;the&nbsp;built-in)&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;connection.pool_size&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;SQL&nbsp;dialect&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;dialect&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.dialect.HSQLDialect</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Enable&nbsp;Hibernate's&nbsp;automatic&nbsp;session&nbsp;context&nbsp;management&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;current_session_context_class&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">thread</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Disable&nbsp;the&nbsp;second-level&nbsp;cache&nbsp;&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cache.provider_class&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate.cache.internal.NoCacheProvider</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Echo&nbsp;all&nbsp;executed&nbsp;SQL&nbsp;to&nbsp;stdout&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;show_sql&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Drop&nbsp;and&nbsp;re-create&nbsp;the&nbsp;database&nbsp;schema&nbsp;on&nbsp;startup&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hbm2ddl.auto&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">update</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">mapping</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">resource</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org/hibernate/tutorial/domain/Event.hbm.xml&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">session-factory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">hibernate-configuration</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
          The DTD in the configuration file used in this example is required.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e206"/>1.1.1.1. Programatic configuration</h4></div></div></div><p>
          An instance of object <code class="classname">org.hibernate.cfg.Configuration</code> represents an entire set of
          mappings of an application's Java types to an SQL database. The
          <code class="classname">org.hibernate.cfg.Configuration</code> builds an immutable
          <code class="classname">org.hibernate.SessionFactory</code>, and compiles the mappings from various XML mapping
          files. You can specify the mapping files directly, or Hibernate can find them for you.
        </p><div class="example"><a id="d0e220"/><p class="title"><b>Example 1.3. Specifying the mapping files directly</b></p><div class="example-contents"><p>
            You can obtain a <code class="classname">org.hibernate.cfg.Configuration</code> instance by instantiating it
            directly and specifying XML mapping documents. If the mapping files are in the classpath, use method
            <code class="methodname">addResource()</code>.
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addResource</span><span class="java_separator">(</span><span class="java_literal">&quot;Item.hbm.xml&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addResource</span><span class="java_separator">(</span><span class="java_literal">&quot;Bid.hbm.xml&quot;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e233"/><p class="title"><b>Example 1.4. Letting Hibernate find the mapping files for you</b></p><div class="example-contents"><p>
            The <code class="methodname">addClass()</code> method directs Hibernate to search the CLASSPATH for the mapping
            files, eliminating hard-coded file names. In the following example, it searches for
            <code class="filename">org/hibernate/auction/Item.hbm.xml</code> and
            <code class="filename">org/hibernate/auction/Bid.hbm.xml</code>.
          </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addClass</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">auction</span><span class="java_separator">.</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addClass</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">auction</span><span class="java_separator">.</span><span class="java_type">Bid</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e249"/><p class="title"><b>Example 1.5. Specifying configuration properties</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addClass</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">auction</span><span class="java_separator">.</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addClass</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">auction</span><span class="java_separator">.</span><span class="java_type">Bid</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.dialect&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org.hibernate.dialect.MySQLInnoDBDialect&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.connection.datasource&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;java:comp/env/jdbc/test&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setProperty</span><span class="java_separator">(</span><span class="java_literal">&quot;hibernate.order_updates&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><div class="itemizedlist"><p class="title"><b>Other ways to configure Hibernate programmatically</b></p><ul><li><p>
              Pass an instance of <code class="classname">java.util.Properties</code> to
              <code class="classname">Configuration.setProperties()</code>.
            </p></li><li><p>
              Set System properties using <code class="command">java
              -D<em class="replaceable"><code>property</code></em>=<em class="replaceable"><code>value</code></em></code>
            </p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e277"/>1.1.2. Obtaining a JDBC connection</h3></div></div></div><p>
        After you configure the <a href="#hibernate-jdbc-properties" title="Most important Hibernate JDBC properties">Most important Hibernate JDBC properties</a>, you can use method
        <code class="methodname">openSession</code> of class <code class="classname">org.hibernate.SessionFactory</code> to open
        sessions.  </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_type"&gt;Session&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_plain"&gt;&amp;nbsp;session&amp;nbsp;&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_operator"&gt;=&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_plain"&gt;&amp;nbsp;sessions&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_separator"&gt;.&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_plain"&gt;openSession&lt;/span&gt;&lt;!-- &lt;br/&gt; --&gt;&lt;span class="java_separator"&gt;();&lt;/span&gt;</pre><p>
      </p><div class="itemizedlist"><a id="hibernate-jdbc-properties"/><p class="title"><b>Most important Hibernate JDBC properties</b></p><ul><li><p>hibernate.connection.driver_class</p></li><li><p>hibernate.connection.url</p></li><li><p>hibernate.connection.username</p></li><li><p>hibernate.connection.password</p></li><li><p>hibernate.connection.pool_size</p></li></ul></div><p>
        All Hibernate property names and semantics are defined in class
        <code class="classname">org.hibernate.cfg.Environment</code>. See the Javadoc for a complete listing.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e316"/>1.2. Connection pooling</h2></div></div></div><p>
      Hibernate's internal connection pooling algorithm is rudimentary, and is provided for development and testing
      purposes. Use a third-party pool for best performance and stability. To use a third-party pool, replace the
      <span class="property">hibernate.connection.pool_size property</span> with settings specific to your connection pool of
      choice. This disables Hibernate's internal connection pool.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e324"/>1.2.1. c3p0 connection pool</h3></div></div></div><p>
        C3P0 is an open source JDBC connection pool distributed along with Hibernate in the <code class="filename">lib/</code>
        directory. Hibernate uses its <code class="classname">org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider</code> for
        connection pooling if you set the <span class="property">hibernate.c3p0.*</span> properties.  properties.
      </p><div class="itemizedlist"><p class="title"><b>Important configuration properties for the c3p0 connection pool</b></p><ul><li><p>hibernate.c3p0.min_size</p></li><li><p>hibernate.c3p0.max_size</p></li><li><p>hibernate.c3p0.timeout</p></li><li><p>hibernate.c3p0.max_statements</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e353"/>1.2.2. Proxool connection pool</h3></div></div></div><p>
        Proxool is another open source JDBC connection pool distributed along with Hibernate in the
        <code class="filename">lib/</code> directory. Hibernate uses its
        <code class="classname">org.hibernate.service.jdbc.connections.internal.ProxoolConnectionProvider</code> for connection pooling if you set the
        <span class="property">hibernate.proxool.*</span> properties. Unlike c3p0, proxool requires some additional configuration
        parameters, as described by the Proxool documentation available at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://proxool.sourceforge.net/configure.html">http://proxool.sourceforge.net/configure.html</a>.
      </p><div class="table"><a id="d0e369"/><p class="title"><b>Table 1.1. Important configuration properties for the Proxool connection pool</b></p><div class="table-contents"><table summary="Important configuration properties for the Proxool connection pool" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>hibernate.proxool.xml</td><td>Configure Proxool provider using an XML file (.xml is appended automatically)</td></tr><tr><td>hibernate.proxool.properties</td><td>Configure the Proxool provider using a properties file (.properties is appended
              automatically)</td></tr><tr><td>hibernate.proxool.existing_pool</td><td>Whether to configure the Proxool provider from an existing pool</td></tr><tr><td>hibernate.proxool.pool_alias</td><td>Proxool pool alias to use. Required.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e402"/>1.2.3. Obtaining connections from an application server, using JNDI</h3></div></div></div><p>
        To use Hibernate inside an application server, configure Hibernate to obtain connections from an application
        server <code class="classname">javax.sql.Datasource</code> registered in JNDI, by setting at least one of the following
        properties:
      </p><div class="itemizedlist"><p class="title"><b>Important Hibernate properties for JNDI datasources</b></p><ul><li><p>hibernate.connection.datasource (required)</p></li><li><p>hibernate.jndi.url</p></li><li><p>hibernate.jndi.class</p></li><li><p>hibernate.connection.username</p></li><li><p>hibernate.connection.password</p></li></ul></div><p>
        JDBC connections obtained from a JNDI datasource automatically participate in the container-managed transactions
        of the application server.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e430"/>1.2.4. Other connection-specific configuration</h3></div></div></div><p>
        You can pass arbitrary connection properties by prepending <code class="literal">hibernate.connection</code> to the
        connection property name. For example, specify a charSet connection property as
        <span class="property">hibernate.connection.charSet</span>.
      </p><p>
        You can define your own plugin strategy for obtaining JDBC connections by implementing the interface
        <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code> and specifying your custom
        implementation with the <span class="property">hibernate.connection.provider_class</span> property.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e449"/>1.2.5. Optional configuration properties</h3></div></div></div><p>
        In addition to the properties mentioned in the previous sections, Hibernate includes many other optional
        properties. See <a href="#appendix-Configuration_Properties" title="Appendix A. Configuration properties">Appendix A, <i xmlns:xlink="http://www.w3.org/1999/xlink">Configuration properties</i></a> for a more complete list.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-dialects"/>1.3. Dialects</h2></div></div></div><p>
        Although SQL is relatively standardized, each database vendor uses a subset of supported syntax. This is referred
        to as a <em class="firstterm">dialect</em>.  Hibernate handles variations across these dialects through its
        <code class="classname">org.hibernate.dialect.Dialect</code> class and the various subclasses for each vendor dialect.
    </p><div class="table"><a id="d0e467"/><p class="title"><b>Table 1.2. Supported database dialects</b></p><div class="table-contents"><table summary="Supported database dialects" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Database</th><th>Dialect</th></tr></thead><tbody><tr><td>DB2</td><td>org.hibernate.dialect.DB2Dialect</td></tr><tr><td>DB2 AS/400</td><td>org.hibernate.dialect.DB2400Dialect</td></tr><tr><td>DB2 OS390</td><td>org.hibernate.dialect.DB2390Dialect</td></tr><tr><td>Firebird</td><td>org.hibernate.dialect.FirebirdDialect</td></tr><tr><td>FrontBase</td><td>org.hibernate.dialect.FrontbaseDialect</td></tr><tr><td>HypersonicSQL</td><td>org.hibernate.dialect.HSQLDialect</td></tr><tr><td>Informix</td><td>org.hibernate.dialect.InformixDialect</td></tr><tr><td>Interbase</td><td>org.hibernate.dialect.InterbaseDialect</td></tr><tr><td>Ingres</td><td>org.hibernate.dialect.IngresDialect</td></tr><tr><td>Microsoft SQL Server 2005</td><td>org.hibernate.dialect.SQLServer2005Dialect</td></tr><tr><td>Microsoft SQL Server 2008</td><td>org.hibernate.dialect.SQLServer2008Dialect</td></tr><tr><td>Mckoi SQL</td><td>org.hibernate.dialect.MckoiDialect</td></tr><tr><td>MySQL</td><td>org.hibernate.dialect.MySQLDialect</td></tr><tr><td>MySQL with InnoDB</td><td>org.hibernate.dialect.MySQL5InnoDBDialect</td></tr><tr><td>MySQL with MyISAM</td><td>org.hibernate.dialect.MySQLMyISAMDialect</td></tr><tr><td>Oracle 8i</td><td>org.hibernate.dialect.Oracle8iDialect</td></tr><tr><td>Oracle 9i</td><td>org.hibernate.dialect.Oracle9iDialect</td></tr><tr><td>Oracle 10g</td><td>org.hibernate.dialect.Oracle10gDialect</td></tr><tr><td>Pointbase</td><td>org.hibernate.dialect.PointbaseDialect</td></tr><tr><td>PostgreSQL</td><td>org.hibernate.dialect.PostgreSQLDialect</td></tr><tr><td>Progress</td><td>org.hibernate.dialect.ProgressDialect</td></tr><tr><td>SAP DB</td><td>org.hibernate.dialect.SAPDBDialect</td></tr><tr><td>Sybase ASE 15.5</td><td>org.hibernate.dialect.SybaseASE15Dialect</td></tr><tr><td>Sybase ASE 15.7</td><td>org.hibernate.dialect.SybaseASE157Dialect</td></tr><tr><td>Sybase Anywhere</td><td>org.hibernate.dialect.SybaseAnywhereDialect</td></tr></tbody></table></div></div><br class="table-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e605"/>1.3.1. Specifying the Dialect to use</h3></div></div></div><p>
              The developer may manually specify the Dialect to use by setting the
              <span class="property">hibernate.dialect</span> configuration property to the name of a specific
              <code class="classname">org.hibernate.dialect.Dialect</code> class to use.
          </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e616"/>1.3.2. Dialect resolution</h3></div></div></div><p>
              Assuming a <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code> has been
              set up, Hibernate will attempt to automatically determine the Dialect to use based on the
              <code class="interfacename">java.sql.DatabaseMetaData</code> reported by a
              <code class="interfacename">java.sql.Connection</code> obtained from that
              <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code>.
          </p><p>
                This functionality is provided by a series of
                <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code> instances registered
                with Hibernate internally.  Hibernate comes with a standard set of recognitions.  If your application
                requires extra Dialect resolution capabilities, it would simply register a custom implementation
                of <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code> as follows:
          </p><p>
                Registered <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code> are
                <span class="emphasis"><em>prepended</em></span> to an internal list of resolvers, so they take precedence
                before any already registered resolvers including the standard one.
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e650"/>1.4. Automatic schema generation with SchemaExport</h2></div></div></div><p>
      SchemaExport is a Hibernate utility which generates DDL from your mapping files. The generated schema includes
      referential integrity constraints, primary and foreign keys, for entity and collection tables. It also creates
      tables and sequences for mapped identifier generators.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        You must specify a SQL Dialect via the <span class="property">hibernate.dialect</span> property when using this tool,
        because DDL is highly vendor-specific. See <a href="#configuring-dialects" title="1.3. Dialects">Section 1.3, “Dialects”</a> for information.
      </p></div><p>
      Before Hibernate can generate your schema, you must customize your mapping files.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e665"/>1.4.1. Customizing the mapping files</h3></div></div></div><p>
        Hibernate provides several elements and attributes to customize your mapping files. They are listed in <a href="#tab-customizing-schema" title="Table 1.3. Elements and attributes provided for customizing mapping files">Table 1.3, “Elements and attributes provided for customizing mapping files”</a>, and a logical order of customization is presented in <a href="#proc-customizing-schema" title="Procedure 1.1. Customizing the schema">Customizing the schema</a>.
      </p><div class="table"><a id="tab-customizing-schema"/><p class="title"><b>Table 1.3. Elements and attributes provided for customizing mapping files</b></p><div class="table-contents"><table summary="Elements and attributes provided for customizing mapping files" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Name</th><th>Type of value</th><th>Description</th></tr></thead><tbody><tr><td>length</td><td>number</td><td>Column length</td></tr><tr><td>precision</td><td>number</td><td>Decimal precision of column</td></tr><tr><td>scale</td><td>number</td><td>Decimal scale of column</td></tr><tr><td>not-null</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Whether a column is allowed to hold null values</td></tr><tr><td>unique</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Whether values in the column must be unique</td></tr><tr><td>index</td><td>string</td><td>The name of a multi-column index</td></tr><tr><td>unique-key</td><td>string</td><td>The name of a multi-column unique constraint</td></tr><tr><td>foreign-key</td><td>string</td><td>The name of the foreign key constraint generated for an association. This applies to
              &lt;one-to-one&gt;, &lt;many-to-one&gt;, &lt;key&gt;, and &lt;many-to-many&gt; mapping
              elements. <code class="literal">inverse="true"</code> sides are skipped by SchemaExport.</td></tr><tr><td>sql-type</td><td>string</td><td>Overrides the default column type. This applies to the &lt;column&gt; element only.</td></tr><tr><td>default</td><td>string</td><td>Default value for the column</td></tr><tr><td>check</td><td>string</td><td>An SQL check constraint on either a column or atable</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="proc-customizing-schema"/><p class="title"><b>Procedure 1.1. Customizing the schema</b></p><ol class="1"><li><p class="title"><b>Set the length, precision, and scale of mapping elements.</b></p><p>
            Many Hibernate mapping elements define optional attributes named <code class="option">length</code>,
            <code class="option">precision</code>, and <code class="option">scale</code>.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;zip&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">length</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;balance&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">precision</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;12&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">scale</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set the <code class="option">not-null</code>, <code class="option">UNIQUE</code>, <code class="option">unique-key</code> attributes.</b></p><p>
            The <code class="option">not-null</code> and <code class="option">UNIQUE</code> attributes generate constraints on table columns.
          </p><p>
            The unique-key attribute groups columns in a single, unique key constraint. Currently, the specified value
            of the unique-key attribute does not name the constraint in the generated DDL. It only groups the columns in
            the mapping file.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">many-to-one</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;barId&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">not-null</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">element</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;serialNumber&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;long&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">not-null</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">unique</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">many-to-one</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;orgId&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">unique-key</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;OrgEmployeeId&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;employeeId&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">unique-key</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;OrgEmployee&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set the <code class="option">index</code> and <code class="option">foreign-key</code> attributes.</b></p><p>
            The <code class="option">index</code> attribute specifies the name of an index for Hibernate to create using the mapped
            column or columns. You can group multiple columns into the same index by assigning them the same index name.
          </p><p>
            A foreign-key attribute overrides the name of any generated foreign key constraint.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">many-to-one</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;barId&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">foreign-key</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;FKFooBar&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set child <code class="option">&lt;column&gt;</code> elements.</b></p><p>
            Many mapping elements accept one or more child &lt;column&gt; elements. This is particularly useful for
            mapping types involving multiple columns.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;name&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;my.customtypes.Name&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;last&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">not-null</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">index</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar_idx&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">length</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;30&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;first&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">not-null</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">index</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar_idx&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">length</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;20&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;initial&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set the <code class="option">default</code> attribute.</b></p><p>
            The <code class="option">default</code> attribute represents a default value for a column. Assign the same value to the
            mapped property before saving a new instance of the mapped class.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;credits&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;integer&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">insert</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;credits&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">default</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;version&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;integer&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">insert</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;version&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">default</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set the <code class="option">sql-type</code> attribure.</b></p><p>
            Use the <code class="option">sql-type</code> attribute to override the default mapping of a Hibernate type to SQL
            datatype.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;balance&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;float&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;balance&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">sql-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;decimal(13,3)&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Set the <code class="option">check</code> attribute.</b></p><p>
            use the <code class="option">check</code> attribute to specify a <em class="wordasword">check</em> constraint.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;integer&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">column</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">check</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;10</span><span class="xml_attribute_value">&quot;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&lt;/</span><span class="xml_attribute_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">table</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foos&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">check</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_plain">&nbsp;100.0</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;float&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p class="title"><b>Add &lt;comment&gt; elements to your schema.</b></p><p>
            Use the &lt;comment&gt; element to specify comments for the generated schema.
          </p><pre xmlns="" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">class</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Customer&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">table</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;CurCust&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">comment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Current&nbsp;customers&nbsp;only</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">comment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e900"/>1.4.2. Running the SchemaExport tool</h3></div></div></div><p>
        The SchemaExport tool writes a DDL script to standard output, executes the DDL statements, or both.
      </p><div class="example"><a id="d0e905"/><p class="title"><b>Example 1.6. SchemaExport syntax</b></p><div class="example-contents"><pre class="screen">
          java -cp hibernate_classpaths org.hibernate.tool.hbm2ddl.SchemaExport <em class="replaceable"><code>options</code></em> <em class="replaceable"><code>mapping_files</code></em> 
        </pre></div></div><br class="example-break"/><div class="table"><a id="d0e916"/><p class="title"><b>Table 1.4. SchemaExport Options</b></p><div class="table-contents"><table summary="SchemaExport Options" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>--quiet</td><td>do not output the script to standard output</td></tr><tr><td>--drop</td><td>only drop the tables</td></tr><tr><td>--create</td><td>only create the tables</td></tr><tr><td>--text</td><td>do not export to the database</td></tr><tr><td><p>--output=<em class="replaceable"><code>my_schema.ddl</code></em></p></td><td>output the ddl script to a file</td></tr><tr><td><p>--naming=<em class="replaceable"><code>eg.MyNamingStrategy</code></em></p></td><td>select a NamingStrategy</td></tr><tr><td><p>--config=<em class="replaceable"><code>hibernate.cfg.xml</code></em></p></td><td>read Hibernate configuration from an XML file</td></tr><tr><td><p>--properties=<em class="replaceable"><code>hibernate.properties</code></em></p></td><td>read database properties from a file</td></tr><tr><td>--format</td><td>format the generated SQL nicely in the script</td></tr><tr><td><p>--delimiter=<em class="replaceable"><code>;</code></em></p></td><td>set an end-of-line delimiter for the script</td></tr></tbody></table></div></div><br class="table-break"/><div class="example"><a id="d0e994"/><p class="title"><b>Example 1.7. Embedding SchemaExport into your application</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Configuration</span><!-- <br/> --><span class="java_plain">&nbsp;cfg&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">....;</span>
<!--  --><br/><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SchemaExport</span><span class="java_separator">(</span><span class="java_plain">cfg</span><span class="java_separator">).</span><span class="java_plain">create</span><span class="java_separator">(</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e999"/>Chapter 2. Transactions and concurrency control</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1002">2.1. Defining Transaction</a></span></dt><dt><span class="section"><a href="#d0e1020">2.2. Physical Transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1053">2.2.1. Physical Transactions - JDBC</a></span></dt><dt><span class="section"><a href="#d0e1067">2.2.2. Physical Transactions - JTA</a></span></dt><dt><span class="section"><a href="#d0e1085">2.2.3. Physical Transactions - CMT</a></span></dt><dt><span class="section"><a href="#d0e1103">2.2.4. Physical Transactions - Custom</a></span></dt><dt><span class="section"><a href="#d0e1127">2.2.5. Physical Transactions - Legacy</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1160">2.3. Hibernate Transaction Usage</a></span></dt><dt><span class="section"><a href="#d0e1176">2.4. Transaction Scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#session-per-operation">2.4.1. Session-per-operation</a></span></dt><dt><span class="section"><a href="#d0e1196">2.4.2. Session-per-request</a></span></dt><dt><span class="section"><a href="#long-conversations">2.4.3. Conversations</a></span></dt><dt><span class="section"><a href="#d0e1325">2.4.4. Object identity</a></span></dt><dt><span class="section"><a href="#transaction-antipatterns">2.4.5. Problems and anti-patterns</a></span></dt></dl></dd><dt><span class="section"><a href="#hibernate-transaction-api">2.5. Hibernate Transaction API (JTA)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1448">2.5.1. Bean-managed transactions (BMT)</a></span></dt><dt><span class="section"><a href="#d0e1470">2.5.2. Container-managed transactions (CMT)</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1002"/>2.1. Defining Transaction</h2></div></div></div><p>
            It is important to understand that the term transaction has many related, yet different meanings in regards
            to persistence and Object/Relational Mapping.  In most use cases these definitions align, but that is not
            always the case.
        </p><div class="itemizedlist"><ul><li><p>
                    It might refer to the physical transaction with the database.
                </p></li><li><p>
                    It might refer to the logical notion of a transaction as related to a persistence context.
                </p></li><li><p>
                    It might refer to the application notion of a Unit-of-Work, as defined by the archetypal pattern.
                </p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
                This documentation largely treats the physical and logic notions of transaction as one-in-the-same.
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1020"/>2.2. Physical Transactions</h2></div></div></div><p>
            Hibernate uses the JDBC API for persistence.  In the world of Java there are 2 well defined mechanism
            for dealing with transactions in JDBC: JDBC, itself, and JTA.  Hibernate supports both mechanisms for
            integrating with transactions and allowing applications to manage physical transactions.
        </p><p>
            The first concept in understanding Hibernate transaction support is the
            <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code> interface which
            serves 2 main functions:
        </p><div class="itemizedlist"><ul><li><p>
                    It allows Hibernate to understand the transaction semantics of the environment.  Are we operating
                    in a JTA environment?  Is a physical transaction already currently active?  etc.
                </p></li><li><p>
                    It acts as a factory for <code class="interfacename">org.hibernate.Transaction</code> instances which
                    are used to allow applications to manage and check the state of transactions.
                    <code class="interfacename">org.hibernate.Transaction</code> is Hibernate's notion of a logical
                    transaction.  JPA has a similar notion in the
                    <code class="interfacename">javax.persistence.EntityTransaction</code> interface.
                </p></li></ul></div><p>
            <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code> is a standard
            Hibernate service.  See <a href="#services-TransactionFactory" title="7.5.16. org.hibernate.engine.transaction.spi.TransactionFactory">Section 7.5.16, “<code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code>”</a> for details.
        </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1053"/>2.2.1. Physical Transactions - JDBC</h3></div></div></div><p>
                JDBC-based transaction management leverages the JDBC defined methods
                <code class="methodname">java.sql.Connection.commit()</code> and
                <code class="methodname">java.sql.Connection.rollback()</code> (JDBC does not define and explicit
                method of beginning a transaction).  In Hibernate, this approach is represented by the
                <code class="classname">org.hibernate.engine.transaction.internal.jdbc.JdbcTransactionFactory</code> class.
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1067"/>2.2.2. Physical Transactions - JTA</h3></div></div></div><p>
                JTA-based transaction management leverages the JTA
                <code class="interfacename">javax.transaction.TransactionManager</code> interface as obtained from
                <code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code> API.  This approach
                is represented by the
                <code class="classname">org.hibernate.engine.transaction.internal.jta.JtaTransactionFactory</code> class.
            </p><p>
                See <a href="#services-JtaPlatform" title="7.5.9. org.hibernate.service.jta.platform.spi.JtaPlatform">Section 7.5.9, “<code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code>”</a> for information on integration with the underlying JTA
                system.
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1085"/>2.2.3. Physical Transactions - CMT</h3></div></div></div><p>
                CMT-based transaction management leverages the
                <code class="interfacename">javax.transaction.UserTransaction</code> interface as obtained from
                <code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code> API.  This approach
                is represented by the
                <code class="classname">org.hibernate.engine.transaction.internal.jta.CMTTransactionFactory</code> class.
            </p><p>
                See <a href="#services-JtaPlatform" title="7.5.9. org.hibernate.service.jta.platform.spi.JtaPlatform">Section 7.5.9, “<code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code>”</a> for information on integration with the underlying JTA
                system.
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1103"/>2.2.4. Physical Transactions - Custom</h3></div></div></div><p>
                Its is also possible to plug in ones own transaction approach by implementing the
                <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code> contract.
                The default service initiator has built-in support for understanding custom transaction approaches
                via the <code class="literal">hibernate.transaction.factory_class</code> which can name either:
            </p><div class="itemizedlist"><ul><li><p>
                        The instance of <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code>
                        to use.
                    </p></li><li><p>
                        The name of a class implementing
                        <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code>
                        to use.  The expectation is that the implementation class have a no-argument constructor.
                    </p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1127"/>2.2.5. Physical Transactions - Legacy</h3></div></div></div><p>
                During development of 4.0, most of these classes named here were moved to new packages.  To help
                facilitate upgrading, Hibernate will also recognize the legacy names here for a short period of time.
            </p><div class="itemizedlist"><ul><li><p>
                        <code class="literal">org.hibernate.transaction.JDBCTransactionFactory</code> is mapped to
                        <code class="classname">org.hibernate.engine.transaction.internal.jdbc.JdbcTransactionFactory</code>
                    </p></li><li><p>
                        <code class="literal">org.hibernate.transaction.JTATransactionFactory</code> is mapped to
                        <code class="classname">org.hibernate.engine.transaction.internal.jta.JtaTransactionFactory</code>
                    </p></li><li><p>
                        <code class="literal">org.hibernate.transaction.CMTTransactionFactory</code> is mapped to
                        <code class="classname">org.hibernate.engine.transaction.internal.jta.CMTTransactionFactory</code>
                    </p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1160"/>2.3. Hibernate Transaction Usage</h2></div></div></div><p>
            Hibernate uses JDBC connections and JTA resources directly, without adding any additional locking behavior.
            It is important for you to become familiar with the JDBC, ANSI SQL, and transaction isolation specifics
            of your database management system.
        </p><p>
            Hibernate does not lock objects in memory.  The behavior defined by the isolation level of your database
            transactions does not change when you use Hibernate.  The Hibernate
            <code class="interfacename">org.hibernate.Session</code> acts as a transaction-scoped cache providing
            repeatable reads for lookup by identifier and entity queries and not-reporting queries that return scalar
            values.
        </p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
            To reduce lock contention in the database, a database transaction needs to be as short as possible.  Long
            database transactions prevent your application from scaling to a highly-concurrent load.  Do not hold a
            database transaction open during end-user-level work, but open it after the end-user-level work is finished.
            This is concept is referred to as <code class="literal">transactional write-behind</code>.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1176"/>2.4. Transaction Scopes</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="session-per-operation"/>2.4.1. Session-per-operation</h3></div><div><h4 class="subtitle">Anti-patterns to avoid</h4></div></div></div><p>
        <em class="firstterm">Session-per-operation</em> refers to the anti-pattern of opening and closing a
        <code class="classname">Session</code> for each database call in a single thread. It is also an anti-pattern in terms of
        database transactions. Group your database calls into a planned sequence. In the same way, do not auto-commit
        after every SQL statement in your application. Hibernate disables, or expects the application server to disable,
        auto-commit mode immediately. Database transactions are never optional. All communication with a database must
        be encapsulated by a transaction. Avoid auto-commit behavior for reading data, because many small transactions
        are unlikely to perform better than one clearly-defined unit of work, and are more difficult to maintain and
        extend.
      </p><p>
        For more anti-patterns to avoid, see <a href="#transaction-antipatterns" title="2.4.5. Problems and anti-patterns">Section 2.4.5, “Problems and anti-patterns”</a>.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1196"/>2.4.2. Session-per-request</h3></div><div><h4 class="subtitle">The typical desired pattern</h4></div></div></div><p>
        The most common pattern in a multi-user client/server application is
        <em class="firstterm">session-per-request</em>. In this model, a client sends a request to the server, where the
        Hibernate persistence layer is running. Hibernate opens a new Session, and all database operations are executed
        in this unit of work. After the work is completed, and the server prepares the response for the client, the
        session is flushed and closed. Use a single database transaction to serve the clients request, starting and
        committing it when you open and close the Session. The relationship between the transaction and the Session is
        one-to-one.
      </p><p>
        Hibernate provides built-in management of the <em class="firstterm">current session</em> to
        simplify the session-per-request pattern. Start a transaction to process a server request, and end the transaction
        before sending the response to the client. Common solutions include:
      </p><div class="itemizedlist"><ul><li><p>
            ServletFilter
          </p></li><li><p>
            AOP interceptor with a pointcut on the service methods
          </p></li><li><p>
            A proxy/interception container
          </p></li></ul></div><p>
        An EJB container is a standardized way to implement cross-cutting aspects such as transaction demarcation on EJB
        session beans in a declarative manner with CMT. If you prefer programmatic transaction demarcation, see
          <a href="#hibernate-transaction-api" title="2.5. Hibernate Transaction API (JTA)">Section 2.5, “Hibernate Transaction API (JTA)”</a>.
      </p><p>
        To access a current session to process the request, call method
        <code class="methodname">sessionFactory.getCurrentSession()</code>. The returned <code class="classname">Session</code> is
        scoped to the current database transaction. You need to configure this for either resource-local or JTA
        environments
      </p><p>
        You can extend the scope of a <code class="classname">Session</code> and database transaction until the view is
        rendered. This is especially useful in servlet applications that include a separate rendering phase after the
        request is processed. To extending the database transaction until view rendering, implement your own
        interceptor. This implementation is difficult if you rely on EJBs with container-managed transactions. A
        transaction is completed when an EJB method returns, before rendering of any view can start. Search the
        Hibernate forums for tips and examples relating to this <span>Open Session in View</span> pattern.
      </p><p>
        If <span>session-per-request</span> does not seem well-suited for your application, refer to <a href="#long-conversations" title="2.4.3. Conversations">Section 2.4.3, “Conversations”</a> for another choice.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="long-conversations"/>2.4.3. Conversations</h3></div><div><h4 class="subtitle">An alternate pattern to <span>session-per-request</span></h4></div></div></div><p>
        The <span>session-per-request</span> pattern is not the only way of designing units of work. Many business
        processes require a whole series of interactions with the user that are interleaved with database accesses. In web
        and enterprise applications, it is not acceptable for a database transaction to span a user interaction. Consider
        the following example:
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1260"/><p class="title"><b>Procedure 2.1. An example of a long-running conversation</b></p><ol class="1"><li><p>
            The first screen of a dialog opens. The data seen by the user is loaded in a particular
            <code class="classname">Session</code> and database transaction. The user is free to modify the objects.
          </p></li><li><p>
            The user uses a UI element to save their work after five minutes of editing. The modifications are made
            persistent. The user also expects to have exclusive access to the data during the edit session.
          </p></li></ol></div><p>
        From the point of view of the user, this unit of work is a long-running conversation or application
        transaction. There are many ways to implement this in your application.
      </p><p>
        A first naive implementation might keep the <code class="classname">Session</code> and database transaction open while the
        user is editing, using database-level locks to prevent other users from modifying the same data and to guarantee
        isolation and atomicity. This is an anti-pattern, because lock contention is a bottleneck which will prevent
        scalability in the future.
      </p><p>
        Several database transactions are used to implement the conversation. In this case, maintaining isolation
        of business processes becomes the partial responsibility of the application tier. A single conversation usually
        spans several database transactions. It is atomic if only one of these database transactions, typically the last one,
        stores the updated data. All others only read data. A common way to receive this data is through a wizard-style
        dialog spanning several request/response cycles. Hibernate includes some features which make this easy to implement.
      </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
                <p>
                  Automatic Versioning
                </p>
              </td><td>
                <p>
                  Hibernate can perform automatic optimistic concurrency control for you. It can automatically detect if a
                  concurrent modification occurred during user think time. Check for this at the end of the conversation.
                </p>
              </td></tr><tr><td>
                <p>
                  Detached Objects
                </p>
              </td><td>
                <p>
                  If you decide to use the session-per-request pattern, all loaded instances will be in
                  the detached state during user think time. Hibernate allows you to reattach the objects and persist the
                  modifications. The pattern is called session-per-request-with-detached-objects. Automatic versioning is
                  used to isolate concurrent modifications.
                </p>
              </td></tr><tr><td>
                <p>
                  Extended (or Long) Session
                </p>
              </td><td>
                <p>
                  Extended (or Long) Session: the Hibernate Session can be disconnected from the underlying JDBC
                  connection after the database transaction has been committed and reconnected when a new client request
                  occurs. This pattern is known as session-per-conversation and makes even reattachment
                  unnecessary. Automatic versioning is used to isolate concurrent modifications and the Session will not
                  be allowed to be flushed automatically, but explicitly.
                </p>
              </td></tr></tbody></table></div><p>
        <span>Session-per-request-with-detached-objects</span> and <span>session-per-conversation</span> each have
        advantages and disadvantages.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1325"/>2.4.4. Object identity</h3></div></div></div><p>
        An application can concurrently access the same persistent state in two different Sessions. However, an instance
        of a persistent class is never shared between two <code class="classname">Session</code> instances. Therefore, two
        different notions of identity exist: Database identity and JVM identity.
      </p><div class="example"><a id="d0e1333"/><p class="title"><b>Example 2.1. Database identity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">foo</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getId</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">equals</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;bar</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getId</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e1338"/><p class="title"><b>Example 2.2. JVM identity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">foo</span><!-- <br/> --><span class="java_operator">==</span><!-- <br/> --><span class="java_plain">bar</span></pre></div></div><br class="example-break"/><p>
        For objects attached to a particular Session, the two notions are equivalent, and JVM identity for database
        identity is guaranteed by Hibernate. The application might concurrently access a business object with the same
        identity in two different sessions, the two instances are actually different, in terms of JVM
        identity. Conflicts are resolved using an optimistic approach and automatic versioning at flush/commit time.
      </p><p>
        This approach places responsibility for concurrency on Hibernate and the database. It also provides the best
        scalability, since expensive locking is not needed to guarantee identity in single-threaded units of work. The
        application does not need to synchronize on any business object, as long as it maintains a single thread per
        <code class="classname">Session</code>. Within a <code class="classname">Session</code> the application can safely use the
        <code class="literal">==</code> operator to compare objects.
      </p><p>
        However, an application that uses the <code class="literal">==</code> operator outside of a <code class="classname">Session</code>
        may introduce problems.. If you put two detached instances into the same <code class="classname">Set</code>, they might
        use the same database identity, which means they represent the same row in the database. They would not be
        guaranteed to have the same JVM identity if they are in a detached state. Override the
        <code class="methodname">equals</code> and <code class="methodname">hashCode</code> methods in persistent classes, so that
        they have their own notion of object equality. Never use the database identifier to implement equality. Instead,
        use a business key that is a combination of unique, typically immutable, attributes. The database identifier
        changes if a transient object is made persistent. If the transient instance, together with detached instances,
        is held in a <code class="classname">Set</code>, changing the hash-code breaks the contract of the
        <code class="classname">Set</code>. Attributes for business keys can be less stable than database primary keys. You only
        need to guarantee stability as long as the objects are in the same <code class="classname">Set</code>.This is not a
        Hibernate issue, but relates to Java's implementation of object identity and equality.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="transaction-antipatterns"/>2.4.5. Problems and anti-patterns</h3></div></div></div><p>
        Avoid the anti-patterns session-per-user-session or session-per-application, for the most part. The reasons are
        outlined in <a href="#session-per-operation" title="2.4.1. Session-per-operation">Section 2.4.1, “Session-per-operation”</a>. In addition, keep the following points in mind when
        choosing patterns for your application.
      </p><div class="variablelist"><dl><dt><span class="term">A <code class="classname">Session</code> is not thread-safe.</span></dt><dd><p>
              Resources, such as HTTP requests, session beans, or Swing workers, cause race conditions if a
              <code class="classname">Session</code> instance is shared. If you keep your Hibernate
              <code class="classname">Session</code> in your <code class="classname">HttpSession</code>, consider synchronizing access
              to your <code class="classname">Http</code> session. Otherwise, a reloaded application may use the same
              <code class="classname">Session</code> in two concurrently-running threads.
            </p></dd><dt><span class="term">If Hibernate throws an exception, you must rollback your database transaction and close the
          <code class="classname">Session</code> immediately.</span></dt><dd><p>
              In addition to the above, if your Session is bound to the application, you must stop the
              application. Rolling back the database transaction does not put your business objects back into their
              state at the start of the transaction. The database state and the business objects will be out of
              sync. Since exceptions are not recoverable, this is typically not a problem. You must start over after
              rollback anyway.
            </p></dd><dt><span class="term">The Session caches every object that is in a persistent state.</span></dt><dd><p>
              A persistent state refers to objects that are watched and checked for dirty state by Hibernate. If you
              keep the cache open for a long time or load too much data, it grows to fill available memory, causing an
              OutOfMemoryException.
            </p><p>
              To solve this problem, you can call <code class="methodname">clear()</code> and <code class="methodname">evict()</code>
              to manage the <code class="classname">Session</code> cache. Alternately, you can use a Stored Procedure if you
              need mass data operations. Keeping a <code class="classname">Session</code> open for the duration of a user
              session reduces the probability of stale data.
            </p></dd></dl></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="hibernate-transaction-api"/>2.5. Hibernate Transaction API (JTA)</h2></div></div></div><p>
      If your persistence layer runs in an application server, such as behind EJB session beans, every datasource
      connection obtained by Hibernate is automatically part of the global JTA transaction. You can also install a
      standalone JTA implementation and use it without EJB. Hibernate offers two strategies for JTA integration.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1448"/>2.5.1. Bean-managed transactions (BMT)</h3></div></div></div><p>
        If you use bean-managed transactions (BMT), Hibernate tells the application server to start and end a BMT
        transaction if you use the Transaction API. The transaction management code is identical to the non-managed
        environment.
      </p><div class="example"><a id="d0e1453"/><p class="title"><b>Example 2.3. BMT idiom</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;BMT&nbsp;idiom</span>
<!--  --><br/><span class="java_type">Session</span><span class="java_plain">&nbsp;sess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">openSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;sess</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;some&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">RuntimeException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">tx&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;tx</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;e</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;display&nbsp;error&nbsp;message</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">finally</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;sess</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>
        Alternately, you can use a transaction-bound Session. If you need the
        <code class="methodname">getCurrentSession()</code> functionality for easy context propagation, use the JTA
        UserTransaction API directly.
      </p><div class="example"><a id="d0e1463"/><p class="title"><b>Example 2.4. BMT idiom with <code class="methodname">getCurrentSession()</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;BMT&nbsp;idiom&nbsp;with&nbsp;getCurrentSession</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">UserTransaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">UserTransaction</span><span class="java_separator">)</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">InitialContext</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">lookup</span><span class="java_separator">(</span><span class="java_literal">&quot;java:comp/UserTransaction&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tx</span><span class="java_separator">.</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Do</span><span class="java_plain">&nbsp;some&nbsp;work&nbsp;on&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;bound&nbsp;to&nbsp;transaction</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getCurrentSession</span><span class="java_separator">().</span><span class="java_plain">load</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getCurrentSession</span><span class="java_separator">().</span><span class="java_plain">persist</span><span class="java_separator">(...);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">RuntimeException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tx</span><span class="java_separator">.</span><span class="java_plain">rollback</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;e</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;display&nbsp;error&nbsp;message</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1470"/>2.5.2. Container-managed transactions (CMT)</h3></div></div></div><p>
        With CMT, transaction demarcation is declared in session bean deployment descriptors, rather than performed in
          a programmatic manner.  This reduces the amount of code.
      </p><div class="example"><a id="d0e1475"/><p class="title"><b>Example 2.5. CMT idiom</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;CMT&nbsp;idiom</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;sess&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getCurrentSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;some&nbsp;work</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</pre></div></div><br class="example-break"/><p>
        In a CMT/EJB, rollback happens automatically as well. An unhandled <code class="systemitem">RuntimeException</code>
        thrown by a session bean method tells the container to set the global transaction to rollback. You do not need
        to intervene, and you get automatic propagation of the <code class="classname">Current</code>
        <code class="classname">Session</code> bound to the transaction.
      </p><p>
        When configuring Hibernate's transaction factory, choose
        <code class="classname">org.hibernate.transaction.JTATransactionFactory</code> if you use JTA directly (BMT), and
        <code class="classname">org.hibernate.transaction.CMTTransactionFactory</code> in a CMT session bean. Set the
        <code class="varname">hibernate.transaction.manager_lookup_class</code> property as well. Ensure that your
        <code class="classname">hibernate.current_session_context_class</code> is either unset, or is set to
        <code class="literal">jta</code>.
      </p><p>
        The <code class="methodname">getCurrentSession()</code> method has one downside in a JTA environment. If you use it,
        after_statement connection release mode is also used by default. Due to a limitation of the JTA specification,
        Hibernate cannot automatically clean up any unclosed <code class="classname">ScrollableResults</code> or
        <code class="classname">Iterator</code> instances returned by <code class="methodname">scroll()</code> or
        <code class="methodname">iterate()</code>. Release the underlying database cursor by calling
        <code class="methodname">ScrollableResults.close()</code> or <code class="methodname">Hibernate.close(Iterator)</code>
        explicitly from a <code class="systemitem">finally</code> block. Try to avoid using <code class="methodname">scroll()</code>
        or <code class="methodname">iterate()</code> from the JTA or CMT code.
      </p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1540"/>Chapter 3. Persistence Contexts</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1602">3.1. Making entities persistent</a></span></dt><dt><span class="section"><a href="#d0e1660">3.2. Deleting entities</a></span></dt><dt><span class="section"><a href="#d0e1686">3.3. Obtain an entity reference without initializing its data</a></span></dt><dt><span class="section"><a href="#d0e1702">3.4. Obtain an entity with its data initialized</a></span></dt><dt><span class="section"><a href="#d0e1716">3.5. Refresh entity state</a></span></dt><dt><span class="section"><a href="#d0e1737">3.6. Modifying managed/persistent state</a></span></dt><dt><span class="section"><a href="#d0e1749">3.7. Working with detached data</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1756">3.7.1. Reattaching detached data</a></span></dt><dt><span class="section"><a href="#d0e1799">3.7.2. Merging detached data</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1818">3.8. Checking persistent state</a></span></dt><dt><span class="section"><a href="#d0e1850">3.9. Accessing Hibernate APIs from JPA</a></span></dt></dl></div><p>
        Both the <code class="interfacename">org.hibernate.Session</code> API and
        <code class="interfacename">javax.persistence.EntityManager</code> API represent a context for dealing with
        persistent data.  This concept is called a <code class="literal">persistence context</code>.  Persistent data has a
        state in relation to both a persistence context and the underlying database.
    </p><div class="itemizedlist"><p class="title"><b>Entity states</b></p><ul><li><p>
                <code class="literal">new</code>, or <code class="literal">transient</code> - the entity has just been instantiated and is
                not associated with a persistence context.  It has no persistent representation in the database and no
                identifier value has been assigned.
            </p></li><li><p>
                <code class="literal">managed</code>, or <code class="literal">persistent</code> - the entity has an associated identifier
                and is associated with a persistence context.
            </p></li><li><p>
                <code class="literal">detached</code> - the entity has an associated identifier, but is no longer associated with
                a persistence context (usually because the persistence context was closed or the instance was evicted
                from the context)
            </p></li><li><p>
                <code class="literal">removed</code> - the entity has an associated identifier and is associated with a persistence
                context, however it is scheduled for removal from the database.
            </p></li></ul></div><p>
        In Hibernate native APIs, the persistence context is defined as the
        <code class="interfacename">org.hibernate.Session</code>.  In JPA, the persistence context is defined by
        <code class="interfacename">javax.persistence.EntityManager</code>.  Much of the
        <code class="interfacename">org.hibernate.Session</code> and
        <code class="interfacename">javax.persistence.EntityManager</code> methods deal with moving entities between these
        states.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1602"/>3.1. Making entities persistent</h2></div></div></div><p>
            Once you've created a new entity instance (using the standard <code class="literal">new</code> operator) it is in
            <code class="literal">new</code> state.   You can make it persistent by associating it to either a
            <code class="interfacename">org.hibernate.Session</code> or
            <code class="interfacename">javax.persistence.EntityManager</code>
        </p><div class="example"><a id="d0e1619"/><p class="title"><b>Example 3.1. Example of making an entity persistent</b></p><div class="example-contents"><pre class="programlisting">
DomesticCat fritz = new DomesticCat();
fritz.setColor(Color.GINGER);
fritz.setSex('M');
fritz.setName("Fritz");
session.save(fritz);
            </pre><pre class="programlisting">
DomesticCat fritz = new DomesticCat();
fritz.setColor(Color.GINGER);
fritz.setSex('M');
fritz.setName("Fritz");
entityManager.persist(fritz);
            </pre></div></div><br class="example-break"/><p>
            <code class="interfacename">org.hibernate.Session</code> also has a method named <code class="methodname">persist</code>
            which follows the exact semantic defined in the JPA specification for the <code class="methodname">persist</code>
            method.  It is this method on <code class="interfacename">org.hibernate.Session</code> to which the
            Hibernate <code class="interfacename">javax.persistence.EntityManager</code> implementation delegates.
        </p><p>
            If the <code class="classname">DomesticCat</code> entity type has a generated identifier, the value is associated
            to the instance when the <code class="methodname">save</code> or <code class="methodname">persist</code> is called.  If the
            identifier is not automatically generated, the application-assigned (usually natural) key value has to be
            set on the instance before <code class="methodname">save</code> or <code class="methodname">persist</code> is called.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1660"/>3.2. Deleting entities</h2></div></div></div><p>
            Entities can also be deleted.
        </p><div class="example"><a id="d0e1665"/><p class="title"><b>Example 3.2. Example of deleting an entity</b></p><div class="example-contents"><pre class="programlisting">
session.delete( anAuthor );
            </pre><pre class="programlisting">
entityManager.remove( anAuthor );
            </pre></div></div><br class="example-break"/><p>
            It is important to note that Hibernate itself can handle deleting detached state.  JPA, however, disallows
            it.  The implication here is that the entity instance passed to the
            <code class="interfacename">org.hibernate.Session</code> <code class="methodname">delete</code> method can be either
            in managed or detached state, while the entity instance passed to <code class="methodname">remove</code> on
            <code class="interfacename">javax.persistence.EntityManager</code> must be in managed state.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1686"/>3.3. Obtain an entity reference without initializing its data</h2></div></div></div><p>
            Sometimes referred to as lazy loading, the ability to obtain a reference to an entity without having to
            load its data is hugely important.  The most common case being the need to create an association between
            an entity and another, existing entity.
        </p><div class="example"><a id="d0e1691"/><p class="title"><b>Example 3.3. Example of obtaining an entity reference without initializing its data</b></p><div class="example-contents"><pre class="programlisting">
Book book = new Book();
book.setAuthor( session.load( Author.class, authorId ) );
            </pre><pre class="programlisting">
Book book = new Book();
book.setAuthor( entityManager.getReference( Author.class, authorId ) );
            </pre></div></div><br class="example-break"/><p>
            The above works on the assumption that the entity is defined to allow lazy loading, generally through
            use of runtime proxies.  For more information see <a href="#devguide-mappingEntities" title="Chapter 9. Mapping entities">Chapter 9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping entities</i></a>.  In both
            cases an exception will be thrown later if the given entity does not refer to actual database state if and
            when the application attempts to use the returned proxy.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1702"/>3.4. Obtain an entity with its data initialized</h2></div></div></div><p>
            It is also quite common to want to obtain an entity along with with its data, for display for example.
        </p><div class="example"><a id="d0e1707"/><p class="title"><b>Example 3.4. Example of obtaining an entity reference with its data initialized</b></p><div class="example-contents"><pre class="programlisting">
return session.get( Author.class, authorId );
            </pre><pre class="programlisting">
return entityManager.find( Author.class, authorId );
            </pre></div></div><br class="example-break"/><p>
            In both cases null is returned if no matching database row was found.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1716"/>3.5. Refresh entity state</h2></div></div></div><p>
            You can reload an entity instance and it's collections at any time.
        </p><div class="example"><a id="d0e1721"/><p class="title"><b>Example 3.5. Example of refreshing entity state</b></p><div class="example-contents"><pre class="programlisting">
Cat cat = session.get( Cat.class, catId );
...
session.refresh( cat );
            </pre><pre class="programlisting">
Cat cat = entityManager.find( Cat.class, catId );
...
entityManager.refresh( cat );
            </pre></div></div><br class="example-break"/><p>
            One case where this is useful is when it is known that the database state has changed since the data was
            read.  Refreshing allows the current database state to be pulled into the entity instance and the
            persistence context.
        </p><p>
            Another case where this might be useful is when database triggers are used to initialize some of the
            properties of the entity.  Note that only the entity instance and its collections are refreshed unless you
            specify <code class="literal">REFRESH</code> as a cascade style of any associations.  However, please note that
            Hibernate has the capability to handle this automatically through its notion of generated properties.
            See <a href="#devguide-mappingEntities" title="Chapter 9. Mapping entities">Chapter 9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping entities</i></a> for information.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1737"/>3.6. Modifying managed/persistent state</h2></div></div></div><p>
            Entities in managed/persistent state may be manipulated by the application and any changes will be
            automatically detected and persisted when the persistence context is flushed. There is no need to call a
            particular method to make your modifications persistent.
        </p><div class="example"><a id="d0e1742"/><p class="title"><b>Example 3.6. Example of modifying managed state</b></p><div class="example-contents"><pre class="programlisting">
Cat cat = session.get( Cat.class, catId );
cat.setName( "Garfield" );
session.flush(); // generally this is not explicitly needed
            </pre><pre class="programlisting">
Cat cat = entityManager.find( Cat.class, catId );
cat.setName( "Garfield" );
entityManager.flush(); // generally this is not explicitly needed
            </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1749"/>3.7. Working with detached data</h2></div></div></div><p>
            Detachment is the process of working with data outside the scope of any persistence context.  Data becomes
            detached in a number of ways.  Once the persistence context is closed, all data that was associated with it
            becomes detached.  Clearing the persistence context has the same effect.  Evicting a particular entity
            from the persistence context makes it detached.  And finally, serialization will make the deserialized form
            be detached (the original instance is still managed).
        </p><p>
            Detached data can still be manipulated, however the persistence context will no longer automatically know
            about these modification and the application will need to intervene to make the changes persistent.
        </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1756"/>3.7.1. Reattaching detached data</h3></div></div></div><p>
                Reattachment is the process of taking an incoming entity instance that is in detached state
                and re-associating it with the current persistence context.
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
                    JPA does not provide for this model.  This is only available through Hibernate
                    <code class="interfacename">org.hibernate.Session</code>.
                </p></div><div class="example"><a id="d0e1767"/><p class="title"><b>Example 3.7. Example of reattaching a detached entity</b></p><div class="example-contents"><pre class="programlisting">
    session.update( someDetachedCat );
                </pre><pre class="programlisting">
    session.saveOrUpdate( someDetachedCat );
                </pre></div></div><br class="example-break"/><p>
                The method name <code class="methodname">update</code> is a bit misleading here.  It does not mean that an
                <code class="literal">SQL</code> <code class="literal">UPDATE</code> is immediately performed.  It does, however, mean that an
                <code class="literal">SQL</code> <code class="literal">UPDATE</code> will be performed when the persistence context is flushed
                since Hibernate does not know its previous state against which to compare for changes.
            </p><p>
                Provided the entity is detached, <code class="methodname">update</code> and <code class="methodname">saveOrUpdate</code>
                operate exactly the same.
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1799"/>3.7.2. Merging detached data</h3></div></div></div><p>
                Merging is the process of taking an incoming entity instance that is in detached state and copying its
                data over onto a new instance that is in managed state.
            </p><div class="example"><a id="d0e1804"/><p class="title"><b>Example 3.8. Visualizing merge</b></p><div class="example-contents"><pre class="programlisting">
Object detached = ...;
Object managed = entityManager.find( detached.getClass(), detached.getId() );
managed.setXyz( detached.getXyz() );
...
return managed;
                </pre></div></div><br class="example-break"/><p>
                That is not exactly what happens, but its a good visualization.
            </p><div class="example"><a id="d0e1811"/><p class="title"><b>Example 3.9. Example of merging a detached entity</b></p><div class="example-contents"><pre class="programlisting">
Cat theManagedInstance = session.merge( someDetachedCat );
                </pre><pre class="programlisting">
Cat theManagedInstance = entityManager.merge( someDetachedCat );
                </pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1818"/>3.8. Checking persistent state</h2></div></div></div><p>
            An application can verify the state of entities and collections in relation to the persistence context.
        </p><div class="example"><a id="d0e1823"/><p class="title"><b>Example 3.10. Examples of verifying managed state</b></p><div class="example-contents"><pre class="programlisting">assert session.contains( cat );</pre><pre class="programlisting">assert entityManager.contains( cat );</pre></div></div><br class="example-break"/><div class="example"><a id="d0e1830"/><p class="title"><b>Example 3.11. Examples of verifying laziness</b></p><div class="example-contents"><pre class="programlisting">
if ( Hibernate.isInitialized( customer.getAddress() ) {
    //display address if loaded
}
if ( Hibernate.isInitialized( customer.getOrders ) ) {
    //display orders if loaded
}
if (Hibernate.isPropertyInitialized(customer, "detailedBio") ) {
    //display property detailedBio if loaded
}
            </pre><pre class="programlisting">
javax.persistence.PersistenceUnitUtil jpaUtil = entityManager.getEntityManagerFactory().getPersistenceUnitUtil();
if ( jpaUtil.isLoaded( customer.getAddress() ) {
    //display address if loaded
}
if ( jpaUtil.isLoaded( customer.getOrders ) ) {
    //display orders if loaded
}
if (jpaUtil.isLoaded(customer, "detailedBio") ) {
    //display property detailedBio if loaded
}
            </pre></div></div><br class="example-break"/><p>
            In JPA there is an alternative means to check laziness using the following
            <code class="interfacename">javax.persistence.PersistenceUtil</code> pattern.  However, the
            <code class="interfacename">javax.persistence.PersistenceUnitUtil</code> is recommended where ever possible
        </p><div class="example"><a id="d0e1845"/><p class="title"><b>Example 3.12. Alternative JPA means to verify laziness</b></p><div class="example-contents"><pre class="programlisting">
javax.persistence.PersistenceUtil jpaUtil = javax.persistence.Persistence.getPersistenceUtil();
if ( jpaUtil.isLoaded( customer.getAddress() ) {
    //display address if loaded
}
if ( jpaUtil.isLoaded( customer.getOrders ) ) {
    //display orders if loaded
}
if (jpaUtil.isLoaded(customer, "detailedBio") ) {
    //display property detailedBio if loaded
}
            </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1850"/>3.9. Accessing Hibernate APIs from JPA</h2></div></div></div><p>
            JPA defines an incredibly useful method to allow applications access to the APIs of the underlying provider.
        </p><div class="example"><a id="d0e1855"/><p class="title"><b>Example 3.13. Usage of EntityManager.unwrap</b></p><div class="example-contents"><pre class="programlisting">
Session session = entityManager.unwrap( Session.class );
SessionImplementor sessionImplementor = entityManager.unwrap( SessionImplementor.class );
            </pre></div></div><br class="example-break"/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1860"/>Chapter 4. Batch Processing</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1891">4.1. Batch inserts</a></span></dt><dt><span class="section"><a href="#d0e1909">4.2. Batch updates</a></span></dt><dt><span class="section"><a href="#d0e1930">4.3. StatelessSession</a></span></dt><dt><span class="section"><a href="#d0e2016">4.4. Hibernate Query Language for DML</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2036">4.4.1. HQL for UPDATE and DELETE</a></span></dt><dt><span class="section"><a href="#d0e2114">4.4.2. HQL syntax for INSERT</a></span></dt><dt><span class="section"><a href="#d0e2182">4.4.3. More information on HQL</a></span></dt></dl></dd></dl></div><p>
    The following example shows an antipattern for batch inserts.
  </p><div class="example"><a id="d0e1865"/><p class="title"><b>Example 4.1. Naive way to insert 100000 lines with Hibernate</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;i</span><span class="java_operator">=</span><span class="java_literal">0</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">&lt;</span><span class="java_literal">100000</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">++</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">(.....);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">save</span><span class="java_separator">(</span><span class="java_plain">customer</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre><p>
      This fails with exception <code class="systemitem">OutOfMemoryException</code> after around 50000 rows on most
      systems. The reason is that Hibernate caches all the newly inserted Customer instances in the session-level
      cache. There are several ways to avoid this problem.
    </p></div></div><br class="example-break"/><p>
    Before batch processing, enable JDBC batching. To enable JDBC batching, set the property
    <span class="property">hibernate.jdbc.batch_size</span> to an integer between 10 and 50.
  </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
      Hibernate disables insert batching at the JDBC level transparently if you use an identity identifier generator.
    </p></div><p>
    If the above approach is not appropriate, you can disable the second-level cache, by setting
    <span class="property">hibernate.cache.use_second_level_cache</span> to <code class="literal">false</code>.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1891"/>4.1. Batch inserts</h2></div></div></div><p>
      When you make new objects persistent, employ methods <code class="methodname">flush()</code> and
      <code class="methodname">clear()</code> to the session regularly, to control the size of the first-level cache.
    </p><div class="example"><a id="d0e1902"/><p class="title"><b>Example 4.2. Flushing and clearing the <code class="classname">Session</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;i</span><span class="java_operator">=</span><span class="java_literal">0</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">&lt;</span><span class="java_literal">100000</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">++</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">(.....);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">save</span><span class="java_separator">(</span><span class="java_plain">customer</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;i&nbsp;</span><span class="java_operator">%</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_literal">20</span><span class="java_separator">,</span><span class="java_plain">&nbsp;same&nbsp;as&nbsp;the&nbsp;JDBC&nbsp;batch&nbsp;size</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">flush&nbsp;a&nbsp;batch&nbsp;of&nbsp;inserts&nbsp;and&nbsp;release&nbsp;memory</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1909"/>4.2. Batch updates</h2></div></div></div><p>
      When you retriev and update data, <code class="methodname">flush()</code> and <code class="methodname">clear()</code> the
      session regularly.  In addition, use method <code class="methodname">scroll()</code> to take advantage of server-side
      cursors for queries that return many rows of data.
    </p><div class="example"><a id="d0e1923"/><p class="title"><b>Example 4.3. Using <code class="methodname">scroll()</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_type">ScrollableResults</span><span class="java_plain">&nbsp;customers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">getNamedQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;GetCustomers&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setCacheMode</span><span class="java_separator">(</span><span class="java_type">CacheMode</span><span class="java_separator">.</span><span class="java_plain">IGNORE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">scroll</span><span class="java_separator">(</span><span class="java_type">ScrollMode</span><span class="java_separator">.</span><span class="java_plain">FORWARD_ONLY</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;count</span><span class="java_operator">=</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">while</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;customers</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;customers</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;customer</span><span class="java_separator">.</span><span class="java_plain">updateStuff</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_operator">++</span><span class="java_plain">count&nbsp;</span><span class="java_operator">%</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">flush&nbsp;a&nbsp;batch&nbsp;of&nbsp;updates&nbsp;and&nbsp;release&nbsp;memory</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">flush</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1930"/>4.3. StatelessSession</h2></div></div></div><p>
      <code class="interfacename">StatelessSession</code> is a command-oriented API provided by Hibernate. Use it to stream
      data to and from the database in the form of detached objects. A <code class="interfacename">StatelessSession</code>
      has no persistence context associated with it and does not provide many of the higher-level life cycle
      semantics. Some of the things not provided by a <code class="interfacename">StatelessSession</code> include:
    </p><div class="itemizedlist"><p class="title"><b>Features and behaviors not provided by <code class="interfacename">StatelessSession</code></b></p><ul><li><p>
          a first-level cache
        </p></li><li><p>
          interaction with any second-level or query cache
        </p></li><li><p>
          transactional write-behind or automatic dirty checking
        </p></li></ul></div><div class="itemizedlist"><p class="title"><b>Limitations of <code class="interfacename">StatelessSession</code></b></p><ul><li><p>
          Operations performed using a stateless session never cascade to associated instances.
        </p></li><li><p>
          Collections are ignored by a stateless session.
        </p></li><li><p>
          Operations performed via a stateless session bypass Hibernate's event model and interceptors.
        </p></li><li><p>
          Due to the lack of a first-level cache, Stateless sessions are vulnerable to data aliasing effects.
        </p></li><li><p>
          A stateless session is a lower-level abstraction that is much closer to the underlying JDBC.
        </p></li></ul></div><div class="example"><a id="d0e1978"/><p class="title"><b>Example 4.4. Using a <code class="interfacename">StatelessSession</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">StatelessSession</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openStatelessSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_type">ScrollableResults</span><span class="java_plain">&nbsp;customers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">getNamedQuery</span><span class="java_separator">(</span><span class="java_literal">&quot;GetCustomers&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">scroll</span><span class="java_separator">(</span><span class="java_type">ScrollMode</span><span class="java_separator">.</span><span class="java_plain">FORWARD_ONLY</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">while</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;customers</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;customers</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;customer</span><span class="java_separator">.</span><span class="java_plain">updateStuff</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">update</span><span class="java_separator">(</span><span class="java_plain">customer</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre><p>
        The <code class="classname">Customer</code> instances returned by the query are immediately detached. They are never
        associated with any persistence context.
      </p></div></div><br class="example-break"/><p>
      The <code class="methodname">insert()</code>, <code class="methodname">update()</code>, and <code class="methodname">delete()</code>
      operations defined by the <code class="interfacename">StatelessSession</code> interface operate directly on database
      rows. They cause the corresponding SQL operations to be executed immediately.  They have different semantics from
      the <code class="methodname">save()</code>, <code class="methodname">saveOrUpdate()</code>, and
      <code class="methodname">delete()</code> operations defined by the <code class="interfacename">Session</code> interface.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2016"/>4.4. Hibernate Query Language for DML</h2></div></div></div><p>
      DML, or <em class="firstterm">Data Markup Language</em>, refers to SQL statements such as <code class="literal">INSERT</code>,
      <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>. Hibernate provides methods for bulk SQL-style DML
      statement execution, in the form of <em class="firstterm">Hibernate Query Language (HQL)</em>.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2036"/>4.4.1. HQL for UPDATE and DELETE</h3></div></div></div><div class="example"><a id="d0e2039"/><p class="title"><b>Example 4.5. Psuedo-syntax for UPDATE and DELETE statements using HQL</b></p><div class="example-contents"><pre class="screen">
          ( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?
        </pre><p>
          The <code class="literal">?</code> suffix indications an optional parameter. The <code class="literal">FROM</code> and
          <code class="literal">WHERE</code> clauses are each optional.
        </p></div></div><br class="example-break"/><p>
        The <code class="literal">FROM</code> clause can only refer to a single entity, which can be aliased. If the entity name
        is aliased, any property references must be qualified using that alias. If the entity name is not aliased, then
        it is illegal for any property references to be qualified.
      </p><p>
        Joins, either implicit or explicit, are prohibited in a bulk HQL query. You can use sub-queries in the
        <code class="literal">WHERE</code> clause, and the sub-queries themselves can contain joins.
      </p><div class="example"><a id="d0e2065"/><p class="title"><b>Example 4.6. Executing an HQL UPDATE, using the <code class="methodname">Query.executeUpdate()</code> method</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;hqlUpdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;update&nbsp;Customer&nbsp;c&nbsp;set&nbsp;c.name&nbsp;=&nbsp;:newName&nbsp;where&nbsp;c.name&nbsp;=&nbsp;:oldName&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;hqlUpdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;update&nbsp;Customer&nbsp;set&nbsp;name&nbsp;=&nbsp;:newName&nbsp;where&nbsp;name&nbsp;=&nbsp;:oldName&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;updatedEntities&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;hqlUpdate&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;newName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;newName&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;oldName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;oldName&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">executeUpdate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>
        In keeping with the EJB3 specification, HQL UPDATE statements, by default, do not effect the version or the
        timestamp property values for the affected entities. You can use a versioned update to force Hibernate to reset
        the version or timestamp property values, by adding the <code class="literal">VERSIONED</code> keyword after the
        <code class="literal">UPDATE</code> keyword.
      </p><div class="example"><a id="d0e2081"/><p class="title"><b>Example 4.7. Updating the version of timestamp</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;hqlVersionedUpdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;update&nbsp;versioned&nbsp;Customer&nbsp;set&nbsp;name&nbsp;=&nbsp;:newName&nbsp;where&nbsp;name&nbsp;=&nbsp;:oldName&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;updatedEntities&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;hqlUpdate&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;newName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;newName&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;oldName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;oldName&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">executeUpdate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
          If you use the <code class="literal">VERSIONED</code> statement, you cannot use custom version types, which use class
          <code class="classname">org.hibernate.usertype.UserVersionType</code>.
        </p></div><div class="example"><a id="d0e2095"/><p class="title"><b>Example 4.8. A HQL <code class="literal">DELETE</code> statement</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;hqlDelete&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;delete&nbsp;Customer&nbsp;c&nbsp;where&nbsp;c.name&nbsp;=&nbsp;:oldName&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;hqlDelete&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;delete&nbsp;Customer&nbsp;where&nbsp;name&nbsp;=&nbsp;:oldName&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;deletedEntities&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;hqlDelete&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setString</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;oldName&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;oldName&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">executeUpdate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>
        Method <code class="methodname">Query.executeUpdate()</code> returns an <span class="type">int</span> value, which indicates the
        number of entities effected by the operation. This may or may not correlate to the number of rows effected in
        the database. An HQL bulk operation might result in multiple SQL statements being executed, such as for
        joined-subclass. In the example of joined-subclass, a <code class="literal">DELETE</code> against one of the subclasses
        may actually result in deletes in the tables underlying the join, or further down the inheritance hierarchy.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2114"/>4.4.2. HQL syntax for INSERT</h3></div></div></div><div class="example"><a id="d0e2117"/><p class="title"><b>Example 4.9. Pseudo-syntax for INSERT statements</b></p><div class="example-contents"><pre class="screen">
          INSERT INTO EntityName <em class="replaceable"><code>properties_list</code></em> <em class="replaceable"><code>select_statement</code></em>
        </pre></div></div><br class="example-break"/><p>
        Only the <code class="literal">INSERT INTO ... SELECT ...</code> form is supported. You cannot specify explicit values to
        insert.
      </p><p>
        The <em class="replaceable"><code>properties_list</code></em> is analogous to the column specification in the <code class="literal">SQL
        INSERT</code> statement. For entities involved in mapped inheritance, you can only use properties directly
        defined on that given class-level in the <em class="replaceable"><code>properties_list</code></em>. Superclass properties are
        not allowed and subclass properties are irrelevant. In other words, <code class="literal">INSERT</code> statements are
        inherently non-polymorphic.
      </p><p>
        The <em class="replaceable"><code>select_statement</code></em> can be any valid HQL select query, but the return types must
        match the types expected by the INSERT. Hibernate verifies the return types during query compilation, instead of
        expecting the database to check it. Problems might result from Hibernate types which are equivalent, rather than
        equal. One such example is a mismatch between a property defined as an <span class="type">org.hibernate.type.DateType</span>
        and a property defined as an <span class="type">org.hibernate.type.TimestampType</span>, even though the database may not
        make a distinction, or may be capable of handling the conversion.
      </p><p>
        If <em class="replaceable"><code>id</code></em> property is not specified in the <em class="replaceable"><code>properties_list</code></em>,
        Hibernate generates a value automatically. Automatic generation is only available if you use ID generators which
        operate on the database. Otherwise, Hibernate throws an exception during parsing. Available in-database
        generators are <code class="classname">org.hibernate.id.SequenceGenerator</code> and its subclasses, and objects which
        implement <code class="interfacename">org.hibernate.id.PostInsertIdentifierGenerator</code>. The most notable
        exception is <code class="classname">org.hibernate.id.TableHiLoGenerator</code>, which does not expose a selectable way
        to get its values.
      </p><p>
        For properties mapped as either version or timestamp, the insert statement gives you two options. You can either
        specify the property in the properties_list, in which case its value is taken from the corresponding select
        expressions, or omit it from the properties_list, in which case the seed value defined by the
        org.hibernate.type.VersionType is used.
      </p><div class="example"><a id="d0e2177"/><p class="title"><b>Example 4.10. HQL INSERT statement</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;session</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;hqlInsert&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;insert&nbsp;into&nbsp;DelinquentAccount&nbsp;(id,&nbsp;name)&nbsp;select&nbsp;c.id,&nbsp;c.name&nbsp;from&nbsp;Customer&nbsp;c&nbsp;where&nbsp;...&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;createdEntities&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;hqlInsert&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">executeUpdate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2182"/>4.4.3. More information on HQL</h3></div></div></div><p>
        This section is only a brief overview of HQL. For more information, see <a href="#chap-hql" title="Chapter 11. HQL and JPAQL">Chapter 11, <i xmlns:xlink="http://www.w3.org/1999/xlink">HQL and JPAQL</i></a>.
      </p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2189"/>Chapter 5. Locking</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2223">5.1. Optimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2249">5.1.1. Dedicated version number</a></span></dt><dt><span class="section"><a href="#d0e2370">5.1.2. Timestamp</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2460">5.2. Pessimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2468">5.2.1. The <code class="classname">LockMode</code> class</a></span></dt></dl></dd></dl></div><p>
    Locking refers to actions taken to prevent data in a relational database from changing between the time it is read
    and the time that it is used.
  </p><p>
    Your locking strategy can be either <em class="firstterm">optimistic</em> or <em class="firstterm">pessimistic</em>.
  </p><div class="variablelist"><p class="title"><b>Locking strategies</b></p><dl><dt><span class="term">Optimistic</span></dt><dd><p>
          Optimistic locking ssumes that multiple transactions can complete without affecting each other, and that
          therefore transactions can proceed without locking the data resources that they affect. Before committing,
          each transaction verifies that no other transaction has modified its data. If the check reveals conflicting
          modifications, the committing transaction rolls back<sup>[<a id="d0e2211" href="#ftn.d0e2211">1</a>]</sup>.
        </p></dd><dt><span class="term">Pessimistic</span></dt><dd><p>
          Pessimistic locking assumes that concurrent transactions will conflict with each other, and requires resources
          to be locked after they are read and only unlocked after the application has finished using the data.
        </p></dd></dl></div><p>
    Hibernate provides mechanisms for implementing both types of locking in your applications.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2223"/>5.1. Optimistic</h2></div></div></div><p>
      When your application uses long transactions or conversations that span several database transactions, you can
      store versioning data, so that if the same entity is updated by two conversations, the last to commit changes is
      informed of the conflict, and does not override the other conversation's work. This approach guarantees some
      isolation, but scales well and works particularly well in <em class="firstterm">Read-Often Write-Sometimes</em>
      situations.
    </p><p>
      Hibernate provides two different mechanisms for storing versioning information, a dedicated version number or a
      timestamp.
    </p><div class="variablelist"><dl><dt><span class="term">Version number</span></dt><dd><p>

          </p></dd><dt><span class="term">Timestamp</span></dt><dd><p>

          </p></dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        A version or timestamp property can never be null for a detached instance. Hibernate detects any instance with a
        null version or timestamp as transient, regardless of other unsaved-value strategies that you specify. Declaring
        a nullable version or timestamp property is an easy way to avoid problems with transitive reattachment in
        Hibernate, especially useful if you use assigned identifiers or composite keys.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2249"/>5.1.1. Dedicated version number</h3></div></div></div><p>
        The version number mechanism for optimistic locking is provided through a <code class="literal">@Version</code>
        annotation.
      </p><div class="example"><a id="d0e2257"/><p class="title"><b>Example 5.1. The @Version annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Flight</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;OPTLOCK&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getVersion</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span></pre><p>
          Here, the version property is mapped to the <code class="literal">OPTLOCK</code> column, and the entity manager uses it
          to detect conflicting updates, and prevent the loss of updates that would be overwritten by a
          <em class="firstterm">last-commit-wins</em> strategy.
        </p></div></div><br class="example-break"/><p>
        The version column can be any kind of type, as long as you define and implement the appropriate
        <code class="classname">UserVersionType</code>.
      </p><p>
        Your application is forbidden from altering the version number set by Hibernate. To artificially increase the
        version number, see the documentation for properties
        <span class="property">LockModeType.OPTIMISTIC_FORCE_INCREMENT</span> or
        <span class="property">LockModeType.PESSIMISTIC_FORCE_INCREMENTcheck</span> in the Hibernate Entity Manager reference
        documentation.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Database-generated version numbers</h2><p>
          If the version number is generated by the database, such as a trigger, use the annotation
          <code class="literal">@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code>.
        </p></div><div class="example"><a id="d0e2291"/><p class="title"><b>Example 5.2. Declaring a version property in <code class="filename">hbm.xml</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;version_column&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;propertyName&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;typename&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">access</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;field|property|ClassName&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">unsaved-value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;null|negative|undefined&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">generated</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;never|always&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">insert</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true|false&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">node</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;element-name|@attribute-name|element/@attribute|.&quot;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>column</td><td><p>The name of the column holding the version number. Optional, defaults to the property
                name. </p></td></tr><tr><td>name</td><td><p>The name of a property of the persistent class.</p></td></tr><tr><td>type</td><td><p>The type of the version number. Optional, defaults to
                <code class="literal">integer</code>.</p></td></tr><tr><td>access</td><td><p>Hibernate's strategy for accessing the property value. Optional, defaults to
                <code class="literal">property</code>.</p></td></tr><tr><td>unsaved-value</td><td><p>Indicates that an instance is newly instantiated and thus unsaved. This distinguishes it
                from detached instances that were saved or loaded in a previous session. The default value,
                <code class="literal">undefined</code>, indicates that the identifier property value should be
                used. Optional.</p></td></tr><tr><td>generated</td><td><p>Indicates that the version property value is generated by the database. Optional, defaults
                to <code class="literal">never</code>.</p></td></tr><tr><td>insert</td><td><p>Whether or not to include the <code class="code">version</code> column in SQL <code class="code">insert</code>
                statements. Defaults to <code class="literal">true</code>, but you can set it to <code class="literal">false</code> if the
                database column is defined with a default value of <code class="literal">0</code>.</p></td></tr></tbody></table></div></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2370"/>5.1.2. Timestamp</h3></div></div></div><p>
        Timestamps are a less reliable way of optimistic locking than version numbers, but can be used by applications
        for other purposes as well. Timestamping is automatically used if you the <code class="code">@Version</code> annotation on a
        <span class="type">Date</span> or <span class="type">Calendar</span>.
      </p><div class="example"><a id="d0e2384"/><p class="title"><b>Example 5.3. Using timestamps for optimistic locking</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Flight</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Version</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;getLastUpdate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/><p>
        Hibernate can retrieve the timestamp value from the database or the JVM, by reading the value you specify for
        the <code class="code">@org.hibernate.annotations.Source</code> annotation. The value can be either
        <code class="literal">org.hibernate.annotations.SourceType.DB</code> or
        <code class="literal">org.hibernate.annotations.SourceType.VM</code>. The default behavior is to use the database, and is
        also used if you don't specify the annotation at all.
      </p><p>
        The timestamp can also be generated by the database instead of Hibernate, if you use the
        <code class="code">@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code> annotation.
      </p><div class="example"><a id="d0e2405"/><p class="title"><b>Example 5.4. The timestamp element in <code class="filename">hbm.xml</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">timestamp</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">column</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;timestamp_column&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;propertyName&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">access</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;field|property|ClassName&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">unsaved-value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;null|undefined&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">source</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;vm|db&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">generated</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;never|always&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">node</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;element-name|@attribute-name|element/@attribute|.&quot;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>column</td><td><p>The name of the column which holds the timestamp. Optional, defaults to the property
                namel</p></td></tr><tr><td>name</td><td><p>The name of a JavaBeans style property of Java type Date or Timestamp of the persistent
                class.</p></td></tr><tr><td>access</td><td><p>The strategy Hibernate uses to access the property value. Optional, defaults to
                <code class="literal">property</code>.</p></td></tr><tr><td>unsaved-value</td><td><p>A version property which indicates than instance is newly
                instantiated, and unsaved. This distinguishes it from detached instances that were saved or loaded in a
                previous session. The default value of <code class="literal">undefined</code> indicates that Hibernate uses the
                identifier property value.</p></td></tr><tr><td>source</td><td><p>Whether Hibernate retrieves the timestamp from the database or the current
                JVM. Database-based timestamps incur an overhead because Hibernate needs to query the database each time
                to determine the incremental next value. However, database-derived timestamps are safer to use in a
                clustered environment. Not all database dialects are known to support the retrieval of the database's
                current timestamp. Others may also be unsafe for locking, because of lack of precision.</p></td></tr><tr><td>generated</td><td><p>Whether the timestamp property value is generated by the database. Optional, defaults to
                <code class="literal">never</code>.</p></td></tr></tbody></table></div></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2460"/>5.2. Pessimistic</h2></div></div></div><p>
      Typically, you only need to specify an isolation level for the JDBC connections and let the database handle
      locking issues. If you do need to obtain exclusive pessimistic locks or re-obtain locks at the start of a new
      transaction, Hibernate gives you the tools you need.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        Hibernate always uses the locking mechanism of the database, and never lock objects in memory.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2468"/>5.2.1. The <code class="classname">LockMode</code> class</h3></div></div></div><p>
        The <code class="classname">LockMode</code> class defines the different lock levels that Hibernate can acquire.
      </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>LockMode.WRITE</td><td><p>acquired automatically when Hibernate updates or inserts a row.</p></td></tr><tr><td>LockMode.UPGRADE</td><td><p>acquired upon explicit user request using <code class="code">SELECT ... FOR UPDATE</code> on databases
              which support that syntax.</p></td></tr><tr><td>LockMode.UPGRADE_NOWAIT</td><td><p>acquired upon explicit user request using a <code class="code">SELECT ... FOR UPDATE NOWAIT</code> in
              Oracle.</p></td></tr><tr><td>LockMode.READ</td><td><p>acquired automatically when Hibernate reads data under <span>Repeatable Read</span> or
              <span>Serializable</span> isolation level. It can be re-acquired by explicit user
              request.</p></td></tr><tr><td>LockMode.NONE</td><td><p>The absence of a lock. All objects switch to this lock mode at the end of a
              Transaction. Objects associated with the session via a call to <code class="methodname">update()</code> or
              <code class="methodname">saveOrUpdate()</code> also start out in this lock mode. </p></td></tr></tbody></table></div><p>
        The explicit user request mentioned above occurs as a consequence of any of the following actions:
      </p><div class="itemizedlist"><ul><li><p>
            A call to <code class="methodname">Session.load()</code>, specifying a LockMode.
          </p></li><li><p>
            A call to <code class="methodname">Session.lock()</code>.
          </p></li><li><p>
            A call to <code class="methodname">Query.setLockMode()</code>.
          </p></li></ul></div><p>
        If you call <code class="methodname">Session.load()</code> with option <code class="option">UPGRADE</code> or
        <code class="option">UPGRADE_NOWAIT</code>, and the requested object is not already loaded by the session, the object is
        loaded using <code class="code">SELECT ... FOR UPDATE</code>. If you call <code class="methodname">load()</code> for an object that
        is already loaded with a less restrictive lock than the one you request, Hibernate calls
        <code class="methodname">lock()</code> for that object.
      </p><p>
        <code class="methodname">Session.lock()</code> performs a version number check if the specified lock mode is
        <code class="literal">READ</code>, <code class="literal">UPGRADE</code>, or <code class="literal">UPGRADE_NOWAIT</code>. In the case of
        <code class="literal">UPGRADE</code> or <code class="literal">UPGRADE_NOWAIT</code>, <code class="code">SELECT ... FOR UPDATE</code> syntax is
        used.
      </p><p>
        If the requested lock mode is not supported by the database, Hibernate uses an appropriate alternate mode
        instead of throwing an exception. This ensures that applications are portable.
      </p></div></div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="footnotes"><br/><hr/><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e2211" href="#d0e2211">1</a>] </sup><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Optimistic_locking">http://en.wikipedia.org/wiki/Optimistic_locking</a></p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2596"/>Chapter 6. Caching</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2599">6.1. The query cache</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2651">6.1.1. Query cache regions</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2674">6.2. Second-level cache providers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2683">6.2.1. Configuring your cache providers</a></span></dt><dt><span class="section"><a href="#caching-strategies-list">6.2.2. Caching strategies</a></span></dt><dt><span class="section"><a href="#caching-provider-table">6.2.3. Second-level cache providers for Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3066">6.3. Managing the cache</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3069">6.3.1. Moving items into and out of the cache</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2599"/>6.1. The query cache</h2></div></div></div><p>
      If you have queries that run over and over, with the same parameters, query caching provides performance gains.
    </p><p>
      Caching introduces overhead in the area of transactional processing. For example, if you cache results of a query
      against an object, Hibernate needs to keep track of whether any changes have been committed against the object,
      and invalidate the cache accordingly. In addition, the benefit from caching query results is limited, and highly
      dependent on the usage patterns of your application. For these reasons, Hibernate disables the query cache by
      default.
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2606"/><p class="title"><b>Procedure 6.1. Enabling the query cache</b></p><ol class="1"><li><p class="title"><b>Set the <span class="property">hibernate.cache.use_query_cache</span> property to <code class="literal">true</code>.</b></p><p>
          This setting creates two new cache regions:
        </p><div class="itemizedlist"><ul><li><p>
              <code class="code">org.hibernate.cache.internal.StandardQueryCache</code> holds the cached query results.
            </p></li><li><p>
              <code class="code">org.hibernate.cache.spi.UpdateTimestampsCache</code> holds timestamps of the most recent updates to
              queryable tables. These timestamps validate results served from the query cache.
            </p></li></ul></div></li><li><p class="title"><b>Adjust the cache timeout of the underlying cache region</b></p><p>
          If you configure your underlying cache implementation to use expiry or timeouts, set the cache timeout of the
          underlying cache region for the <code class="code">UpdateTimestampsCache</code> to a higher value than the timeouts of any
          of the query caches. It is possible, and recommended, to set the UpdateTimestampsCache region never to
          expire. To be specific, a LRU (Least Recently Used) cache expiry policy is never appropriate.
        </p></li><li><p class="title"><b>Enable results caching for specific queries</b></p><p>
          Since most queries do not benefit from caching of their results, you need to enable caching for individual
          queries, e ven after enabling query caching overall. To enable results caching for a particular query, call
          <code class="methodname">org.hibernate.Query.setCacheable(true)</code>. This call allows the query to look for
          existing cache results or add its results to the cache when it is executed.
        </p></li></ol></div><p>
      The query cache does not cache the state of the actual entities in the cache. It caches identifier values and
      results of value type. Therefore, always use the query cache in conjunction with the second-level
      cache for those entities which should be cached as part of a query result cache.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2651"/>6.1.1. Query cache regions</h3></div></div></div><p>
        For fine-grained control over query cache expiration policies, specify a named cache region for a particular
        query by calling <code class="methodname">Query.setCacheRegion()</code>.
      </p><div class="example"><a id="d0e2659"/><p class="title"><b>Example 6.1. Method <code class="methodname">setCacheRegion</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;blogs&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sess</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;from&nbsp;Blog&nbsp;blog&nbsp;where&nbsp;blog.blogger&nbsp;=&nbsp;:blogger&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setEntity</span><span class="java_separator">(</span><span class="java_literal">&quot;blogger&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;blogger</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setMaxResults</span><span class="java_separator">(</span><span class="java_literal">15</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setCacheable</span><span class="java_separator">(</span><span class="java_literal">true</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setCacheRegion</span><span class="java_separator">(</span><span class="java_literal">&quot;frontpages&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><p>
        To force the query cache to refresh one of its regions and disregard any cached results in the region, call
        <code class="code">org.hibernate.Query.setCacheMode(CacheMode.REFRESH)</code>. In conjunction with the region defined for the
        given query, Hibernate selectively refreshes the results cached in that particular region. This is much more
        efficient than bulk eviction of the region via <code class="code">org.hibernate.SessionFactory.evictQueries()</code>.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2674"/>6.2. Second-level cache providers</h2></div></div></div><p>
      Hibernate is compatible with several second-level cache providers. None of the providers support all of
      Hibernate's possible caching strategies. <a href="#caching-provider-table" title="6.2.3. Second-level cache providers for Hibernate">Section 6.2.3, “Second-level cache providers for Hibernate”</a> lists the providers, along with
      their interfaces and supported caching strategies. For definitions of caching strategies, see <a href="#caching-strategies-list" title="6.2.2. Caching strategies">Section 6.2.2, “Caching strategies”</a>.
    </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2683"/>6.2.1. Configuring your cache providers</h3></div></div></div><p>
        You can configure your cache providers using either annotations or mapping files.
      </p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Entities</h5><p class="formalpara">
          By default, entities are not part of the second-level cache, and their use is not recommended. If you
          absolutely must use entities, set the <code class="code">shared-cache-mode</code> element in
          <code class="filename">persistence.xml</code>, or use property <span class="property">javax.persistence.sharedCache.mode</span>
          in your configuration. Use one of the values in <a href="#shared-cache-mode-values" title="Table 6.1. Possible values for Shared Cache Mode">Table 6.1, “Possible values for Shared Cache Mode”</a>.
        </p><div class="table"><a id="shared-cache-mode-values"/><p class="title"><b>Table 6.1. Possible values for Shared Cache Mode</b></p><div class="table-contents"><table summary="Possible values for Shared Cache Mode" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ENABLE_SELECTIVE</td><td>
                <p>
                  Entities are not cached unless you explicitly mark them as cachable. This is the default and
                  recommended value.
                </p>
              </td></tr><tr><td>DISABLE_SELECTIVE</td><td>
                <p>
                  Entities are cached unless you explicitly mark them as not cacheable.
                </p>
              </td></tr><tr><td>ALL</td><td>
                <p>
                  All entities are always cached even if you mark them as not cacheable.
                </p>
              </td></tr><tr><td>NONE</td><td>
                <p>
                  No entities are cached even if you mark them as cacheable. This option basically disables second-level
                  caching.
                </p>
              </td></tr></tbody></table></div></div><br class="table-break"/><p>
        Set the global default cache concurrency strategy The cache concurrency strategy with the
        <span class="property">hibernate.cache.default_cache_concurrency_strategy</span> configuration property. See <a href="#caching-strategies-list" title="6.2.2. Caching strategies">Section 6.2.2, “Caching strategies”</a> for possible values.
      </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
          When possible, define the cache concurrency strategy per entity rather than globally. Use the
          <code class="code">@org.hibernate.annotations.Cache</code> annotation.
        </p></div><div class="example"><a id="configuring-cache-providers-annotations"/><p class="title"><b>Example 6.2. Configuring cache providers using annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Cacheable</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Cache</span><span class="java_separator">(</span><span class="java_plain">usage&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheConcurrencyStrategy</span><span class="java_separator">.</span><span class="java_plain">NONSTRICT_READ_WRITE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Forest</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre><p>
          You can cache the content of a collection or the identifiers, if the collection contains other entities. Use
          the <code class="code">@Cache</code> annotation on the Collection property.
        </p><p>
          <code class="code">@Cache</code> can take several attributes.
        </p><div class="variablelist"><p class="title"><b>Attributes of <code class="code">@Cache</code> annotation</b></p><dl><dt><span class="term">usage</span></dt><dd><p>
                The given cache concurrency strategy, which may be:
              </p><div class="itemizedlist"><ul><li><p>
                    <code class="literal">NONE</code>
                  </p></li><li><p>
                    <code class="literal">READ_ONLY</code>
                  </p></li><li><p>
                    <code class="literal">NONSTRICT_READ_WRITE</code>
                  </p></li><li><p>
                    <code class="literal">READ_WRITE</code>
                  </p></li><li><p>
                    <code class="literal">TRANSACTIONAL</code>
                  </p></li></ul></div></dd><dt><span class="term">region</span></dt><dd><p>
                The cache region. This attribute is optional, and defaults to the fully-qualified class name of the
                class, or the qually-qualified role name of the collection.
              </p></dd><dt><span class="term">include</span></dt><dd><p>
                Whether or not to include all properties.. Optional, and can take one of two possible values.
              </p><div class="itemizedlist"><ul><li><p>
                    A value of <code class="literal">all</code> includes all properties. This is the default.
                  </p></li><li><p>
                    A value of <code class="literal">non-lazy</code> only includes non-lazy properties.
                  </p></li></ul></div></dd></dl></div></div></div><br class="example-break"/><div class="example"><a id="d0e2843"/><p class="title"><b>Example 6.3. Configuring cache providers using mapping files</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">cache</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">usage</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;transactional&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">region</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;RegionName&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">include</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;all&quot;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>
          Just as in the <a href="#configuring-cache-providers-annotations" title="Example 6.2. Configuring cache providers using annotations">Example 6.2, “Configuring cache providers using annotations”</a>, you can provide attributes in the
          mapping file. There are some specific differences in the syntax for the attributes in a mapping file.
        </p><div class="variablelist"><dl><dt><span class="term">usage</span></dt><dd><p>
                The caching strategy. This attribute is required, and can be any of the following values.
              </p><div class="itemizedlist"><ul><li><p>transactional</p></li><li><p>read-write</p></li><li><p>nonstrict-read-write</p></li><li><p>read-only</p></li></ul></div></dd><dt><span class="term">region</span></dt><dd><p>
                The name of the second-level cache region. This optional attribute defaults to the class or collection
                role name.
              </p></dd><dt><span class="term">include</span></dt><dd><p>
                Whether properties of the entity mapped with <code class="literal">lazy=true</code> can be cached when
                attribute-level lazy fetching is enabled. Defaults to <code class="literal">all</code> and can also be
                <code class="literal">non-lazy</code>.
              </p></dd></dl></div><p>
          Instead of <code class="code">&lt;cache&gt;</code>, you can use <code class="code">&lt;class-cache&gt;</code> and
          <code class="code">&lt;collection-cache&gt;</code> elements in <code class="filename">hibernate.cfg.xml</code>.
        </p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="caching-strategies-list"/>6.2.2. Caching strategies</h3></div></div></div><div class="variablelist"><dl><dt><span class="term">read-only</span></dt><dd><p>
              A read-only cache is good for data that needs to be read often but not modified. It is simple, performs
              well, and is safe to use in a clustered environment.
            </p></dd><dt><span class="term">nonstrict read-write</span></dt><dd><p>
              Some applications only rarely need to modify data. This is the case if two transactions are unlikely to
              try to update the same item simultaneously. In this case, you do not need strict transaction isolation,
              and a nonstrict-read-write cache might be appropriate. If the cache is used in a JTA environment, you must
              specify <code class="classname">hibernate.transaction.manager_lookup_class</code>. In other environments, ensore
              that the transaction is complete before you call <code class="methodname">Session.close()</code> or
              <code class="methodname">Session.disconnect()</code>.
            </p></dd><dt><span class="term">read-write</span></dt><dd><p>
              A read-write cache is appropriate for an application which needs to update data regularly. Do not use a
              read-write strategy if you need serializable transaction isolation. In a JTA environment, specify a
              strategy for obtaining the JTA TransactionManager by setting the property
              <span class="property">hibernate.transaction.manager_lookup_class</span>. In non-JTA environments, be sure the
              transaction is complete before you call <code class="methodname">Session.close()</code> or
              <code class="methodname">Session.disconnect()</code>.
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
                To use the read-write strategy in a clustered environment, the underlying cache implementation must
                support locking. The build-in cache providers do not support locking.
              </p></div></dd><dt><span class="term">transactional</span></dt><dd><p>
              The transactional cache strategy provides support for transactional cache providers such as JBoss
              TreeCache. You can only use such a cache in a JTA environment, and you must first specify
              <code class="classname">hibernate.transaction.manager_lookup_class</code>.
            </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="caching-provider-table"/>6.2.3. Second-level cache providers for Hibernate</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Cache</th><th>Interface</th><th>Supported strategies</th><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></thead><tbody><tr><td>HashTable (testing only)</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>nontrict read-write</p></li><li><p>read-write</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>EHCache</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>nontrict read-write</p></li><li><p>read-write</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>OSCache</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>nontrict read-write</p></li><li><p>read-write</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>SwarmCache</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>nontrict read-write</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>JBoss Cache 1.x</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>transactional</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>JBoss Cache 2.x</td><td> </td><td>
                <div class="itemizedlist"><ul><li><p>read-only</p></li><li><p>transactional</p></li></ul></div>
              </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody></table></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3066"/>6.3. Managing the cache</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3069"/>6.3.1. Moving items into and out of the cache</h3></div></div></div><div class="variablelist"><p class="title"><b>Actions that add an item to internal cache of the Session</b></p><dl><dt><span class="term">Saving or updating an item</span></dt><dd><div class="itemizedlist"><ul><li><p>
                  <code class="methodname">save()</code>
                </p></li><li><p>
                  <code class="methodname">update()</code>
                </p></li><li><p>
                  <code class="methodname">saveOrUpdate()</code>
                </p></li></ul></div></dd><dt><span class="term">Retrieving an item</span></dt><dd><div class="itemizedlist"><ul><li><p>
                  <code class="methodname">load()</code>
                </p></li><li><p>
                  <code class="methodname">get()</code>
                </p></li><li><p>
                  <code class="methodname">list()</code>
                </p></li><li><p>
                  <code class="methodname">iterate()</code>
                </p></li><li><p>
                  <code class="methodname">scroll()</code>
                </p></li></ul></div></dd></dl></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Syncing or removing a cached item</h5><p class="formalpara">
          The state of an object is synchronized with the database when you call method
          <code class="methodname">flush()</code>. To avoid this synchronization, you can remove the object and all collections
          from the first-level cache with the <code class="methodname">evict()</code> method. To remove all items from the
          Session cache, use method <code class="methodname">Session.clear()</code>.
        </p><div class="example"><a id="d0e3147"/><p class="title"><b>Example 6.4. Evicting an item from the first-level cache</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">ScrollableResult</span><!-- <br/> --><span class="java_plain">&nbsp;cats&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sess</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;from&nbsp;Cat&nbsp;as&nbsp;cat&quot;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">scroll</span><!-- <br/> --><span class="java_separator">();</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">a&nbsp;huge&nbsp;result&nbsp;set</span>
<!--  --><br/><span class="java_keyword">while</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cats</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Cat</span><span class="java_plain">&nbsp;cat&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Cat</span><span class="java_separator">)</span><span class="java_plain">&nbsp;cats</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;doSomethingWithACat</span><span class="java_separator">(</span><span class="java_plain">cat</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;sess</span><span class="java_separator">.</span><span class="java_plain">evict</span><span class="java_separator">(</span><span class="java_plain">cat</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Determining whether an item belongs to the Session cache</h5><p class="formalpara">
          The Session provides a <code class="methodname">contains()</code> method to determine if an instance belongs to the
          session cache.
        </p><div class="example"><a id="d0e3160"/><p class="title"><b>Example 6.5. Second-level cache eviction</b></p><div class="example-contents"><p>
          You can evict the cached state of an instance, entire class, collection instance or entire collection role,
          using methods of <code class="classname">SessionFactory</code>.
        </p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getCache</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">containsEntity</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Cat</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;catId</span><!-- <br/> --><span class="java_separator">);</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;is&nbsp;</span><!-- <br/> --><span class="java_keyword">this</span><!-- <br/> --><span class="java_plain">&nbsp;particular&nbsp;</span><!-- <br/> --><span class="java_type">Cat</span><!-- <br/> --><span class="java_plain">&nbsp;currently&nbsp;in&nbsp;the&nbsp;cache</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictEntity</span><span class="java_separator">(</span><span class="java_type">Cat</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;catId</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;a&nbsp;particular&nbsp;</span><span class="java_type">Cat</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictEntityRegion</span><span class="java_separator">(</span><span class="java_type">Cat</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;all&nbsp;</span><span class="java_type">Cats</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictEntityRegions</span><span class="java_separator">();</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;all&nbsp;entity&nbsp;data</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">containsCollection</span><span class="java_separator">(</span><span class="java_literal">&quot;Cat.kittens&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;catId</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;particular&nbsp;collection&nbsp;currently&nbsp;in&nbsp;the&nbsp;cache</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictCollection</span><span class="java_separator">(</span><span class="java_literal">&quot;Cat.kittens&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;catId</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;a&nbsp;particular&nbsp;collection&nbsp;of&nbsp;kittens</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictCollectionRegion</span><span class="java_separator">(</span><span class="java_literal">&quot;Cat.kittens&quot;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;all&nbsp;kitten&nbsp;collections</span>
</span>
<!--  --><br/><span class="java_plain">sessionFactory</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">().</span><span class="java_plain">evictCollectionRegions</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;evict&nbsp;all&nbsp;collection&nbsp;data</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3170"/>6.3.1.1. Interactions between a Session and the second-level cache</h4></div></div></div><p>
          The CacheMode controls how a particular session interacts with the second-level cache.
        </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>CacheMode.NORMAL</td><td>reads items from and writes them to the second-level cache.</td></tr><tr><td>CacheMode.GET</td><td>reads items from the second-level cache, but does not write to the second-level cache except to
                update data.</td></tr><tr><td>CacheMode.PUT</td><td>writes items to the second-level cache. It does not read from the second-level cache. It bypasses
                the effect of <span class="property">hibernate.cache.use_minimal_puts</span> and forces a refresh of the
                second-level cache for all items read from the database.</td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3196"/>6.3.1.2. Browsing the contents of a second-level or query cache region</h4></div></div></div><p>
          After enabling statistics, you can browse the contents of a second-level cache or query cache region.
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e3201"/><p class="title"><b>Procedure 6.2. Enabling Statistics</b></p><ol class="1"><li><p>
              Set <code class="code">hibernate.generate_statistics</code> to <code class="literal">true</code>.
            </p></li><li><p>
              Optionally, set <code class="code">hibernate.cache.use_structured_entries</code> to <code class="literal">true</code>, to cause
              Hibernate to store the cache entries in a human-readable format.
            </p></li></ol></div><div class="example"><a id="d0e3222"/><p class="title"><b>Example 6.6. Browsing the second-level cache entries via the Statistics API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Map</span><!-- <br/> --><span class="java_plain">&nbsp;cacheEntries&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getStatistics</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getSecondLevelCacheStatistics</span><span class="java_separator">(</span><span class="java_plain">regionName</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getEntries</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3227"/>Chapter 7. Services</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e3230">7.1. What are services?</a></span></dt><dt><span class="section"><a href="#d0e3235">7.2. Service contracts</a></span></dt><dt><span class="section"><a href="#d0e3254">7.3. Service dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3259">7.3.1. @<code class="interfacename">org.hibernate.service.spi.InjectService</code></a></span></dt><dt><span class="section"><a href="#d0e3291">7.3.2. <code class="interfacename">org.hibernate.service.spi.ServiceRegistryAwareService</code></a></span></dt></dl></dd><dt><span class="section"><a href="#services-registry">7.4. ServiceRegistry</a></span></dt><dt><span class="section"><a href="#d0e3327">7.5. Standard services</a></span></dt><dd><dl><dt><span class="section"><a href="#services-BatchBuilder">7.5.1. <code class="interfacename">org.hibernate.engine.jdbc.batch.spi.BatchBuilder</code></a></span></dt><dt><span class="section"><a href="#services-ConfigurationService">7.5.2. <code class="interfacename">org.hibernate.service.config.spi.ConfigurationService</code></a></span></dt><dt><span class="section"><a href="#services-ConnectionProvider">7.5.3. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code></a></span></dt><dt><span class="section"><a href="#services-DialectFactory">7.5.4. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectFactory</code></a></span></dt><dt><span class="section"><a href="#services-DialectResolver">7.5.5. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code></a></span></dt><dt><span class="section"><a href="#services-JdbcServices">7.5.6. <code class="interfacename">org.hibernate.engine.jdbc.spi.JdbcServices</code></a></span></dt><dt><span class="section"><a href="#services-JmxService">7.5.7. <code class="interfacename">org.hibernate.service.jmx.spi.JmxService</code></a></span></dt><dt><span class="section"><a href="#services-JndiService">7.5.8. <code class="interfacename">org.hibernate.service.jndi.spi.JndiService</code></a></span></dt><dt><span class="section"><a href="#services-JtaPlatform">7.5.9. <code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code></a></span></dt><dt><span class="section"><a href="#services-MultiTenantConnectionProvider">7.5.10. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.MultiTenantConnectionProvider</code></a></span></dt><dt><span class="section"><a href="#services-PersisterClassResolver">7.5.11. <code class="interfacename">org.hibernate.persister.spi.PersisterClassResolver</code></a></span></dt><dt><span class="section"><a href="#services-PersisterFactory">7.5.12. <code class="interfacename">org.hibernate.persister.spi.PersisterFactory</code></a></span></dt><dt><span class="section"><a href="#services-RegionFactory">7.5.13. <code class="interfacename">org.hibernate.cache.spi.RegionFactory</code></a></span></dt><dt><span class="section"><a href="#services-SessionFactoryServiceRegistryFactory">7.5.14. <code class="interfacename">org.hibernate.service.spi.SessionFactoryServiceRegistryFactory</code></a></span></dt><dt><span class="section"><a href="#services-Statistics">7.5.15. <code class="interfacename">org.hibernate.stat.Statistics</code></a></span></dt><dt><span class="section"><a href="#services-TransactionFactory">7.5.16. <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code></a></span></dt><dt><span class="section"><a href="#services-ImportSqlCommandExtractor">7.5.17. <code class="interfacename">org.hibernate.tool.hbm2ddl.ImportSqlCommandExtractor</code></a></span></dt></dl></dd><dt><span class="section"><a href="#d0e4121">7.6. Custom services</a></span></dt><dt><span class="section"><a href="#d0e4164">7.7. Special service registries</a></span></dt><dd><dl><dt><span class="section"><a href="#services-registry-bootstrap">7.7.1. Boot-strap registry</a></span></dt><dt><span class="section"><a href="#services-registry-sessionfactory">7.7.2. SessionFactory registry</a></span></dt></dl></dd><dt><span class="section"><a href="#services-use">7.8. Using services and registries</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3230"/>7.1. What are services?</h2></div></div></div><p>
            Services are classes that provide Hibernate with pluggable implementations of various types of
            functionality.  Specifically they are implementations of certain service contract interfaces.  The interface
            is known as the service role; the implementation class is know as the service implementation.  Generally
            speaking, users can plug in alternate implementations of all standard service roles (overriding); they can
            also define additional services beyond the base set of service roles (extending).
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3235"/>7.2. Service contracts</h2></div></div></div><p>
            The basic requirement for a service is to implement the marker interface
            <code class="interfacename">org.hibernate.service.Service</code>.  Hibernate uses this internally for some
            basic type safety.
        </p><p>
            Optionally, the service can also implement the
            <code class="interfacename">org.hibernate.service.spi.Startable</code> and
            <code class="interfacename">org.hibernate.service.spi.Stoppable</code> interfaces to receive notifications
            of being started and stopped.  Another optional service contract is
            <code class="interfacename">org.hibernate.service.spi.Manageable</code> which marks the service as manageable
            in JMX provided the JMX integration is enabled.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3254"/>7.3. Service dependencies</h2></div></div></div><p>
            Services are allowed to declare dependencies on other services using either of 2 approaches.
        </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3259"/>7.3.1. @<code class="interfacename">org.hibernate.service.spi.InjectService</code></h3></div></div></div><p>
                Any method on the service implementation class accepting a single parameter and annotated with
                @<code class="interfacename">InjectService</code> is considered requesting injection of another service.
            </p><p>
                By default the type of the method parameter is expected to be the service role to be injected.  If the
                parameter type is different than the service role, the <code class="methodname">serviceRole</code> attribute
                of the <code class="interfacename">InjectService</code> should be used to explicitly name the role.
            </p><p>
                By default injected services are considered required, that is the start up will fail if a named
                dependent service is missing.  If the service to be injected is optional, the
                <code class="methodname">required</code> attribute of the <code class="interfacename">InjectService</code>
                should be declared as <code class="literal">false</code> (default is <code class="literal">true</code>).
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3291"/>7.3.2. <code class="interfacename">org.hibernate.service.spi.ServiceRegistryAwareService</code></h3></div></div></div><p>
                The second approach is a pull approach where the service implements the optional service interface
                <code class="interfacename">org.hibernate.service.spi.ServiceRegistryAwareService</code> which declares
                a single <code class="methodname">injectServices</code> method.  During startup, Hibernate will inject the
                <code class="interfacename">org.hibernate.service.ServiceRegistry</code> itself into services which
                implement this interface.  The service can then use the <code class="interfacename">ServiceRegistry</code>
                reference to locate any additional services it needs.
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="services-registry"/>7.4. ServiceRegistry</h2></div></div></div><p>
            The central service API, aside from the services themselves, is the
            <code class="interfacename">org.hibernate.service.ServiceRegistry</code> interface. The main purpose of
            a service registry is to hold, manage and provide access to services.
        </p><p>
            Service registries are hierarchical.  Services in one registry can depend on and utilize services in that
            same registry as well as any parent registries.
        </p><p>
            Use <code class="classname">org.hibernate.service.ServiceRegistryBuilder</code> to build a
            <code class="interfacename">org.hibernate.service.ServiceRegistry</code> instance.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3327"/>7.5. Standard services</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-BatchBuilder"/>7.5.1. <code class="interfacename">org.hibernate.engine.jdbc.batch.spi.BatchBuilder</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Defines strategy for how Hibernate manages JDBC statement batching
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.engine.jdbc.batch.internal.BatchBuilderInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.engine.jdbc.batch.internal.BatchBuilderImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-ConfigurationService"/>7.5.2. <code class="interfacename">org.hibernate.service.config.spi.ConfigurationService</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Provides access to the configuration settings, combining those explicitly provided as well
                            as those contributed by any registered
                            <code class="interfacename">org.hibernate.integrator.spi.Integrator</code> implementations
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.config.internal.ConfigurationServiceInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.config.internal.ConfigurationServiceImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-ConnectionProvider"/>7.5.3. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Defines the means in which Hibernate can obtain and release
                            <code class="interfacename">java.sql.Connection</code> instances for its use.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jdbc.connections.internal.ConnectionProviderInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><div class="itemizedlist"><ul><li><p>
                                    <code class="classname">org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider</code> -
                                    provides connection pooling based on integration with the C3P0 connection pooling library
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jdbc.connections.internal.DatasourceConnectionProviderImpl</code> -
                                    provides connection managed delegated to a
                                    <code class="interfacename">javax.sql.DataSource</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jdbc.connections.internal.DriverManagerConnectionProviderImpl</code> -
                                    provides rudimentary connection pooling based on simple custom pool.  Note intended
                                    production use!
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jdbc.connections.internal.ProxoolConnectionProvider</code> -
                                    provides connection pooling based on integration with the proxool connection pooling library
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jdbc.connections.internal.UserSuppliedConnectionProviderImpl</code> -
                                    Provides no connection support.  Indicates the user will supply connections to Hibernate directly.
                                    Not recommended for use.
                                </p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-DialectFactory"/>7.5.4. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectFactory</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Contract for Hibernate to obtain <code class="classname">org.hibernate.dialect.Dialect</code>
                            instance to use.  This is either explicitly defined by the
                            <span class="property">hibernate.dialect</span> property or determined by the
                            <a href="#services-DialectResolver" title="7.5.5. org.hibernate.service.jdbc.dialect.spi.DialectResolver">Section 7.5.5, “<code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code>”</a> service which is a delegate to this service.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.DialectFactoryInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.DialectFactoryImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-DialectResolver"/>7.5.5. <code class="interfacename">org.hibernate.service.jdbc.dialect.spi.DialectResolver</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Provides resolution of <code class="classname">org.hibernate.dialect.Dialect</code> to use based on
                            information extracted from JDBC metadata.
                        </p><p>
                            The standard resolver implementation acts as a chain, delegating to a series of individual
                            resolvers.  The standard Hibernate resolution behavior is contained in
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.StandardDialectResolver</code>.
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.DialectResolverInitiator</code>
                            also consults with the <span class="property">hibernate.dialect_resolvers</span> setting for any
                            custom resolvers.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.DialectResolverInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jdbc.dialect.internal.DialectResolverSet</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-JdbcServices"/>7.5.6. <code class="interfacename">org.hibernate.engine.jdbc.spi.JdbcServices</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Special type of service that aggregates together a number of other services and provides
                            a higher-level set of functionality.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.engine.jdbc.internal.JdbcServicesInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.engine.jdbc.internal.JdbcServicesImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-JmxService"/>7.5.7. <code class="interfacename">org.hibernate.service.jmx.spi.JmxService</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Provides simplified access to JMX related features needed by Hibernate.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jmx.internal.JmxServiceInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><div class="itemizedlist"><ul><li><p>
                                    <code class="classname">org.hibernate.service.jmx.internal.DisabledJmxServiceImpl</code> -
                                    A no-op implementation when JMX functionality is disabled.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jmx.internal.JmxServiceImpl</code> -
                                    Standard implementation of JMX handling
                                </p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-JndiService"/>7.5.8. <code class="interfacename">org.hibernate.service.jndi.spi.JndiService</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Provides simplified access to JNDI related features needed by Hibernate.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jndi.internal.JndiServiceInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jndi.internal.JndiServiceImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-JtaPlatform"/>7.5.9. <code class="interfacename">org.hibernate.service.jta.platform.spi.JtaPlatform</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Provides an abstraction from the underlying JTA platform when JTA features are used.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.jta.platform.internal.JtaPlatformInitiator</code>
                        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
                                <code class="classname">JtaPlatformInitiator</code> provides mapping against the legacy,
                                now-deprecated <code class="interfacename">org.hibernate.transaction.TransactionManagerLookup</code>
                                names internally for the Hibernate-provided
                                <code class="interfacename">org.hibernate.transaction.TransactionManagerLookup</code>
                                implementations.
                            </p></div></dd><dt><span class="term">Implementations</span></dt><dd><div class="itemizedlist"><ul><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.BitronixJtaPlatform</code> -
                                    Integration with the Bitronix stand-alone transaction manager.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.BorlandEnterpriseServerJtaPlatform</code> -
                                    Integration with the transaction manager as deployed within a Borland Enterprise Server
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform</code> -
                                    Integration with the transaction manager as deployed within a JBoss Application Server
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.JBossStandAloneJtaPlatform</code> -
                                    Integration with the JBoss Transactions stand-alone transaction manager
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.JOTMJtaPlatform</code> -
                                    Integration with the JOTM stand-alone transaction manager
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.JOnASJtaPlatform</code> -
                                    Integration with the JOnAS transaction manager.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.JRun4JtaPlatform</code> -
                                    Integration with the transaction manager as deployed in a JRun 4 application server.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.NoJtaPlatform</code> -
                                    No-op version when no JTA set up is configured
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.OC4JJtaPlatform</code> -
                                    Integration with transaction manager as deployed in an OC4J (Oracle) application
                                    server.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.OrionJtaPlatform</code> -
                                    Integration with transaction manager as deployed in an Orion application server.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.ResinJtaPlatform</code> -
                                    Integration with transaction manager as deployed in a Resin application server.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.SunOneJtaPlatform</code> -
                                    Integration with transaction manager as deployed in a Sun ONE (7 and above)
                                    application server.
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.TransactionManagerLookupBridge</code> -
                                    Provides a bridge to legacy (and deprecated)
                                    <code class="interfacename">org.hibernate.transaction.TransactionManagerLookup</code>
                                    implementations
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.WebSphereExtendedJtaPlatform</code> -
                                    Integration with transaction manager as deployed in a WebSphere Application Server
                                    (6 and above).
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.WebSphereJtaPlatform</code> -
                                    Integration with transaction manager as deployed in a WebSphere Application Server
                                    (4, 5.0 and 5.1).
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.service.jta.platform.internal.WeblogicJtaPlatform</code> -
                                    Integration with transaction manager as deployed in a Weblogic application server.
                                </p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-MultiTenantConnectionProvider"/>7.5.10. <code class="interfacename">org.hibernate.service.jdbc.connections.spi.MultiTenantConnectionProvider</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            A variation of <a href="#services-ConnectionProvider" title="7.5.3. org.hibernate.service.jdbc.connections.spi.ConnectionProvider">Section 7.5.3, “<code class="interfacename">org.hibernate.service.jdbc.connections.spi.ConnectionProvider</code>”</a> providing access to JDBC
                            connections in multi-tenant environments.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            N/A
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            Intended that users provide appropriate implementation if needed.
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-PersisterClassResolver"/>7.5.11. <code class="interfacename">org.hibernate.persister.spi.PersisterClassResolver</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Contract for determining the appropriate
                            <code class="interfacename">org.hibernate.persister.entity.EntityPersister</code>
                            or <code class="interfacename">org.hibernate.persister.collection.CollectionPersister</code>
                            implementation class to use given an entity or collection mapping.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.persister.internal.PersisterClassResolverInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.persister.internal.StandardPersisterClassResolver</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-PersisterFactory"/>7.5.12. <code class="interfacename">org.hibernate.persister.spi.PersisterFactory</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Factory for creating
                            <code class="interfacename">org.hibernate.persister.entity.EntityPersister</code>
                            and <code class="interfacename">org.hibernate.persister.collection.CollectionPersister</code>
                            instances.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.persister.internal.PersisterFactoryInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.persister.internal.PersisterFactoryImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-RegionFactory"/>7.5.13. <code class="interfacename">org.hibernate.cache.spi.RegionFactory</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Integration point for Hibernate's second level cache support.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.cache.internal.RegionFactoryInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><div class="itemizedlist"><ul><li><p>
                                    <code class="classname">org.hibernate.cache.ehcache.EhCacheRegionFactory</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.cache.infinispan.InfinispanRegionFactory</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.cache.infinispan.JndiInfinispanRegionFactory</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.cache.internal.NoCachingRegionFactory</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory</code>
                                </p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-SessionFactoryServiceRegistryFactory"/>7.5.14. <code class="interfacename">org.hibernate.service.spi.SessionFactoryServiceRegistryFactory</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Factory for creating
                            <code class="interfacename">org.hibernate.service.spi.SessionFactoryServiceRegistry</code>
                            instances which acts as a specialized
                            <code class="interfacename">org.hibernate.service.ServiceRegistry</code> for
                            <code class="interfacename">org.hibernate.SessionFactory</code> scoped services.  See
                            <a href="#services-registry-sessionfactory" title="7.7.2. SessionFactory registry">Section 7.7.2, “SessionFactory registry”</a> for more details.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.internal.SessionFactoryServiceRegistryFactoryInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.service.internal.SessionFactoryServiceRegistryFactoryImpl</code>
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-Statistics"/>7.5.15. <code class="interfacename">org.hibernate.stat.Statistics</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Contract for exposing collected statistics.  The statistics are collected through the
                            <code class="interfacename">org.hibernate.stat.spi.StatisticsImplementor</code> contract.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.stat.internal.StatisticsInitiator</code>
                        </p><p>
                            Defines a <span class="property">hibernate.stats.factory</span> setting to allow
                            configuring the
                            <code class="interfacename">org.hibernate.stat.spi.StatisticsFactory</code> to use internally
                            when building the actual
                            <code class="interfacename">org.hibernate.stat.Statistics</code> instance.
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.stat.internal.ConcurrentStatisticsImpl</code>
                        </p><p>
                            The default <code class="interfacename">org.hibernate.stat.spi.StatisticsFactory</code>
                            implementation builds a
                            <code class="classname">org.hibernate.stat.internal.ConcurrentStatisticsImpl</code> instance.
                        </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-TransactionFactory"/>7.5.16. <code class="interfacename">org.hibernate.engine.transaction.spi.TransactionFactory</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Strategy defining how Hibernate's <code class="interfacename">org.hibernate.Transaction</code>
                            API maps to the underlying transaction approach.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.stat.internal.StatisticsInitiator</code>
                        </p><p>
                            Defines a <span class="property">hibernate.stats.factory</span> setting to allow
                            configuring the
                            <code class="interfacename">org.hibernate.stat.spi.StatisticsFactory</code> to use internally
                            when building the actual
                            <code class="interfacename">org.hibernate.stat.Statistics</code> instance.
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><div class="itemizedlist"><ul><li><p>
                                    <code class="classname">org.hibernate.engine.transaction.internal.jta.CMTTransactionFactory</code> -
                                    A JTA-based strategy in which Hibernate is not controlling the transactions.  An
                                    important distinction here is that interaction with the underlying JTA implementation
                                    is done through the
                                    <code class="interfacename">javax.transaction.TransactionManager</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.engine.transaction.internal.jdbc.JdbcTransactionFactory</code> -
                                    A non-JTA strategy in which the transactions are managed using the JDBC
                                    <code class="interfacename">java.sql.Connection</code>
                                </p></li><li><p>
                                    <code class="classname">org.hibernate.engine.transaction.internal.jta.JtaTransactionFactory</code> -
                                    A JTA-based strategy in which Hibernate *may* be controlling the transactions.  An
                                    important distinction here is that interaction with the underlying JTA
                                    implementation is done through the
                                    <code class="interfacename">javax.transaction.UserTransaction</code>
                                </p></li></ul></div></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-ImportSqlCommandExtractor"/>7.5.17. <code class="interfacename">org.hibernate.tool.hbm2ddl.ImportSqlCommandExtractor</code></h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                            Contract for extracting statements from <code class="literal">import.sql</code> scripts.
                        </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                            <code class="classname">org.hibernate.tool.hbm2ddl.ImportSqlCommandExtractorInitiator</code>
                        </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                            <code class="classname">org.hibernate.tool.hbm2ddl.SingleLineSqlCommandExtractor</code>
                        </p><p>
                            Treads each line as a complete SQL statement. Comment lines shall start with
                            <code class="literal">--</code>, <code class="literal">//</code> or <code class="literal">/*</code> character sequence.
                        </p><p>
                            <code class="classname">org.hibernate.tool.hbm2ddl.MultipleLinesSqlCommandExtractor</code>
                        </p><p>
                            Supports instructions/comments and quoted strings spread over multiple lines. Each
                            statement must end with semicolon.
                        </p></dd></dl></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4121"/>7.6. Custom services</h2></div></div></div><p>
            Once a <code class="interfacename">org.hibernate.service.ServiceRegistry</code> is built it is considered
            immutable; the services themselves might accept re-configuration, but immutability here means
            adding/replacing services.  So another role provided by the
            <code class="classname">org.hibernate.service.ServiceRegistryBuilder</code> is to allow tweaking of the services
            that will be contained in the <code class="interfacename">org.hibernate.service.ServiceRegistry</code>
            generated from it.
        </p><p>
            There are 2 means to tell a <code class="classname">org.hibernate.service.ServiceRegistryBuilder</code> about
            custom services.
        </p><div class="itemizedlist"><ul><li><p>
                    Implement a <code class="interfacename">org.hibernate.service.spi.BasicServiceInitiator</code> class
                    to control on-demand construction of the service class and add it to the
                    <code class="classname">org.hibernate.service.ServiceRegistryBuilder</code> via its
                    <code class="methodname">addInitiator</code> method.
                </p></li><li><p>
                    Just instantiate the service class and add it to the
                    <code class="classname">org.hibernate.service.ServiceRegistryBuilder</code> via its
                    <code class="methodname">addService</code> method.
                </p></li></ul></div><p>
            Either approach the adding a service approach or the adding an initiator approach are valid for extending a
            registry (adding new service roles) and overriding services (replacing service implementations).
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4164"/>7.7. Special service registries</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-registry-bootstrap"/>7.7.1. Boot-strap registry</h3></div></div></div><p>
                The boot-strap registry holds services that absolutely have to be available for most things to work.
                The main service here is the <a href="#services-ClassLoaderService" title="7.7.1.1.1. org.hibernate.service.classloading.spi.ClassLoaderService">Section 7.7.1.1.1, “<code class="interfacename">org.hibernate.service.classloading.spi.ClassLoaderService</code>”</a> which is a perfect example.
                Even resolving configuration files needs access to class loading services (resource look ups).  This
                is the root registry (no parent) in normal use.
            </p><p>
                Instances of boot-strap registries are built using the
                <code class="classname">org.hibernate.service.BootstrapServiceRegistryBuilder</code> builder.
            </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="services-registry-bootstrap-services"/>7.7.1.1. Boot-strap registry services</h4></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="services-ClassLoaderService"/>7.7.1.1.1. <code class="interfacename">org.hibernate.service.classloading.spi.ClassLoaderService</code></h5></div></div></div><p>
                        Coming soon...  See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://hibernate.onjira.com/browse/HHH-6656">https://hibernate.onjira.com/browse/HHH-6656</a>
                    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="services-IntegratorService"/>7.7.1.1.2. <code class="interfacename">org.hibernate.integrator.spi.IntegratorService</code></h5></div></div></div><p>
                        Coming soon...  See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://hibernate.onjira.com/browse/HHH-6657">https://hibernate.onjira.com/browse/HHH-6657</a>
                    </p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="services-registry-sessionfactory"/>7.7.2. SessionFactory registry</h3></div></div></div><p>
                While it is best practice to treat instances of all the registry types as targeting a given
                <code class="interfacename">org.hibernate.SessionFactory</code>, the instances of services in this group
                explicitly belong to a single <code class="interfacename">org.hibernate.SessionFactory</code>.  The
                difference is a matter of timing in when they need to be initiated.  Generally they need access to the
                <code class="interfacename">org.hibernate.SessionFactory</code> to be initiated.  This special registry is
                <code class="interfacename">org.hibernate.service.spi.SessionFactoryServiceRegistry</code>
            </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="services-EventListenerRegistry"/>7.7.2.1. <code class="interfacename">org.hibernate.event.service.spi.EventListenerRegistry</code></h4></div></div></div><div class="variablelist"><dl><dt><span class="term">Notes</span></dt><dd><p>
                                Service for managing event listeners.
                            </p></dd><dt><span class="term">Initiator</span></dt><dd><p>
                                <code class="classname">org.hibernate.event.service.internal.EventListenerServiceInitiator</code>
                            </p></dd><dt><span class="term">Implementations</span></dt><dd><p>
                                <code class="classname">org.hibernate.event.service.internal.EventListenerRegistryImpl</code>
                            </p></dd></dl></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="services-use"/>7.8. Using services and registries</h2></div></div></div><p>
            Coming soon...
        </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4249"/>Chapter 8. Data categorizations</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#value-types">8.1. Value types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-basic-types">8.1.1. Basic types</a></span></dt><dt><span class="section"><a href="#value-composite-types">8.1.2. Composite types</a></span></dt><dt><span class="section"><a href="#value-collection-types">8.1.3. Collection types</a></span></dt></dl></dd><dt><span class="section"><a href="#entity-types">8.2. Entity Types</a></span></dt><dt><span class="section"><a href="#d0e4708">8.3. Implications of different data categorizations</a></span></dt></dl></div><p>
    Hibernate understands both the Java and JDBC representations of application data. The ability to read and write
    object data to a database is called <em class="firstterm">marshalling</em>, and is the function of a Hibernate
    <code class="classname">type</code>. A <code class="classname">type</code> is an implementation of the
    <code class="interfacename">org.hibernate.type.Type</code> interface. A Hibernate <code class="classname">type</code> describes
    various aspects of behavior of the Java type such as how to check for equality and how to clone values.
  </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Usage of the word <em class="wordasword">type</em></h2><p>
      A Hibernate <code class="classname">type</code> is neither a Java type nor a SQL datatype. It provides information about
      both of these.
    </p><p>
      When you encounter the term <em class="firstterm">type</em> in regards to Hibernate, it may refer to the Java type,
      the JDBC type, or the Hibernate type, depending on context.
    </p></div><p>
    Hibernate categorizes types into two high-level groups: <a href="#value-types" title="8.1. Value types">Section 8.1, “Value types”</a> and <a href="#entity-types" title="8.2. Entity Types">Section 8.2, “Entity Types”</a>.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="value-types"/>8.1. Value types</h2></div></div></div><p>
      A <em class="firstterm">value type</em> does not define its own lifecycle. It is, in effect, owned by an <a href="#entity-types" title="8.2. Entity Types">Section 8.2, “Entity Types”</a>, which defines its
      lifecycle. Value types are further classified into three sub-categories.
    </p><div class="itemizedlist"><ul><li><p><a href="#value-basic-types" title="8.1.1. Basic types">Section 8.1.1, “Basic types”</a></p></li><li><p><a href="#value-composite-types" title="8.1.2. Composite types">Section 8.1.2, “Composite types”</a></p></li><li><p><a href="#value-collection-types" title="8.1.3. Collection types">Section 8.1.3, “Collection types”</a></p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="value-basic-types"/>8.1.1. Basic types</h3></div></div></div><p>
        Basic value types usually map a single database value, or column, to a single, non-aggregated Java
        type. Hibernate provides a number of built-in basic types, which follow the natural mappings recommended in the
        JDBC specifications. You can override these mappings and provide and use alternative mappings. These topics are
        discussed further on.
      </p><div class="table"><a id="d0e4315"/><p class="title"><b>Table 8.1. Basic Type Mappings</b></p><div class="table-contents"><table summary="Basic Type Mappings" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Hibernate type</th><th>Database type</th><th>JDBC type</th><th>Type registry</th></tr></thead><tbody><tr><td>org.hibernate.type.StringType</td><td>string</td><td>VARCHAR</td><td>string, java.lang.String</td></tr><tr><td>org.hibernate.type.MaterializedClob</td><td>string</td><td>CLOB</td><td>materialized_clob</td></tr><tr><td>org.hibernate.type.TextType</td><td>string</td><td>LONGVARCHAR</td><td>text</td></tr><tr><td>org.hibernate.type.CharacterType</td><td>char, java.lang.Character</td><td>CHAR</td><td>char, java.lang.Character</td></tr><tr><td>org.hibernate.type.BooleanType</td><td>boolean</td><td>BIT</td><td>boolean, java.lang.Boolean</td></tr><tr><td>org.hibernate.type.NumericBooleanType</td><td>boolean</td><td>INTEGER, 0 is false, 1 is true</td><td>numeric_boolean</td></tr><tr><td>org.hibernate.type.YesNoType</td><td>boolean</td><td>CHAR, 'N'/'n' is false, 'Y'/'y' is true. The uppercase value is written to the database.</td><td>yes_no</td></tr><tr><td>org.hibernate.type.TrueFalseType</td><td>boolean</td><td>CHAR, 'F'/'f' is false, 'T'/'t' is true. The uppercase value is written to the database.</td><td>true_false</td></tr><tr><td>org.hibernate.type.ByteType</td><td>byte, java.lang.Byte</td><td>TINYINT</td><td>byte, java.lang.Byte</td></tr><tr><td>org.hibernate.type.ShortType</td><td>short, java.lang.Short</td><td>SMALLINT</td><td>short, java.lang.Short</td></tr><tr><td>org.hibernate.type.IntegerTypes</td><td>int, java.lang.Integer</td><td>INTEGER</td><td>int, java.lang.Integer</td></tr><tr><td>org.hibernate.type.LongType</td><td>long, java.lang.Long</td><td>BIGINT</td><td>long, java.lang.Long</td></tr><tr><td>org.hibernate.type.FloatType</td><td>float, java.lang.Float</td><td>FLOAT</td><td>float, java.lang.Float</td></tr><tr><td>org.hibernate.type.DoubleType</td><td>double, java.lang.Double</td><td>DOUBLE</td><td>double, java.lang.Double</td></tr><tr><td>org.hibernate.type.BigIntegerType</td><td>java.math.BigInteger</td><td>NUMERIC</td><td>big_integer</td></tr><tr><td>org.hibernate.type.BigDecimalType</td><td>java.math.BigDecimal</td><td>NUMERIC</td><td>big_decimal, java.math.bigDecimal</td></tr><tr><td>org.hibernate.type.TimestampType</td><td>java.sql.Timestamp</td><td>TIMESTAMP</td><td>timestamp, java.sql.Timestamp</td></tr><tr><td>org.hibernate.type.TimeType</td><td>java.sql.Time</td><td>TIME</td><td>time, java.sql.Time</td></tr><tr><td>org.hibernate.type.DateType</td><td>java.sql.Date</td><td>DATE</td><td>date, java.sql.Date</td></tr><tr><td>org.hibernate.type.CalendarType</td><td>java.util.Calendar</td><td>TIMESTAMP</td><td>calendar, java.util.Calendar</td></tr><tr><td>org.hibernate.type.CalendarDateType</td><td>java.util.Calendar</td><td>DATE</td><td>calendar_date</td></tr><tr><td>org.hibernate.type.CurrencyType</td><td>java.util.Currency</td><td>VARCHAR</td><td>currency, java.util.Currency</td></tr><tr><td>org.hibernate.type.LocaleType</td><td>java.util.Locale</td><td>VARCHAR</td><td>locale, java.utility.locale</td></tr><tr><td>org.hibernate.type.TimeZoneType</td><td>java.util.TimeZone</td><td>VARCHAR, using the TimeZone ID</td><td>timezone, java.util.TimeZone</td></tr><tr><td>org.hibernate.type.UrlType</td><td>java.net.URL</td><td>VARCHAR</td><td>url, java.net.URL</td></tr><tr><td>org.hibernate.type.ClassType</td><td>java.lang.Class</td><td>VARCHAR, using the class name</td><td>class, java.lang.Class</td></tr><tr><td>org.hibernate.type.BlobType</td><td>java.sql.Blob</td><td>BLOB</td><td>blog, java.sql.Blob</td></tr><tr><td>org.hibernate.type.ClobType</td><td>java.sql.Clob</td><td>CLOB</td><td>clob, java.sql.Clob</td></tr><tr><td>org.hibernate.type.BinaryType</td><td>primitive byte[]</td><td>VARBINARY</td><td>binary, byte[]</td></tr><tr><td>org.hibernate.type.MaterializedBlobType</td><td>primitive byte[]</td><td>BLOB</td><td>materized_blob</td></tr><tr><td>org.hibernate.type.ImageType</td><td>primitive byte[]</td><td>LONGVARBINARY</td><td>image</td></tr><tr><td>org.hibernate.type.BinaryType</td><td>java.lang.Byte[]</td><td>VARBINARY</td><td>wrapper-binary</td></tr><tr><td>org.hibernate.type.CharArrayType</td><td>char[]</td><td>VARCHAR</td><td>characters, char[]</td></tr><tr><td>org.hibernate.type.CharacterArrayType</td><td>java.lang.Character[]</td><td>VARCHAR</td><td>wrapper-characters, Character[], java.lang.Character[]</td></tr><tr><td>org.hibernate.type.UUIDBinaryType</td><td>java.util.UUID</td><td>BINARY</td><td>uuid-binary, java.util.UUID</td></tr><tr><td>org.hibernate.type.UUIDCharType</td><td>java.util.UUID</td><td>CHAR, can also read VARCHAR</td><td>uuid-char</td></tr><tr><td>org.hibernate.type.PostgresUUIDType</td><td>java.util.UUID</td><td>PostgreSQL UUID, through Types#OTHER, which complies to the PostgreSQL JDBC driver
              definition</td><td>pg-uuid</td></tr><tr><td>org.hibernate.type.SerializableType</td><td>implementors of java.lang.Serializable</td><td>VARBINARY</td><td> Unlike the other value types, multiple instances of this type are registered. It is registered
              once under java.io.Serializable, and registered under the specific java.io.Serializable implementation
              class names.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="value-composite-types"/>8.1.2. Composite types</h3></div></div></div><p>
        <em class="firstterm">Composite types</em>, or <em class="firstterm">embedded types</em>, as they are called by the Java
        Persistence API, have traditionally been called <em class="firstterm">components</em> in Hibernate. All of these
        terms mean the same thing.
      </p><p>
        Components represent aggregations of values into a single Java type. An example is an
        <code class="classname">Address</code> class, which aggregates street, city, state, and postal code.  A composite type
        behaves in a similar way to an entity. They are each classes written specifically for an application. They may
        both include references to other application-specific classes, as well as to collections and simple JDK
        types. The only distinguishing factors are that a component does not have its own lifecycle or define an
        identifier.
      </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="value-collection-types"/>8.1.3. Collection types</h3></div></div></div><p>
        A <em class="firstterm">collection</em> type refers to the data type itself, not its contents.
      </p><p>
        A Collection denotes a one-to-one or one-to-many relationship between tables of a database.
      </p><p>
        Refer to the chapter on Collections for more information on collections.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="entity-types"/>8.2. Entity Types</h2></div></div></div><p>
      Entities are application-specific classes which correlate to rows in a table, using a unique identifier. Because
      of the requirement for a unique identifier, ntities exist independently and define their own lifecycle. As an
      example, deleting a Membership should not delete the User or the Group. For more information, see the chapter on
      Persistent Classes.
    </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4708"/>8.3. Implications of different data categorizations</h2></div></div></div><p>
      NEEDS TO BE WRITTEN
    </p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="devguide-mappingEntities"/>Chapter 9. Mapping entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e4716">9.1. Hierarchies</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4716"/>9.1. Hierarchies</h2></div></div></div><p/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4720"/>Chapter 10. Mapping associations</h2></div></div></div><p>
    The most basic form of mapping in Hibernate is mapping a persistent entity class to a database table. You can expand
    on this concept by mapping associated classes together.  <a href="#">???</a> shows a
    <code class="classname">Person</code> class with a 
  </p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="chap-hql"/>Chapter 11. HQL and JPAQL</h2></div></div></div><p> </p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4735"/>Chapter 12. Criteria</h2></div></div></div><p> </p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4740"/>Chapter 13. Native-SQL</h2></div></div></div><p/></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4744"/>Chapter 14. JMX</h2></div></div></div><p> </p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4749"/>Chapter 15. Envers</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e4757">15.1. Basics</a></span></dt><dt><span class="section"><a href="#d0e4792">15.2. Configuration</a></span></dt><dt><span class="section"><a href="#d0e4988">15.3. Additional mapping annotations</a></span></dt><dt><span class="section"><a href="#d0e5035">15.4. Choosing an audit strategy</a></span></dt><dt><span class="section"><a href="#envers-revisionlog">15.5. Revision Log</a></span></dt><dd><dl><dt><span class="section"><a href="#envers-tracking-modified-entities-revchanges">15.5.1. Tracking entity names modified during revisions</a></span></dt></dl></dd><dt><span class="section"><a href="#envers-queries">15.6. Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#entities-at-revision">15.6.1. Querying for entities of a class at a given revision</a></span></dt><dt><span class="section"><a href="#revisions-of-entity">15.6.2. Querying for revisions, at which entities of a given class changed</a></span></dt><dt><span class="section"><a href="#envers-tracking-modified-entities-queries">15.6.3. Querying for entities modified in a given revision</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5431">15.7. Conditional auditing</a></span></dt><dt><span class="section"><a href="#d0e5469">15.8. Understanding the Envers Schema</a></span></dt><dt><span class="section"><a href="#envers-generateschema">15.9. Generating schema with Ant</a></span></dt><dt><span class="section"><a href="#envers-mappingexceptions">15.10. Mapping exceptions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5541">15.10.1. What isn't and will not be supported</a></span></dt><dt><span class="section"><a href="#d0e5561">15.10.2. What isn't and <span class="emphasis"><em>will</em></span> be supported</a></span></dt><dt><span class="section"><a href="#d0e5571">15.10.3. <code class="literal">@OneToMany</code>+<code class="literal">@JoinColumn</code></a></span></dt></dl></dd><dt><span class="section"><a href="#envers-partitioning">15.11. Advanced: Audit table partitioning</a></span></dt><dd><dl><dt><span class="section"><a href="#envers-partitioning-benefits">15.11.1. Benefits of audit table partitioning</a></span></dt><dt><span class="section"><a href="#envers-partitioning-columns">15.11.2. Suitable columns for audit table partitioning</a></span></dt><dt><span class="section"><a href="#envers-partitioning-example">15.11.3. Audit table partitioning example</a></span></dt></dl></dd><dt><span class="section"><a href="#envers-links">15.12. Envers links</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4752"/>Preface</h2></div></div></div><p>
            The aim of Hibernate Envers is to provide historical versioning of your application's entity data.  Much
            like source control management tools such as Subversion or Git, Hibernate Envers manages a notion of revisions
            if your application data through the use of audit tables.  Each transaction relates to one global revision number
            which can be used to identify groups of changes (much like a change set in source control).  As the revisions
            are global, having a revision number, you can query for various entities at that revision, retrieving a
            (partial) view of the database at that revision. You can find a revision number having a date, and the other
            way round, you can get the date at which a revision was committed.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4757"/>15.1. Basics</h2></div></div></div><p>
            To audit changes that are performed on an entity, you only need two things: the
            <code class="literal">hibernate-envers</code> jar on the classpath and an <code class="literal">@Audited</code> annotation
            on the entity.
        </p><p>
            And that's all - you can create, modify and delete the entites as always. If you look at the generated
            schema for your entities, or at the data persisted by Hibernate, you will notice that there are no changes.
            However, for each audited entity, a new table is introduced - <code class="literal">entity_table_AUD</code>,
            which stores the historical data, whenever you commit a transaction.
        </p><p>
            Instead of annotating the whole class and auditing all properties, you can annotate
            only some persistent properties with <code class="literal">@Audited</code>. This will cause only
            these properties to be audited.
        </p><p>
            The audit (history) of an entity can be accessed using the <code class="literal">AuditReader</code> interface, which
            can be obtained having an open <span class="ERROR">&lt;listeral&gt;EntityManager&lt;/listeral&gt;</span> or <code class="literal">Session</code> via
            the <code class="literal">AuditReaderFactory</code>. See the javadocs for these classes for details on the
            functionality offered.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4792"/>15.2. Configuration</h2></div></div></div><p>
            It is possible to configure various aspects of Hibernate Envers behavior, such as table names, etc.
        </p><div class="table"><a id="d0e4797"/><p class="title"><b>Table 15.1. Envers Configuration Properties</b></p><div class="table-contents"><table summary="Envers Configuration Properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property name</th><th>Default value</th><th>Description</th></tr></thead><tbody><tr><td>
                            <span class="property">org.hibernate.envers.audit_table_prefix</span>
                        </td><td>
                        </td><td>
                            String that will be prepended to the name of an audited entity to create the name of the
                            entity, that will hold audit information.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.audit_table_suffix</span>
                        </td><td>
                            _AUD
                        </td><td>
                            String that will be appended to the name of an audited entity to create the name of the
                            entity, that will hold audit information. If you audit an entity with a table name Person,
                            in the default setting Envers will generate a <code class="literal">Person_AUD</code> table to store
                            historical data.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.revision_field_name</span>
                        </td><td>
                            REV
                        </td><td>
                            Name of a field in the audit entity that will hold the revision number.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.revision_type_field_name</span>
                        </td><td>
                            REVTYPE
                        </td><td>
                            Name of a field in the audit entity that will hold the type of the revision (currently,
                            this can be: add, mod, del).
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.revision_on_collection_change</span>
                        </td><td>
                            true
                        </td><td>
                            Should a revision be generated when a not-owned relation field changes (this can be either
                            a collection in a one-to-many relation, or the field using "mappedBy" attribute in a
                            one-to-one relation).
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.do_not_audit_optimistic_locking_field</span>
                        </td><td>
                            true
                        </td><td>
                            When true, properties to be used for optimistic locking, annotated with
                            <code class="literal">@Version</code>, will be automatically not audited (their history won't be
                            stored; it normally doesn't make sense to store it).
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.store_data_at_delete</span>
                        </td><td>
                            false
                        </td><td>
                            Should the entity data be stored in the revision when the entity is deleted (instead of only
                            storing the id and all other properties as null). This is not normally needed, as the data is
                            present in the last-but-one revision. Sometimes, however, it is easier and more efficient to
                            access it in the last revision (then the data that the entity contained before deletion is
                            stored twice).
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.default_schema</span>
                        </td><td>
                            null (same schema as table being audited)
                        </td><td>
                            The default schema name that should be used for audit tables. Can be overridden using the
                            <code class="literal">@AuditTable(schema="...")</code> annotation. If not present, the schema will
                            be the same as the schema of the table being audited.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.default_catalog</span>
                        </td><td>
                            null (same catalog as table being audited)
                        </td><td>
                            The default catalog name that should be used for audit tables. Can be overridden using the
                            <code class="literal">@AuditTable(catalog="...")</code> annotation. If not present, the catalog will
                            be the same as the catalog of the normal tables.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.audit_strategy</span>
                        </td><td>
                            org.hibernate.envers.strategy.DefaultAuditStrategy
                        </td><td>
                            The audit strategy that should be used when persisting audit data. The default stores only
                            the revision, at which an entity was modified. An alternative, the
                            <code class="literal">org.hibernate.envers.strategy.ValidityAuditStrategy</code> stores both the
                            start revision and the end revision. Together these define when an audit row was valid,
                            hence the name ValidityAuditStrategy.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.audit_strategy_validity_end_rev_field_name</span>
                        </td><td>
                            REVEND
                        </td><td>
                            The column name that will hold the end revision number in audit entities. This property is
                            only valid if the validity audit strategy is used.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</span>
                        </td><td>
                            false
                        </td><td>
                            Should the timestamp of the end revision be stored, until which the data was valid, in
                            addition to the end revision itself.  This is useful to be able to purge old Audit records
                            out of a relational database by using table partitioning.  Partitioning requires a column
                            that exists within the table.  This property is only evaluated if the ValidityAuditStrategy
                            is used.
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</span>
                        </td><td>
                            REVEND_TSTMP
                        </td><td>
                            Column name of the timestamp of the end revision until which the data was valid.  Only used
                            if the ValidityAuditStrategy is used, and
                            <span class="property">org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</span>
                            evaluates to true
                        </td></tr><tr><td>
                            <span class="property">org.hibernate.envers.track_entities_changed_in_revision</span>
                        </td><td>
                            false
                        </td><td>
                            Should entity types, that have been modified during each revision, be tracked. The default
                            implementation creates <code class="literal">REVCHANGES</code> table that stores entity names
                            of modified persistent objects. Single record encapsulates the revision identifier
                            (foreign key to <code class="literal">REVINFO</code> table) and a string value. For more
                            information refer to <a href="#envers-tracking-modified-entities-revchanges" title="15.5.1. Tracking entity names modified during revisions">Section 15.5.1, “Tracking entity names modified during revisions”</a>
                            and <a href="#envers-tracking-modified-entities-queries" title="15.6.3. Querying for entities modified in a given revision">Section 15.6.3, “Querying for entities modified in a given revision”</a>.
                        </td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
                The following configuration options have been added recently and should be regarded as experimental:
                </p><div class="orderedlist"><ol><li>
                        org.hibernate.envers.track_entities_changed_in_revision
                    </li></ol></div><p>
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4988"/>15.3. Additional mapping annotations</h2></div></div></div><p>
            The name of the audit table can be set on a per-entity basis, using the
            <code class="literal">@AuditTable</code> annotation. It may be tedious to add this
            annotation to every audited entity, so if possible, it's better to use a prefix/suffix.
        </p><p>
            If you have a mapping with secondary tables, audit tables for them will be generated in
            the same way (by adding the prefix and suffix). If you wish to overwrite this behaviour,
            you can use the <code class="literal">@SecondaryAuditTable</code> and
            <code class="literal">@SecondaryAuditTables</code> annotations.
        </p><p>
            If you'd like to override auditing behaviour of some fields/properties in an embedded component, you can use
            the <code class="literal">@AuditOverride(s)</code> annotation on the usage site of the component.
        </p><p>
            If you want to audit a relation mapped with <code class="literal">@OneToMany+@JoinColumn</code>,
            please see <a href="#envers-mappingexceptions" title="15.10. Mapping exceptions">Section 15.10, “Mapping exceptions”</a> for a description of the additional
            <code class="literal">@AuditJoinTable</code> annotation that you'll probably want to use.
        </p><p>
            If you want to audit a relation, where the target entity is not audited (that is the case for example with
            dictionary-like entities, which don't change and don't have to be audited), just annotate it with
            <code class="literal">@Audited(targetAuditMode = RelationTargetAuditMode.NOT_AUDITED)</code>. Then, when reading historic
            versions of your entity, the relation will always point to the "current" related entity.
        </p><p>
            If you'd like to audit properties of a superclass of an entity, which are not explicitly audited (which
            don't have the <code class="literal">@Audited</code> annotation on any properties or on the class),
            you can list the superclasses in the <code class="literal">auditParents</code> attribute of the
            <code class="interfacename">@Audited</code> annotation.
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5035"/>15.4. Choosing an audit strategy</h2></div></div></div><p>
            After the basic configuration it is important to choose the audit strategy that will be used to persist
            and retrieve audit information. There is a trade-off between the performance of persisting and the
            performance of querying the audit information. Currently there two audit strategies.
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    The default audit strategy persists the audit data together with a start revision. For each row
                    inserted, updated or deleted in an audited table, one or more rows are inserted in the audit
                    tables, together with the start revision of its validity. Rows in the audit tables are never
                    updated after insertion.  Queries of audit information use subqueries to select the applicable
                    rows in the audit tables.  These subqueries are notoriously slow and difficult to index.
                </p></li><li><p>
                    The alternative is a validity audit strategy. This strategy stores the start-revision and the
                    end-revision of audit information. For each row inserted, updated or deleted in an audited table,
                    one or more rows are inserted in the audit tables, together with the start revision of its
                    validity. But at the same time the end-revision field of the previous audit rows (if available)
                    are set to this revision.  Queries on the audit information can then use 'between start and end
                    revision' instead of subqueries as used by the default audit strategy.
                </p><p>
                    The consequence of this strategy is that persisting audit information will be a bit slower,
                    because of the extra updates involved, but retrieving audit information will be a lot faster.
                    This can be improved by adding extra indexes.
                </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-revisionlog"/>15.5. Revision Log</h2></div><div><h3 class="subtitle">Logging data for revisions</h3></div></div></div><p>
            When Envers starts a new revision, it creates a new <em class="firstterm">revision entity</em> which stores
            information about the revision.  By default, that includes just
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><em class="firstterm">revision number</em> - An integral value (<code class="literal">int/Integer</code> or
                <code class="literal">long/Long</code>).  Essentially the primary key of the revision
            </li><li><em class="firstterm">revision timestamp</em> - either a <code class="literal">long/Long</code> or
                <code class="classname">java.util.Date</code> value representing the instant at which the revision was made.
                When using a <code class="classname">java.util.Date</code>, instead of a <code class="literal">long/Long</code> for
                the revision timestamp, take care not to store it to a column data type which will loose precision.
            </li></ol></div><p>
            Envers handles this information as an entity.  By default it uses its own internal class to act as the
            entity, mapped to the <code class="literal">REVINFO</code> table.
            You can, however, supply your own approach to collecting this information which might be useful to
            capture additional details such as who made a change or the ip address from which the request came.  There
            are 2 things you need to make this work.
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    First, you will need to tell Envers about the entity you wish to use.  Your entity must use the
                    <code class="interfacename">@org.hibernate.envers.RevisionEntity</code> annotation.  It must
                    define the 2 attributes described above annotated with
                    <code class="interfacename">@org.hibernate.envers.RevisionNumber</code> and
                    <code class="interfacename">@org.hibernate.envers.RevisionTimestamp</code>, respectively.  You can extend
                    from <code class="classname">org.hibernate.envers.DefaultRevisionEntity</code>, if you wish, to inherit all
                    these required behaviors.
                </p><p>
                    Simply add the custom revision entity as you do your normal entities.  Envers will "find it".  Note
                    that it is an error for there to be multiple entities marked as
                    <code class="interfacename">@org.hibernate.envers.RevisionEntity</code>
                </p></li><li><p>
                    Second, you need to tell Envers how to create instances of your revision entity which is handled
                    by the <code class="methodname">newRevision</code> method of the
                    <code class="interfacename">org.jboss.envers.RevisionListener</code> interface.
                </p><p>
                    You tell Envers your custom <code class="interfacename">org.hibernate.envers.RevisionListener</code>
                    implementation to use by specifying it on the
                    <code class="interfacename">@org.hibernate.envers.RevisionEntity</code> annotation, using the
                    <code class="methodname">value</code> attribute. If your <code class="interfacename">RevisionListener</code>
                    class is inaccessible from <code class="interfacename">@RevisionEntity</code> (e.g. exists in a different
                    module), set <span class="property">org.hibernate.envers.revision_listener</span> property to it's fully
                    qualified name. Class name defined by the configuration parameter overrides revision entity's
                    <code class="methodname">value</code> attribute. 
                </p></li></ol></div><pre class="programlisting">@Entity
@RevisionEntity( MyCustomRevisionListener.class )
public class MyCustomRevisionEntity {
    ...
}

public class MyCustomRevisionListener implements RevisionListener {
    public void newRevision(Object revisionEntity) {
        ( (MyCustomRevisionEntity) revisionEntity )...;
    }
}
</pre><p>
            An alternative method to using the <code class="interfacename">org.hibernate.envers.RevisionListener</code>
            is to instead call the <code class="methodname">getCurrentRevision</code> method of the
            <code class="interfacename">org.hibernate.envers.AuditReader</code> interface to obtain the current revision,
            and fill it with desired information.  The method accepts a <code class="literal">persist</code> parameter indicating
            whether the revision entity should be persisted prior to returning from this method. <code class="literal">true</code>
            ensures that the returned entity has access to its identifier value (revision number), but the revision
            entity will be persisted regardless of whether there are any audited entities changed. <code class="literal">false</code>
            means that the revision number will be <code class="literal">null</code>, but the revision entity will be persisted
            only if some audited entities have changed.
        </p><div class="example"><a id="d0e5169"/><p class="title"><b>Example 15.1. Example of storing username with revision</b></p><div class="example-contents"><pre class="programlisting">
                <code class="filename">ExampleRevEntity.java</code>

package org.hibernate.envers.example;

import org.hibernate.envers.RevisionEntity;
import org.hibernate.envers.DefaultRevisionEntity;

import javax.persistence.Entity;

@Entity
@RevisionEntity(ExampleListener.class)
public class ExampleRevEntity extends DefaultRevisionEntity {
    private String username;

    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
}</pre><pre class="programlisting">
                <code class="filename">ExampleListener.java</code>

package org.hibernate.envers.example;

import org.hibernate.envers.RevisionListener;
import org.jboss.seam.security.Identity;
import org.jboss.seam.Component;

public class ExampleListener implements RevisionListener {
    public void newRevision(Object revisionEntity) {
        ExampleRevEntity exampleRevEntity = (ExampleRevEntity) revisionEntity;
        Identity identity =
            (Identity) Component.getInstance("org.jboss.seam.security.identity");

        exampleRevEntity.setUsername(identity.getUsername());
    }
}</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="envers-tracking-modified-entities-revchanges"/>15.5.1. Tracking entity names modified during revisions</h3></div></div></div><p>
                By default entity types that have been changed in each revision are not being tracked. This implies the
                necessity to query all tables storing audited data in order to retrieve changes made during
                specified revision. Envers provides a simple mechanism that creates <code class="literal">REVCHANGES</code>
                table which stores entity names of modified persistent objects. Single record encapsulates the revision
                identifier (foreign key to <code class="literal">REVINFO</code> table) and a string value.
            </p><p>
                Tracking of modified entity names can be enabled in three different ways:
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>
                    Set <span class="property">org.hibernate.envers.track_entities_changed_in_revision</span> parameter to
                    <code class="literal">true</code>. In this case
                    <code class="classname">org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> will
                    be implicitly used as the revision log entity.
                </li><li>
                    Create a custom revision entity that extends
                    <code class="classname">org.hibernate.envers.DefaultTrackingModifiedEntitiesRevisionEntity</code> class.
                    <pre class="programlisting">
@Entity
@RevisionEntity
public class ExtendedRevisionEntity
             extends DefaultTrackingModifiedEntitiesRevisionEntity {
    ...
}</pre></li><li>
                    Mark an appropriate field of a custom revision entity with
                    <code class="interfacename">@org.hibernate.envers.ModifiedEntityNames</code> annotation. The property is
                    required to be of <code class="literal">Set&lt;String&gt;</code> type.
                    <pre class="programlisting">
@Entity
@RevisionEntity
public class AnnotatedTrackingRevisionEntity {
    ...

    @ElementCollection
    @JoinTable(name = "REVCHANGES", joinColumns = @JoinColumn(name = "REV"))
    @Column(name = "ENTITYNAME")
    @ModifiedEntityNames
    private Set&lt;String&gt; modifiedEntityNames;
    
    ...
}</pre></li></ol></div><p>
                Users, that have chosen one of the approaches listed above, can retrieve all entities modified in a
                specified revision by utilizing API described in <a href="#envers-tracking-modified-entities-queries" title="15.6.3. Querying for entities modified in a given revision">Section 15.6.3, “Querying for entities modified in a given revision”</a>.
            </p><p>
                Users are also allowed to implement custom mechanism of tracking modified entity types. In this case, they
                shall pass their own implementation of
                <code class="interfacename">org.hibernate.envers.EntityTrackingRevisionListener</code> interface as the value
                of <code class="interfacename">@org.hibernate.envers.RevisionEntity</code> annotation.
                <code class="interfacename">EntityTrackingRevisionListener</code> interface exposes one method that notifies
                whenever audited entity instance has been added, modified or removed within current revision boundaries.
            </p><div class="example"><a id="d0e5239"/><p class="title"><b>Example 15.2. Custom implementation of tracking entity classes modified during revisions</b></p><div class="example-contents"><pre class="programlisting">
                    <code class="filename">CustomEntityTrackingRevisionListener.java</code>

public class CustomEntityTrackingRevisionListener
             implements EntityTrackingRevisionListener {
    @Override
    public void entityChanged(Class entityClass, String entityName,
                              Serializable entityId, RevisionType revisionType,
                              Object revisionEntity) {
        String type = entityClass.getName();
        ((CustomTrackingRevisionEntity)revisionEntity).addModifiedEntityType(type);
    }

    @Override
    public void newRevision(Object revisionEntity) {
    }
}</pre><pre class="programlisting">
                    <code class="filename">CustomTrackingRevisionEntity.java</code>

@Entity
@RevisionEntity(CustomEntityTrackingRevisionListener.class)
public class CustomTrackingRevisionEntity {
    @Id
    @GeneratedValue
    @RevisionNumber
    private int customId;

    @RevisionTimestamp
    private long customTimestamp;

    @OneToMany(mappedBy="revision", cascade={CascadeType.PERSIST, CascadeType.REMOVE})
    private Set&lt;ModifiedEntityTypeEntity&gt; modifiedEntityTypes =
                                              new HashSet&lt;ModifiedEntityTypeEntity&gt;();
    
    public void addModifiedEntityType(String entityClassName) {
        modifiedEntityTypes.add(new ModifiedEntityTypeEntity(this, entityClassName));
    }
    
    ...
}
</pre><pre class="programlisting">
                    <code class="filename">ModifiedEntityTypeEntity.java</code>

@Entity
public class ModifiedEntityTypeEntity {
    @Id
    @GeneratedValue
    private Integer id;

    @ManyToOne
    private CustomTrackingRevisionEntity revision;
    
    private String entityClassName;
    
    ...
}
</pre><pre class="programlisting">CustomTrackingRevisionEntity revEntity =
    getAuditReader().findRevision(CustomTrackingRevisionEntity.class, revisionNumber);
Set&lt;ModifiedEntityTypeEntity&gt; modifiedEntityTypes = revEntity.getModifiedEntityTypes()</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-queries"/>15.6. Queries</h2></div></div></div><p>
            You can think of historic data as having two dimension. The first - horizontal -
            is the state of the database at a given revision. Thus, you can
            query for entities as they were at revision N. The second - vertical - are the
            revisions, at which entities changed. Hence, you can query for revisions,
            in which a given entity changed.
        </p><p>
            The queries in Envers are similar to
            <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.hibernate.org/hib_docs/v3/reference/en/html/querycriteria.html">Hibernate Criteria</a>,
            so if you are common with them, using Envers queries will be much easier.
        </p><p>
            The main limitation of the current queries implementation is that you cannot
            traverse relations. You can only specify constraints on the ids of the
            related entities, and only on the "owning" side of the relation. This however
            will be changed in future releases.
        </p><p>
            Please note, that queries on the audited data will be in many cases much slower
            than corresponding queries on "live" data, as they involve correlated subselects.
        </p><p>
            In the future, queries will be improved both in terms of speed and possibilities, when using the valid-time
            audit strategy, that is when storing both start and end revisions for entities. See
            <a href="#">???</a>.
        </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="entities-at-revision"/>15.6.1. Querying for entities of a class at a given revision</h3></div></div></div><p>
                The entry point for this type of queries is:
            </p><pre class="programlisting">AuditQuery query = getAuditReader()
    .createQuery()
    .forEntitiesAtRevision(MyEntity.class, revisionNumber);</pre><p>
                You can then specify constraints, which should be met by the entities returned, by
                adding restrictions, which can be obtained using the <code class="literal">AuditEntity</code>
                factory class. For example, to select only entities, where the "name" property
                is equal to "John":
            </p><pre class="programlisting">query.add(AuditEntity.property("name").eq("John"));</pre><p>
                And to select only entites that are related to a given entity:
            </p><pre class="programlisting">query.add(AuditEntity.property("address").eq(relatedEntityInstance));
// or
query.add(AuditEntity.relatedId("address").eq(relatedEntityId));</pre><p>
                You can limit the number of results, order them, and set aggregations and projections
                (except grouping) in the usual way.
                When your query is complete, you can obtain the results by calling the
                <code class="literal">getSingleResult()</code> or <code class="literal">getResultList()</code> methods.
            </p><p>
                A full query, can look for example like this:
            </p><pre class="programlisting">List personsAtAddress = getAuditReader().createQuery()
    .forEntitiesAtRevision(Person.class, 12)
    .addOrder(AuditEntity.property("surname").desc())
    .add(AuditEntity.relatedId("address").eq(addressId))
    .setFirstResult(4)
    .setMaxResults(2)
    .getResultList();</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="revisions-of-entity"/>15.6.2. Querying for revisions, at which entities of a given class changed</h3></div></div></div><p>
                The entry point for this type of queries is:
            </p><pre class="programlisting">AuditQuery query = getAuditReader().createQuery()
    .forRevisionsOfEntity(MyEntity.class, false, true);</pre><p>
                You can add constraints to this query in the same way as to the previous one.
                There are some additional possibilities:
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                        using <code class="literal">AuditEntity.revisionNumber()</code> you can specify constraints, projections
                        and order on the revision number, in which the audited entity was modified
                    </p></li><li><p>
                        similarly, using <code class="literal">AuditEntity.revisionProperty(propertyName)</code> you can specify constraints,
                        projections and order on a property of the revision entity, corresponding to the revision
                        in which the audited entity was modified
                    </p></li><li><p>
                        <code class="literal">AuditEntity.revisionType()</code> gives you access as above to the type of
                        the revision (ADD, MOD, DEL).
                    </p></li></ol></div><p>
                Using these methods,
                you can order the query results by revision number, set projection or constraint
                the revision number to be greater or less than a specified value, etc. For example, the
                following query will select the smallest revision number, at which entity of class
                <code class="literal">MyEntity</code> with id <code class="literal">entityId</code> has changed, after revision
                number 42:
            </p><pre class="programlisting">Number revision = (Number) getAuditReader().createQuery()
    .forRevisionsOfEntity(MyEntity.class, false, true)
    .setProjection(AuditEntity.revisionNumber().min())
    .add(AuditEntity.id().eq(entityId))
    .add(AuditEntity.revisionNumber().gt(42))
    .getSingleResult();</pre><p>
                The second additional feature you can use in queries for revisions is the ability
                to maximalize/minimize a property. For example, if you want to select the
                revision, at which the value of the <code class="literal">actualDate</code> for a given entity
                was larger then a given value, but as small as possible:
            </p><pre class="programlisting">Number revision = (Number) getAuditReader().createQuery()
    .forRevisionsOfEntity(MyEntity.class, false, true)
    // We are only interested in the first revision
    .setProjection(AuditEntity.revisionNumber().min())
    .add(AuditEntity.property("actualDate").minimize()
        .add(AuditEntity.property("actualDate").ge(givenDate))
        .add(AuditEntity.id().eq(givenEntityId)))
    .getSingleResult();
</pre><p>
                The <code class="literal">minimize()</code> and <code class="literal">maximize()</code> methods return a criteria,
                to which you can add constraints, which must be met by the entities with the
                maximized/minimized properties.
            </p><p>
                You probably also noticed that there are two boolean parameters, passed when
                creating the query. The first one, <code class="literal">selectEntitiesOnly</code>, is only valid when
                you don't set an explicit projection. If true, the result of the query will be
                a list of entities (which changed at revisions satisfying the specified
                constraints).
            </p><p>
                If false, the result will be a list of three element arrays. The
                first element will be the changed entity instance. The second will be an entity
                containing revision data (if no custom entity is used, this will be an instance
                of <code class="literal">DefaultRevisionEntity</code>). The third will be the type of the
                revision (one of the values of the <code class="literal">RevisionType</code> enumeration:
                ADD, MOD, DEL).
            </p><p>
                The second parameter, <code class="literal">selectDeletedEntities</code>, specifies if revisions,
                in which the entity was deleted should be included in the results. If yes, such entities
                will have the revision type DEL and all fields, except the id,
                <code class="literal">null</code>.
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="envers-tracking-modified-entities-queries"/>15.6.3. Querying for entities modified in a given revision</h3></div></div></div><p>
                The basic query allows retrieving entity names and corresponding Java classes changed in a specified revision:
            </p><pre class="programlisting">Set&lt;Pair&lt;String, Class&gt;&gt; modifiedEntityTypes = getAuditReader()
    .getCrossTypeRevisionChangesReader().findEntityTypes(revisionNumber);</pre><p>
                Other queries (also accessible from <code class="interfacename">org.hibernate.envers.CrossTypeRevisionChangesReader</code>):
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><em class="firstterm"><code class="methodname">List&lt;Object&gt; findEntities(Number)</code></em>
                    - Returns snapshots of all audited entities changed (added, updated and removed) in a given revision.
                    Executes <code class="literal">n+1</code> SQL queries, where <code class="literal">n</code> is a number of different entity
                    classes modified within specified revision.
                </li><li><em class="firstterm"><code class="methodname">List&lt;Object&gt; findEntities(Number, RevisionType)</code></em>
                    - Returns snapshots of all audited entities changed (added, updated or removed) in a given revision
                    filtered by modification type. Executes <code class="literal">n+1</code> SQL queries, where <code class="literal">n</code>
                    is a number of different entity classes modified within specified revision.
                </li><li><em class="firstterm"><code class="methodname">Map&lt;RevisionType, List&lt;Object&gt;&gt; findEntitiesGroupByRevisionType(Number)</code></em>
                    - Returns a map containing lists of entity snapshots grouped by modification operation (e.g.
                    addition, update and removal). Executes <code class="literal">3n+1</code> SQL queries, where <code class="literal">n</code>
                    is a number of different entity classes modified within specified revision.
                </li></ol></div><p>
                Note that methods described above can be legally used only when default mechanism of
                tracking changed entity names is enabled (see <a href="#envers-tracking-modified-entities-revchanges" title="15.5.1. Tracking entity names modified during revisions">Section 15.5.1, “Tracking entity names modified during revisions”</a>).
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5431"/>15.7. Conditional auditing</h2></div></div></div><p>
            Envers persists audit data in reaction to various Hibernate events (e.g. post update, post insert, and
            so on), using a series of even listeners from the <code class="literal">org.hibernate.envers.event</code>
            package. By default, if the Envers jar is in the classpath, the event listeners are auto-registered with
            Hibernate.
        </p><p>
            Conditional auditing can be implemented by overriding some of the Envers event listeners.
            To use customized Envers event listeners, the following steps are needed:
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>
                Turn off automatic Envers event listeners registration by setting the
                <code class="literal">hibernate.listeners.envers.autoRegister</code>
                Hibernate property to <code class="literal">false</code>.
            </li><li>
                Create subclasses for appropriate event listeners. For example, if you want to conditionally audit
                entity insertions, extend the
                <code class="literal">org.hibernate.envers.eventEnversPostInsertEventListenerImpl</code>
                class. Place the conditional-auditing logic in the subclasses, call the super method if auditing
                should be performed.
            </li><li>
                Create your own implementation of <code class="literal">org.hibernate.integrator.spi.Integrator</code>,
                similar to <code class="literal">org.hibernate.envers.event.EnversIntegrator</code>. Use your event listener
                classes instead of the default ones.
            </li><li>
                For the integrator to be automatically used when Hibernate starts up, you will need to add a
                <code class="literal">META-INF/services/org.hibernate.integrator.spi.Integrator</code> file to your jar.
                The file should contain the fully qualified name of the class implementing the interface.
            </li></ol></div><p>
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5469"/>15.8. Understanding the Envers Schema</h2></div></div></div><p>
            For each audited entity (that is, for each entity containing at least one audited field), an audit table is
            created.  By default, the audit table's name is created by adding a "_AUD" suffix to the original table name,
            but this can be overridden by specifying a different suffix/prefix in the configuration or per-entity using
            the <code class="interfacename">@org.hibernate.envers.AuditTable</code> annotation.
        </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><p class="title"><b>Audit table columns</b></p><ol><li><p>
                    id of the original entity (this can be more then one column in the case of composite primary keys)
                </p></li><li><p>
                    revision number - an integer.  Matches to the revision number in the revision entity table.
                </p></li><li><p>
                    revision type - a small integer
                </p></li><li><p>
                    audited fields from the original entity
                </p></li></ol></div><p>
            The primary key of the audit table is the combination of the original id of the entity and the revision
            number - there can be at most one historic entry for a given entity instance at a given revision.
        </p><p>
            The current entity data is stored in the original table and in the audit table.  This is a duplication of
            data, however as this solution makes the query system much more powerful, and as memory is cheap, hopefully
            this won't be a major drawback for the users.  A row in the audit table with entity id ID, revision N and
            data D means: entity with id ID has data D from revision N upwards.  Hence, if we want to find an entity at
            revision M, we have to search for a row in the audit table, which has the revision number smaller or equal
            to M, but as large as possible. If no such row is found, or a row with a "deleted" marker is found, it means
            that the entity didn't exist at that revision.
        </p><p>
            The "revision type" field can currently have three values: 0, 1, 2, which means ADD, MOD and DEL,
            respectively. A row with a revision of type DEL will only contain the id of the entity and no data (all
            fields NULL), as it only serves as a marker saying "this entity was deleted at that revision".
        </p><p>
            Additionally, there is a <span class="ERROR">&lt;term&gt;revision entity&lt;/term&gt;</span> table which contains the information about the
            global revision.  By default the generated table is named <span class="database">REVINFO</span> and
            contains just 2 columns: <span class="database">ID</span> and <span class="database">TIMESTAMP</span>.
            A row is inserted into this table on each new revision, that is, on each commit of a transaction, which
            changes audited data.  The name of this table can be configured, the name of its columns as well as adding
            additional columns can be achieved as discussed in <a href="#envers-revisionlog" title="15.5. Revision Log">Section 15.5, “Revision Log”</a>.
        </p><p>
            While global revisions are a good way to provide correct auditing of relations, some people have pointed out
            that this may be a bottleneck in systems, where data is very often modified.  One viable solution is to
            introduce an option to have an entity "locally revisioned", that is revisions would be created for it
            independently.  This wouldn't enable correct versioning of relations, but wouldn't also require the
            <span class="database">REVINFO</span> table.  Another possibility is to introduce a notion of
            "revisioning groups": groups of entities which share revision numbering.  Each such group would have to
            consist of one or more strongly connected component of the graph induced by relations between entities.
            Your opinions on the subject are very welcome on the forum! :)
        </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-generateschema"/>15.9. Generating schema with Ant</h2></div></div></div><p>
            If you'd like to generate the database schema file with the Hibernate Tools Ant task,
            you'll probably notice that the generated file doesn't contain definitions of audit
            tables. To generate also the audit tables, you simply need to use
            <code class="literal">org.hibernate.tool.ant.EnversHibernateToolTask</code> instead of the usual
            <code class="literal">org.hibernate.tool.ant.HibernateToolTask</code>. The former class extends
            the latter, and only adds generation of the version entities. So you can use the task
            just as you used to.
        </p><p>
            For example:
        </p><pre class="programlisting">&lt;target name="schemaexport" depends="build-demo"
  description="Exports a generated schema to DB and file"&gt;
  &lt;taskdef name="hibernatetool"
    classname="org.hibernate.tool.ant.EnversHibernateToolTask"
    classpathref="build.demo.classpath"/&gt;

  &lt;hibernatetool destdir="."&gt;
    &lt;classpath&gt;
      &lt;fileset refid="lib.hibernate" /&gt;
      &lt;path location="${build.demo.dir}" /&gt;
      &lt;path location="${build.main.dir}" /&gt;
    &lt;/classpath&gt;
    &lt;jpaconfiguration persistenceunit="ConsolePU" /&gt;
    &lt;hbm2ddl
      drop="false"
      create="true"
      export="false"
      outputfilename="versioning-ddl.sql"
      delimiter=";"
      format="true"/&gt;
  &lt;/hibernatetool&gt;
&lt;/target&gt;</pre><p>
            Will generate the following schema:
        </p><pre class="programlisting">
    create table Address (
        id integer generated by default as identity (start with 1),
        flatNumber integer,
        houseNumber integer,
        streetName varchar(255),
        primary key (id)
    );

    create table Address_AUD (
        id integer not null,
        REV integer not null,
        flatNumber integer,
        houseNumber integer,
        streetName varchar(255),
        REVTYPE tinyint,
        primary key (id, REV)
    );

    create table Person (
        id integer generated by default as identity (start with 1),
        name varchar(255),
        surname varchar(255),
        address_id integer,
        primary key (id)
    );

    create table Person_AUD (
        id integer not null,
        REV integer not null,
        name varchar(255),
        surname varchar(255),
        REVTYPE tinyint,
        address_id integer,
        primary key (id, REV)
    );

    create table REVINFO (
        REV integer generated by default as identity (start with 1),
        REVTSTMP bigint,
        primary key (REV)
    );

    alter table Person
        add constraint FK8E488775E4C3EA63
        foreign key (address_id)
        references Address;
    </pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-mappingexceptions"/>15.10. Mapping exceptions</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5541"/>15.10.1. What isn't and will not be supported</h3></div></div></div><p>
                Bags (the corresponding Java type is List), as they can contain non-unique elements.
                The reason is that persisting, for example a bag of String-s, violates a principle
                of relational databases: that each table is a set of tuples. In case of bags,
                however (which require a join table), if there is a duplicate element, the two
                tuples corresponding to the elements will be the same. Hibernate allows this,
                however Envers (or more precisely: the database connector) will throw an exception
                when trying to persist two identical elements, because of a unique constraint violation.
            </p><p>
                There are at least two ways out if you need bag semantics:
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                        use an indexed collection, with the <code class="literal">@IndexColumn</code> annotation, or
                    </p></li><li><p>
                        provide a unique id for your elements with the <code class="literal">@CollectionId</code> annotation.
                    </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5561"/>15.10.2. What isn't and <span class="emphasis"><em>will</em></span> be supported</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                        collections of components
                    </p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5571"/>15.10.3. <code class="literal">@OneToMany</code>+<code class="literal">@JoinColumn</code></h3></div></div></div><p>
                When a collection is mapped using these two annotations, Hibernate doesn't
                generate a join table. Envers, however, has to do this, so that when you read the
                revisions in which the related entity has changed, you don't get false results.
            </p><p>
                To be able to name the additional join table, there is a special annotation:
                <code class="literal">@AuditJoinTable</code>, which has similar semantics to JPA's
                <code class="literal">@JoinTable</code>.
            </p><p>
                One special case are relations mapped with <code class="literal">@OneToMany</code>+<code class="literal">@JoinColumn</code> on
                the one side, and <code class="literal">@ManyToOne</code>+<code class="literal">@JoinColumn(insertable=false, updatable=false</code>)
                on the many side.
                Such relations are in fact bidirectional, but the owning side is the collection (see alse
                <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html_single/#entity-hibspec-collection-extratype">here</a>).
            </p><p>
                To properly audit such relations with Envers, you can use the <code class="literal">@AuditMappedBy</code> annotation.
                It enables you to specify the reverse property (using the <code class="literal">mappedBy</code> element). In case
                of indexed collections, the index column must also be mapped in the referenced entity (using
                <code class="literal">@Column(insertable=false, updatable=false)</code>, and specified using
                <code class="literal">positionMappedBy</code>. This annotation will affect only the way
                Envers works. Please note that the annotation is experimental and may change in the future.
            </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-partitioning"/>15.11. Advanced: Audit table partitioning</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="envers-partitioning-benefits"/>15.11.1. Benefits of audit table partitioning</h3></div></div></div><p>
                Because audit tables tend to grow indefinitely they can quickly become really large. When the audit tables have grown
                to a certain limit (varying per RDBMS and/or operating system) it makes sense to start using table partitioning.
                SQL table partitioning offers a lot of advantages including, but certainly not limited to:
                </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                            Improved query performance by selectively moving rows to various partitions (or even purging old rows)
                        </p></li><li><p>
                            Faster data loads, index creation, etc.
                        </p></li></ol></div><p>
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="envers-partitioning-columns"/>15.11.2. Suitable columns for audit table partitioning</h3></div></div></div><p>
                Generally SQL tables must be partitioned on a column that exists within the table. As a rule it makes sense to use
                either the <span class="emphasis"><em>end revision</em></span> or the <span class="emphasis"><em>end revision timestamp</em></span> column for
                partioning of audit tables.
                </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
                        End revision information is not available for the default AuditStrategy.
                    </p><p>
                        Therefore the following Envers configuration options are required:
                    </p><p>
                        <code class="literal">org.hibernate.envers.audit_strategy</code> =
                        <code class="literal">org.hibernate.envers.strategy.ValidityAuditStrategy</code>
                    </p><p>
                        <code class="literal">org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</code> =
                        <code class="literal">true</code>
                    </p><p>
                        Optionally, you can also override the default values following properties:
                    </p><p>
                        <code class="literal">org.hibernate.envers.audit_strategy_validity_end_rev_field_name</code>
                    </p><p>
                        <code class="literal">org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</code>
                    </p><p>
                        For more information, see <a href="#">???</a>.
                    </p></div><p>
            </p><p>
                The reason why the end revision information should be used for audit table partioning is based on the assumption that
                audit tables should be partionioned on an 'increasing level of interestingness', like so:
            </p><p>
                </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                            A couple of partitions with audit data that is not very (or no longer) interesting.
                            This can be stored on slow media, and perhaps even be purged eventually.
                        </p></li><li><p>
                            Some partitions for audit data that is potentially interesting.
                        </p></li><li><p>
                            One partition for audit data that is most likely to be interesting.
                            This should be stored on the fastest media, both for reading and writing.
                        </p></li></ol></div><p>
            </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="envers-partitioning-example"/>15.11.3. Audit table partitioning example</h3></div></div></div><p>
                In order to determine a suitable column for the 'increasing level of interestingness',
                consider a simplified example of a salary registration for an unnamed agency.
            </p><p>
                Currently, the salary table contains the following rows for a certain person X:

                </p><div class="table"><a id="d0e5706"/><p class="title"><b>Table 15.2. Salaries table</b></p><div class="table-contents"><table summary="Salaries table" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Year</th><th>Salary (USD)</th></tr></thead><tbody><tr><td>2006</td><td>3300</td></tr><tr><td>2007</td><td>3500</td></tr><tr><td>2008</td><td>4000</td></tr><tr><td>2009</td><td>4500</td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><p>
                The salary for the current fiscal year (2010) is unknown. The agency requires that all changes in registered
                salaries for a fiscal year are recorded (i.e. an audit trail). The rationale behind this is that decisions
                made at a certain date are based on the registered salary at that time. And at any time it must be possible
                reproduce the reason why a certain decision was made at a certain date.
            </p><p>
                The following audit information is available, sorted on in order of occurrence:

                </p><div class="table"><a id="d0e5744"/><p class="title"><b>Table 15.3. Salaries - audit table</b></p><div class="table-contents"><table summary="Salaries - audit table" border="1"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Year</th><th>Revision type</th><th>Revision timestamp</th><th>Salary (USD)</th><th>End revision timestamp</th></tr></thead><tbody><tr><td>2006</td><td>ADD</td><td>2007-04-01</td><td>3300</td><td>null</td></tr><tr><td>2007</td><td>ADD</td><td>2008-04-01</td><td>35</td><td>2008-04-02</td></tr><tr><td>2007</td><td>MOD</td><td>2008-04-02</td><td>3500</td><td>null</td></tr><tr><td>2008</td><td>ADD</td><td>2009-04-01</td><td>3700</td><td>2009-07-01</td></tr><tr><td>2008</td><td>MOD</td><td>2009-07-01</td><td>4100</td><td>2010-02-01</td></tr><tr><td>2008</td><td>MOD</td><td>2010-02-01</td><td>4000</td><td>null</td></tr><tr><td>2009</td><td>ADD</td><td>2010-04-01</td><td>4500</td><td>null</td></tr></tbody></table></div></div><p><br class="table-break"/>
            </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="envers-partitioning-example-column"/>15.11.3.1. Determining a suitable partitioning column</h4></div></div></div><p>
                    To partition this data, the 'level of interestingness' must be defined.
                    Consider the following:
                    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                                For fiscal year 2006 there is only one revision. It has the oldest <span class="emphasis"><em>revision timestamp</em></span>
                                of all audit rows, but should still be regarded as interesting because it is the latest modification
                                for this fiscal year in the salary table; its <span class="emphasis"><em>end revision timestamp</em></span> is null.
                            </p><p>
                                Also note that it would be very unfortunate if in 2011 there would be an update of the salary for fiscal
                                year 2006 (which is possible in until at least 10 years after the fiscal year) and the audit
                                information would have been moved to a slow disk (based on the age of the
                                <span class="emphasis"><em>revision timestamp</em></span>). Remember that in this case Envers will have to update
                                the <span class="emphasis"><em>end revision timestamp</em></span> of the most recent audit row.
                            </p></li><li><p>
                                There are two revisions in the salary of fiscal year 2007 which both have nearly the same
                                <span class="emphasis"><em>revision timestamp</em></span> and a different <span class="emphasis"><em>end revision timestamp</em></span>.
                                On first sight it is evident that the first revision was a mistake and probably uninteresting.
                                The only interesting revision for 2007 is the one with <span class="emphasis"><em>end revision timestamp</em></span> null.
                            </p></li></ol></div><p>

                    Based on the above, it is evident that only the <span class="emphasis"><em>end revision timestamp</em></span> is suitable for
                    audit table partitioning. The <span class="emphasis"><em>revision timestamp</em></span> is not suitable.
                </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="envers-partitioning-example-scheme"/>15.11.3.2. Determining a suitable partitioning scheme</h4></div></div></div><p>
                    A possible partitioning scheme for the salary table would be as follows:
                    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                                <span class="emphasis"><em>end revision timestamp</em></span> year = 2008
                            </p><p>
                                This partition contains audit data that is not very (or no longer) interesting.
                            </p></li><li><p>
                                <span class="emphasis"><em>end revision timestamp</em></span> year = 2009
                            </p><p>
                                This partition contains audit data that is potentially interesting.
                            </p></li><li><p>
                                <span class="emphasis"><em>end revision timestamp</em></span> year &gt;= 2010 or null
                            </p><p>
                                This partition contains the most interesting audit data.
                            </p></li></ol></div><p>
                </p><p>
                    This partitioning scheme also covers the potential problem of the update of the
                    <span class="emphasis"><em>end revision timestamp</em></span>, which occurs if a row in the audited table is modified.
                    Even though Envers will update the <span class="emphasis"><em>end revision timestamp</em></span> of the audit row to
                    the system date at the instant of modification, the audit row will remain in the same partition
                    (the 'extension bucket').
                </p><p>
                    And sometime in 2011, the last partition (or 'extension bucket') is split into two new partitions:
                    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                                <span class="emphasis"><em>end revision timestamp</em></span> year = 2010
                            </p><p>
                                This partition contains audit data that is potentially interesting (in 2011).
                            </p></li><li><p>
                                <span class="emphasis"><em>end revision timestamp</em></span> year &gt;= 2011 or null
                            </p><p>
                                This partition contains the most interesting audit data and is the new 'extension bucket'.
                            </p></li></ol></div><p>
                </p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="envers-links"/>15.12. Envers links</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://hibernate.org">Hibernate main page</a>
                </p></li><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://community.jboss.org/en/envers?view=discussions">Forum</a>
                </p></li><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://opensource.atlassian.com/projects/hibernate/browse/HHH">JIRA issue tracker</a>
                    (when adding issues concerning Envers, be sure to select the "envers" component!)
                </p></li><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="irc://irc.freenode.net:6667/envers">IRC channel</a>
                </p></li><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/feeds/view/envers">Envers Blog</a>
                </p></li><li><p>
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://community.jboss.org/wiki/EnversFAQ">FAQ</a>
                </p></li></ol></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appendix-Configuration_Properties"/>Appendix A. Configuration properties</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5988"/>A.1. General Configuration</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><tbody><tr><td>hibernate.dialect</td><td>A fully-qualified classname</td><td>
              <p>
                The classname of a Hibernate <code class="classname">org.hibernate.dialect.Dialect</code> from which Hibernate
                can generate SQL optimized for a particular relational database.
              </p>
              <p>
                In most cases Hibernate can choose the correct <code class="classname">org.hibernate.dialect.Dialect</code>
                implementation based on the JDBC metadata returned by the JDBC driver.
              </p>
            </td></tr><tr><td>hibernate.show_sql</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Write all SQL statements to the console. This is an alternative to setting the log category
            <span class="property">org.hibernate.SQL</span> to debug.</td></tr><tr><td>hibernate.format_sql</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Pretty-print the SQL in the log and console.</td></tr><tr><td>hibernate.default_schema</td><td>A schema name</td><td>Qualify unqualified table names with the given schema or tablespace in generated SQL.</td></tr><tr><td>hibernate.default_catalog</td><td>A catalog name</td><td>Qualifies unqualified table names with the given catalog in generated SQL.</td></tr><tr><td>hibernate.session_factory_name</td><td>A JNDI name</td><td>The <code class="classname">org.hibernate.SessionFactory</code> is automatically bound to this name in JNDI
            after it is created.</td></tr><tr><td>hibernate.max_fetch_depth</td><td>A value between <code class="literal">0</code> and <code class="literal">3</code></td><td>Sets a maximum depth for the outer join fetch tree for single-ended associations. A single-ended
            assocation is a one-to-one or many-to-one assocation. A value of <code class="literal">0</code> disables default outer
            join fetching.</td></tr><tr><td>hibernate.default_batch_fetch_size</td><td><p><code class="literal">4</code>,<code class="literal">8</code>, or <code class="literal">16</code></p></td><td>Default size for Hibernate batch fetching of associations.</td></tr><tr><td>hibernate.default_entity_mode</td><td><p>One of <code class="literal">dynamic-map</code>, <code class="literal">dom4j</code>,
            <code class="literal">pojo</code></p></td><td>Default mode for entity representation for all sessions opened from this
            <code class="classname">SessionFactory</code></td></tr><tr><td>hibernate.order_updates</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Forces Hibernate to order SQL updates by the primary key value of the items being updated. This
            reduces the likelihood of transaction deadlocks in highly-concurrent systems.</td></tr><tr><td>hibernate.generate_statistics</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Causes Hibernate to collect statistics for performance tuning.</td></tr><tr><td>hibernate.use_identifier_rollback</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>If true, generated identifier properties are reset to default values when objects are
            deleted.</td></tr><tr><td>hibernate.use_sql_comments</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>If true, Hibernate generates comments inside the SQL, for easier debugging.</td></tr></tbody></table></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6163"/>A.2. Database configuration</h2></div></div></div><div class="table"><a id="d0e6166"/><p class="title"><b>Table A.1. JDBC properties</b></p><div class="table-contents"><table summary="JDBC properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property</th><th>Example</th><th>Purpose</th></tr></thead><tbody><tr><td>hibernate.jdbc.fetch_size</td><td><code class="literal">0</code> or an integer</td><td>A non-zero value determines the JDBC fetch size, by calling
            <code class="methodname">Statement.setFetchSize()</code>.</td></tr><tr><td>hibernate.jdbc.batch_size</td><td><p>A value between <code class="literal">5</code> and <code class="literal">30</code></p></td><td>A non-zero value causes Hibernate to use JDBC2 batch updates.</td></tr><tr><td>hibernate.jdbc.batch_versioned_data</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td><p>Set this property to <code class="literal">true</code> if your JDBC driver returns correct row counts
            from <code class="methodname">executeBatch()</code>. This option is usually safe, but is disabled by default. If
            enabled, Hibernate uses batched DML for automatically versioned data.</p></td></tr><tr><td>hibernate.jdbc.factory_class</td><td>The fully-qualified class name of the factory</td><td><p>Select a custom <code class="classname">org.hibernate.jdbc.Batcher</code>. Irrelevant for most
            applications.</p></td></tr><tr><td>hibernate.jdbc.use_scrollable_resultset</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Enables Hibernate to use JDBC2 scrollable resultsets. This property is only relevant for
            user-supplied JDBC connections. Otherwise, Hibernate uses connection metadata.</td></tr><tr><td>hibernate.jdbc.use_streams_for_binary</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td><p>Use streams when writing or reading <span class="type">binary</span> or <span class="type">serializable</span> types to
            or from JDBC. This is a system-level property.</p></td></tr><tr><td>hibernate.jdbc.use_get_generated_keys</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td><p>Allows Hibernate to use JDBC3 <code class="classname">PreparedStatement.getGeneratedKeys()</code> to
            retrieve natively-generated keys after insert. You need the JDBC3+ driver and JRE1.4+. Disable this property
            if your driver has problems with the Hibernate identifier generators. By default, it tries to detect the
            driver capabilities from connection metadata.</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6281"/><p class="title"><b>Table A.2. Cache Properties</b></p><div class="table-contents"><table summary="Cache Properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property</th><th>Example</th><th>Purpose</th></tr></thead><tbody><tr><td>hibernate.cache.provider_class</td><td>Fully-qualified classname</td><td>The classname of a custom CacheProvider.</td></tr><tr><td>hibernate.cache.use_minimal_puts</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Optimizes second-level cache operation to minimize writes, at the cost of more frequent reads. This
            is most useful for clustered caches and is enabled by default for clustered cache implementations.</td></tr><tr><td>hibernate.cache.use_query_cache</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Enables the query cache. You still need to set individual queries to be cachable.</td></tr><tr><td>hibernate.cache.use_second_level_cache</td><td><p><code class="literal">true</code> or
            <code class="literal">false</code></p></td><td>Completely disable the second level cache, which is enabled
            by default for classes which specify a &lt;cache&gt; mapping.</td></tr><tr><td>hibernate.cache.query_cache_factory</td><td>Fully-qualified classname</td><td>A custom <code class="interfacename">QueryCache</code> interface. The default is the built-in
            <code class="interfacename">StandardQueryCache</code>.</td></tr><tr><td>hibernate.cache.region_prefix</td><td>A string</td><td>A prefix for second-level cache region names.</td></tr><tr><td>hibernate.cache.use_structured_entries</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Forces Hibernate to store data in the second-level cache in a more human-readable format.</td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="d0e6372"/><p class="title"><b>Table A.3. Transactions properties</b></p><div class="table-contents"><table summary="Transactions properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property</th><th>Example</th><th>Purpose</th></tr></thead><tbody><tr><td>hibernate.transaction.factory_class</td><td>A fully-qualified classname</td><td>The classname of a <code class="classname">TransactionFactory</code> to use with Hibernate Transaction API. The
            default is <code class="classname">JDBCTransactionFactory</code>).</td></tr><tr><td>jta.UserTransaction</td><td>A JNDI name</td><td><p>The <code class="classname">JTATransactionFactory</code> needs a JNDI name to obtain the JTA
            UserTransaction from the application server.</p></td></tr><tr><td>hibernate.transaction.manager_lookup_class</td><td>A fully-qualified classname</td><td><p>The classname of a <code class="classname">TransactionManagerLookup</code>, which is used in
            conjunction with JVM-level or the hilo generator in a JTA environment.</p></td></tr><tr><td>hibernate.transaction.flush_before_completion</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Causes the session be flushed during the <span>before completion</span> phase of the
            transaction. If possible, use built-in and automatic session context management instead.</td></tr><tr><td>hibernate.transaction.auto_close_session</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>Causes the session to be closed during the <span>after completion</span> phase of the
            transaction. If possible, use built-in and automatic session context management instead.</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        Each of the properties in the following table are prefixed by <code class="literal">hibernate.</code>. It has been removed
        in the table to conserve space.
      </p></div><div class="table"><a id="d0e6459"/><p class="title"><b>Table A.4. Miscellaneous properties</b></p><div class="table-contents"><table summary="Miscellaneous properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property</th><th>Example</th><th>Purpose</th></tr></thead><tbody><tr><td>current_session_context_class</td><td><p>One of <code class="literal">jta</code>, <code class="literal">thread</code>, <code class="literal">managed</code>, or
            <code class="literal">custom.Class</code></p></td><td><p>Supply a custom strategy for the scoping of the <code class="classname">Current</code>
            Session.</p></td></tr><tr><td>factory_class</td><td><p><code class="literal">org.hibernate.hql.internal.ast.ASTQueryTranslatorFactory</code> or
            <code class="literal">org.hibernate.hql.internal.classic.ClassicQueryTranslatorFactory</code></p></td><td>Chooses the HQL parser implementation.</td></tr><tr><td>query.substitutions</td><td><p><code class="literal">hqlLiteral=SQL_LITERAL</code> or <code class="literal">hqlFunction=SQLFUNC</code>
            </p></td><td>Map from tokens in Hibernate queries to SQL tokens, such as function or literal names.</td></tr><tr><td>hbm2ddl.auto</td><td><p><code class="literal">validate</code>, <code class="literal">update</code>, <code class="literal">create</code>,
            <code class="literal">create-drop</code></p></td><td>Validates or exports schema DDL to the database when the <code class="classname">SessionFactory</code> is
            created. With <code class="command">create-drop</code>, the database schema is dropped when the
            <code class="classname">SessionFactory</code> is closed explicitly.</td></tr><tr><td>cglib.use_reflection_optimizer</td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td>If enabled, Hibernate uses CGLIB instead of runtime reflection. This is a system-level
            property. Reflection is useful for troubleshooting. Hibernate always requires CGLIB even if you disable the
            optimizer. You cannot set this property in hibernate.cfg.xml.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6559"/>A.3. Connection pool properties</h2></div></div></div><div class="itemizedlist"><p class="title"><b>c3p0 connection pool properties</b></p><ul><li><p>hibernate.c3p0.min_size</p></li><li><p>hibernate.c3p0.max_size</p></li><li><p>hibernate.c3p0.timeout</p></li><li><p>hibernate.c3p0.max_statements</p></li></ul></div><div class="table"><a id="d0e6577"/><p class="title"><b>Table A.5. Proxool connection pool properties</b></p><div class="table-contents"><table summary="Proxool connection pool properties" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>hibernate.proxool.xml</td><td>Configure Proxool provider using an XML file (.xml is appended automatically)</td></tr><tr><td>hibernate.proxool.properties</td><td>Configure the Proxool provider using a properties file (.properties is appended
            automatically)</td></tr><tr><td>hibernate.proxool.existing_pool</td><td>Whether to configure the Proxool provider from an existing pool</td></tr><tr><td>hibernate.proxool.pool_alias</td><td>Proxool pool alias to use. Required.</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        For information on specific configuration of Proxool, refer to the Proxool documentation available from <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://proxool.sourceforge.net/">http://proxool.sourceforge.net/</a>.
      </p></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="appe-Hibernate_Development_Guide-Revision_History"/>Appendix B. Revision History</h2></div></div></div><p>
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 0-0</td><td align="left">Mon Jan 17 2011</td><td align="left"><span class="author"><span class="firstname">Dude</span> <span class="surname">McPants</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Initial creation of book by publican</td></tr></table>
				</td></tr></table></div>
	</p></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6640"/>Index</h2></div></div></div><div class="index"/></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2011 Red Hat, Inc.</p></a></body></html>